<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Quita√ß√£o de D√≠vidas üöÄ</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* =================================== */
        /* 1. RESET, BASE & VARI√ÅVEIS CSS      */
        /* =================================== */
        :root {
            /* Cores */
            --cor-fundo-principal: #161b22; 
            --cor-fundo-card: #0d1117; 
            --cor-borda: #30363d;
            --cor-texto-principal: #c9d1d9;
            --cor-verde: #238636; /* Success/Income */
            --cor-vermelho: #da3633; /* Danger/Debt */
            --cor-azul: #58a6ff; /* Primary/Info */
            --cor-amarelo: #ffc107; /* Warning/Call to Action */
            --cor-roxo: #7209b7; /* New: Fixed Expenses */

            /* Tipografia */
            --fonte-titulo: 'Inter', sans-serif;
            --fonte-corpo: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: var(--fonte-corpo);
        }

        body {
            background-color: var(--cor-fundo-principal);
            color: var(--cor-texto-principal);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        /* Frase de Motiva√ß√£o */
        .motivacao-box {
            background-color: #24292e;
            color: var(--cor-amarelo);
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-style: italic;
            font-size: 1.1em;
            border: 1px solid var(--cor-borda);
        }
        .motivacao-box i {
            margin-right: 8px;
            color: var(--cor-amarelo);
        }

        /* Novo Card de Meta Di√°ria Total */
        .meta-diaria-total {
            background-color: var(--cor-roxo);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        .meta-diaria-total p {
            font-size: 1.2em;
            font-weight: 500;
        }
        .meta-diaria-total span {
            font-size: 1.8em;
            font-weight: bold;
            display: block;
            margin-top: 5px;
        }


        /* =================================== */
        /* 2. DASHBOARD HEADER (CARDS)         */
        /* =================================== */

        .dashboard-header {
            display: grid;
            grid-template-columns: repeat(3, 1fr); 
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .info-card, .progress-area {
            background-color: var(--cor-fundo-card);
            padding: 20px;
            border: 1px solid var(--cor-borda);
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s;
        }
        
        .info-card:hover, .progress-area:hover {
             transform: translateY(-3px);
        }

        .rotulo {
            font-size: 0.9em;
            color: var(--cor-borda);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
        }
        
        .rotulo i {
            margin-right: 8px;
            color: var(--cor-azul);
        }

        .valor {
            font-size: 2.2em;
            font-weight: 700;
            font-family: var(--fonte-titulo);
        }

        .valor-caixa {
            color: var(--cor-verde);
        }

        .valor-divida {
            color: var(--cor-vermelho);
        }
        
        /* Progress Area */
        .progress-area {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .meta-valor-fixo {
            color: var(--cor-azul);
            font-size: 1.1em;
            font-weight: bold;
        }

        .progresso-bar-container {
            width: 100%;
            height: 10px;
            background-color: #30363d;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progresso {
            height: 100%;
            background-color: var(--cor-verde); 
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }
        
        /* =================================== */
        /* 3. TABELAS DE TRANSA√á√ïES E D√çVIDAS  */
        /* =================================== */

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-header h2 {
            border: none;
            color: var(--cor-texto-principal);
            font-family: var(--fonte-titulo);
        }

        .btn-principal {
            background-color: var(--cor-azul);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .btn-principal:hover {
            background-color: #4490e6;
        }
        
        .transacoes-container {
            background-color: var(--cor-fundo-card);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            overflow-x: auto; 
            border: 1px solid var(--cor-borda);
        }
        
        /* Container de D√≠vidas (que ser√° ocult√°vel) */
        #dividas-container {
            border: 1px solid var(--cor-borda);
            border-radius: 12px;
            margin-top: 20px;
            overflow: hidden; /* Garante que o conte√∫do n√£o vaze durante a transi√ß√£o */
        }
        
        /* Cabe√ßalho da Se√ß√£o Ocult√°vel */
        .section-toggle {
            background-color: var(--cor-vermelho);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            transition: background-color 0.3s;
        }
        .section-toggle:hover {
            background-color: #c72c2c;
        }
        .section-toggle h2 {
            margin: 0;
            color: white;
            font-size: 1.2em;
        }
        .section-toggle i {
            transition: transform 0.3s;
        }
        .section-toggle.aberto i {
            transform: rotate(180deg);
        }

        /* Conte√∫do da Se√ß√£o Ocult√°vel (A Tabela de D√≠vidas) */
        #lista-dividas-quitar-container {
            display: none; /* Inicia fechado */
            padding: 0 20px 20px 20px;
            background-color: var(--cor-fundo-card);
        }


        .tabela-transacoes {
            width: 100%;
            border-collapse: separate; 
            border-spacing: 0 5px; 
        }

        .tabela-transacoes th, .tabela-transacoes td {
            padding: 12px 15px;
            text-align: left;
        }
        
        .tabela-transacoes th {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8em;
            color: var(--cor-borda);
            border-bottom: 2px solid var(--cor-borda);
        }

        .tabela-transacoes tbody tr {
            background-color: #161b22; 
            border-radius: 8px;
            transition: background-color 0.2s;
        }
        
        .tabela-transacoes tbody tr:hover {
            background-color: #24292e;
        }

        .divida-quitada {
            text-decoration: line-through;
            color: #6c757d;
        }

        .btn-acao-tabela {
            background-color: var(--cor-azul);
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .btn-acao-tabela.quitar {
            background-color: var(--cor-verde);
        }

        .btn-acao-tabela.quitar:hover {
            background-color: #1f782c;
        }
        
        .btn-acao-tabela.deletar {
            background-color: var(--cor-vermelho);
        }
        
        .saldo-divida {
            font-weight: bold;
            color: var(--cor-vermelho);
        }
        
        /* 4. Plano de Quita√ß√£o (Nova Se√ß√£o) */
        .plano-quitacao {
            background-color: #1f2428;
            padding: 25px;
            border-radius: 12px;
            margin-top: 30px;
            border: 1px solid var(--cor-borda);
        }
        
        .plano-quitacao h3 {
            color: var(--cor-amarelo);
            margin-bottom: 15px;
            border-bottom: 1px solid var(--cor-borda);
            padding-bottom: 8px;
        }
        
        .plano-quitacao ol {
            margin-left: 20px;
        }
        
        .plano-quitacao li {
            margin-bottom: 10px;
            padding-left: 5px;
        }

        /* Inputs do Plano IA */
        #btn-gerar-plano {
            background-color: var(--cor-amarelo) !important;
            color: #161b22 !important;
            font-weight: bold;
        }
        
        #btn-gerar-plano:hover {
            background-color: #e6b300 !important;
        }
        
        /* Nova se√ß√£o de Contas Fixas */
        .contas-fixas-container {
             background-color: var(--cor-fundo-card);
             padding: 20px;
             border-radius: 12px;
             margin-top: 20px;
             border: 1px solid var(--cor-borda);
        }
        .contas-fixas-container h3 {
             color: var(--cor-roxo);
             margin-bottom: 15px;
             border-bottom: 1px solid var(--cor-borda);
             padding-bottom: 8px;
        }
        .contas-fixas-container ul {
            list-style: none;
            padding-left: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
        }
        .contas-fixas-container li {
            background-color: #161b22;
            padding: 8px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .contas-fixas-container li span {
            font-weight: bold;
            color: var(--cor-azul);
        }

        /* =================================== */
        /* 5. MODAIS (Cadastrar e Quitar)      */
        /* =================================== */
        
        .modal {
            display: none; 
            position: fixed;
            z-index: 100; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8); 
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #1f2428;
            margin: 8% auto; 
            padding: 30px;
            width: 90%;
            max-width: 450px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            position: relative;
            border: 1px solid var(--cor-borda);
        }
        
        .modal-content h3 {
            color: var(--cor-azul);
        }

        .fechar-modal {
            color: var(--cor-borda);
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }

        .fechar-modal:hover {
            color: var(--cor-texto-principal);
        }

        label {
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--cor-borda);
            font-size: 0.9em;
        }

        input[type="number"], input[type="text"], input[type="date"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--cor-borda);
            background-color: #24292e;
            color: var(--cor-texto-principal);
            border-radius: 6px;
            font-size: 1em;
        }
        
        .btn-ok {
            background-color: var(--cor-verde);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            float: right;
            margin-top: 20px;
            font-weight: bold;
        }
        
        #btn-quitar-divida {
            background-color: var(--cor-verde);
        }
        
        #btn-cadastrar-receita {
            background-color: var(--cor-azul);
        }

        /* =================================== */
        /* 6. RESPONSIVIDADE (MOBILE)          */
        /* =================================== */
        @media (max-width: 768px) {
            
            .dashboard-header {
                grid-template-columns: 1fr; 
                gap: 15px;
            }

            .info-card, .progress-area {
                padding: 15px;
            }

            .valor {
                font-size: 1.8em; 
            }

            .container {
                margin: 20px auto;
                padding: 0 10px; 
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .btn-principal {
                width: 100%; 
            }

            .tabela-transacoes th:nth-child(3), 
            .tabela-transacoes td:nth-child(3) {
                display: none; 
            }
            
            .modal-content {
                margin: 10% auto;
            }
            
            /* Ajuste espec√≠fico para o Plano IA no mobile */
            .plano-quitacao > div {
                 flex-direction: column;
                 align-items: stretch !important;
            }
            
            #meses-plano {
                width: 100% !important;
                margin-bottom: 10px !important;
            }
            
            #btn-gerar-plano {
                width: 100%;
            }
            
            .contas-fixas-container ul {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <div class="motivacao-box container" id="motivacao-diaria">
        <i class="fas fa-bolt"></i>
        "Se o plano n√£o funcionar, mude o plano, n√£o a meta."
    </div>
    
    <div class="meta-diaria-total container">
        <p>Meta Di√°ria Total Necess√°ria (Fixas + Quita√ß√£o)</p>
        <span id="meta-diaria-total-el">Calculando...</span>
        <p style="font-size: 0.9em; margin-top: 5px;">
            <span id="meta-fixa-diaria" style="font-size: 1em;"></span> + 
            <span id="meta-quitacao-diaria" style="font-size: 1em;"></span>
        </p>
    </div>
    

    <header class="dashboard-header container">
        
        <div class="info-card">
            <p class="rotulo"><i class="fas fa-sack-dollar"></i> Saldo Acumulado (Entradas)</p>
            <span id="total-lancado" class="valor valor-caixa">R$ 0,00</span>
        </div>
        
        <div class="progress-area" id="meta-area">
            <p class="rotulo"><i class="fas fa-bullseye"></i> Meta Total (D√≠vidas + Fixas)</p>
            <p style="margin-bottom: 5px;">Total a Quitar: <span class="meta-valor-fixo">R$ 25.701,64</span></p>
            <p>Faltam para Meta: <span id="valor-faltante" style="font-weight: bold; color: var(--cor-vermelho);">R$ 25.701,64</span></p>
            
            <div class="progresso-bar-container">
                <div id="progresso-bar" class="progresso" style="width: 0%;"></div>
            </div>
        </div>
        
        <div class="info-card">
            <p class="rotulo"><i class="fas fa-hand-holding-dollar"></i> Saldo Devedor Pendente</p>
            <span id="saldo-devedor-pendente" class="valor valor-divida">R$ 0,00</span>
        </div>
    </header>
    
    <main class="container">
        
        <div class="section-header">
            <h2>Lan√ßamentos de Receita</h2>
            <button id="abrir-cadastro-receita" class="btn-principal"> <i class="fas fa-plus"></i> Nova Receita</button>
        </div>

        
        <div class="transacoes-container">
            <h3>Hist√≥rico de Entradas</h3>
            <table class="tabela-transacoes">
                <thead>
                    <tr>
                        <th>Descri√ß√£o</th>
                        <th>Valor</th>
                        <th>Data</th>
                        <th>A√ß√£o</th>
                    </tr>
                </thead>
                <tbody id="lista-entradas">
                    </tbody>
            </table>
        </div>
        
        <div class="contas-fixas-container">
             <h3><i class="fas fa-calendar-check"></i> Contas Fixas Mensais</h3>
             <ul id="lista-contas-fixas">
                 </ul>
        </div>

        
        <div id="dividas-container">
            <div class="section-toggle" id="toggle-dividas">
                <h2><i class="fas fa-exclamation-triangle"></i> D√≠vidas a Quitar</h2>
                <i class="fas fa-chevron-down"></i>
            </div>
            
            <div id="lista-dividas-quitar-container">
                <table class="tabela-transacoes">
                    <thead>
                        <tr>
                            <th>Credor</th>
                            <th>Valor Inicial</th>
                            <th>Saldo Atual</th>
                            <th>A√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody id="lista-dividas-quitar">
                        </tbody>
                </table>
            </div>
        </div>
        
        <div class="plano-quitacao">
            <h3><i class="fas fa-robot"></i> Gerador de Plano de Quita√ß√£o Estrat√©gico</h3>
            
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                <label for="meses-plano" style="margin: 0; display: inline; color: var(--cor-texto-principal);">
                    Quitar em (meses):
                </label>
                <input type="number" id="meses-plano" value="5" min="1" max="60" style="width: 120px; margin-bottom: 0;">
                <button id="btn-gerar-plano" class="btn-principal">
                    Gerar Plano
                </button>
            </div>
            
            <div id="resultado-plano-ia">
                <p style="margin-bottom: 10px; color: var(--cor-azul);">
                    Clique em **"Gerar Plano"** para simular a quita√ß√£o do seu Saldo Devedor Pendente (Bola de Neve).
                </p>
                </div>
        </div>
        
    </main>


    <div id="modal-receita" class="modal">
        <div class="modal-content">
            <span class="fechar-modal" id="fechar-modal-receita">&times;</span>
            
            <div id="passo-dados-receita">
                <h3 id="titulo-dados-receita"><i class="fas fa-money-bill-transfer"></i> Cadastrar Nova Receita</h3>
                
                <label for="valor-input-receita">VALOR (R$)</label>
                <input type="number" id="valor-input-receita" placeholder="0.00" min="0.01" step="0.01">
                
                <label for="descricao-input-receita">DESCRI√á√ÉO</label>
                <input type="text" id="descricao-input-receita" placeholder="Ex: Sal√°rio, Venda Extra, Restitui√ß√£o">
                
                <label for="data-input-receita">DATA</label>
                <input type="date" id="data-input-receita">
                
                <button class="btn-ok" id="btn-cadastrar-receita">Cadastrar <i class="fas fa-check"></i></button>
            </div>
        </div>
    </div>
    
    <div id="modal-quitacao" class="modal">
        <div class="modal-content">
            <span class="fechar-modal" id="fechar-modal-quitacao">&times;</span>
            
            <h3 id="titulo-quitacao"><i class="fas fa-file-invoice-dollar"></i> Quitar D√≠vida</h3>
            
            <p style="margin-top: 15px;">
                **Credor:** <span id="nome-credor" style="font-weight: bold; color: var(--cor-azul);"></span>
            </p>
            <p>
                **Saldo Atual:** <span id="saldo-quitacao" style="font-weight: bold; color: var(--cor-vermelho);"></span>
            </p>

            <label for="valor-pagamento">VALOR DO PAGAMENTO (R$)</label>
            <input type="number" id="valor-pagamento" placeholder="0.00" min="0.01" step="0.01">
            
            <button class="btn-ok" id="btn-quitar-divida">Registrar Pagamento</button>
        </div>
    </div>
    
    <script>
        // ===========================================
        // JAVASCRIPT: L√ìGICA DE QUITA√á√ÉO DE D√çVIDAS
        // ===========================================

        // 1. DADOS FIXOS E VARI√ÅVEIS GLOBAIS
        const DADOS_CONTAS_FIXAS = [
            { nome: "Aluguel", valor: 850.00 },
            { nome: "Carro", valor: 1800.00 },
            { nome: "Luz", valor: 250.00 },
            { nome: "Internet Movel", valor: 120.00 },
            { nome: "Wifi", valor: 100.00 }
        ];
        
        const SOMA_CONTAS_FIXAS = DADOS_CONTAS_FIXAS.reduce((sum, item) => sum + item.valor, 0); // R$ 3.120,00
        const DIAS_UTEIS_MES = 22; 
        const META_DIARIA_FIXAS = SOMA_CONTAS_FIXAS / DIAS_UTEIS_MES; // R$ 3120 / 22 dias

        const SOMA_DIVIDAS_INICIAIS = 22681.64;
        
        // META FIXA TOTAL: (D√≠vidas + Contas Fixas)
        const META_FIXA = SOMA_DIVIDAS_INICIAIS + SOMA_CONTAS_FIXAS; // R$ 25.701,64

        // D√çVIDAS INICIAIS (Ajustadas: Banco Inter unificado)
        const DEBT_LIST_INITIAL = [
            { id: 1, credor: "Bruno Carro", valorInicial: 400.00, valorAtual: 400.00 },
            { id: 2, credor: "Itau visa", valorInicial: 200.00, valorAtual: 200.00 },
            { id: 3, credor: "Banco Inter", valorInicial: 120.00, valorAtual: 120.00 },
            { id: 4, credor: "Banco Pan", valorInicial: 265.00, valorAtual: 265.00 },
            { id: 5, credor: "Conect car", valorInicial: 60.00, valorAtual: 60.00 },
            { id: 6, credor: "Vivo", valorInicial: 95.00, valorAtual: 95.00 },
            { id: 7, credor: "Mercado pago", valorInicial: 522.00, valorAtual: 522.00 },
            { id: 8, credor: "Karen", valorInicial: 300.00, valorAtual: 300.00 },
            { id: 9, credor: "Claro", valorInicial: 300.00, valorAtual: 300.00 },
            { id: 10, credor: "Koin", valorInicial: 700.00, valorAtual: 700.00 },
            { id: 11, credor: "Will bank", valorInicial: 700.00, valorAtual: 700.00 },
            { id: 12, credor: "Picpay", valorInicial: 859.64, valorAtual: 859.64 },
            { id: 13, credor: "Carol", valorInicial: 1000.00, valorAtual: 1000.00 },
            { id: 14, credor: "Localiza", valorInicial: 1200.00, valorAtual: 1200.00 },
            { id: 15, credor: "Light", valorInicial: 1450.00, valorAtual: 1450.00 },
            { id: 16, credor: "Casa", valorInicial: 1650.00, valorAtual: 1650.00 },
            { id: 17, credor: "Bradesco", valorInicial: 2000.00, valorAtual: 2000.00 },
            { id: 18, credor: "Itau master", valorInicial: 2500.00, valorAtual: 2500.00 },
            { id: 19, credor: "Carro", valorInicial: 3500.00, valorAtual: 3500.00 },
            { id: 20, credor: "Ravi", valorInicial: 4570.00, valorAtual: 4570.00 },
        ].sort((a, b) => a.valorInicial - b.valorInicial); 

        
        let idDebtQuitting = null; 

        // Elementos DOM para Meta Di√°ria
        const metaDiariaTotalEl = document.getElementById('meta-diaria-total-el');
        const metaFixaDiariaEl = document.getElementById('meta-fixa-diaria');
        const metaQuitacaoDiariaEl = document.getElementById('meta-quitacao-diaria');
        
        // Elementos DOM para Contas Fixas
        const listaContasFixasEl = document.getElementById('lista-contas-fixas');
        
        // Elementos DOM para D√≠vidas Ocult√°veis
        const toggleDividasBtn = document.getElementById('toggle-dividas');
        const listaDividasQuitarContainer = document.getElementById('lista-dividas-quitar-container');


        // ... (Outras constantes DOM permanecem as mesmas)
        const modalReceita = document.getElementById('modal-receita');
        const abrirCadastroReceitaBtn = document.getElementById('abrir-cadastro-receita');
        const fecharModalReceitaBtn = document.getElementById('fechar-modal-receita');
        const btnCadastrarReceita = document.getElementById('btn-cadastrar-receita');
        const valorInputReceita = document.getElementById('valor-input-receita');
        const descricaoInputReceita = document.getElementById('descricao-input-receita');
        const dataInputReceita = document.getElementById('data-input-receita');
        const listaEntradasBody = document.getElementById('lista-entradas');

        const modalQuitacao = document.getElementById('modal-quitacao');
        const fecharModalQuitacaoBtn = document.getElementById('fechar-modal-quitacao');
        const nomeCredorEl = document.getElementById('nome-credor');
        const saldoQuitacaoEl = document.getElementById('saldo-quitacao');
        const valorPagamentoInput = document.getElementById('valor-pagamento');
        const btnQuitarDivida = document.getElementById('btn-quitar-divida');
        const listaDividasBody = document.getElementById('lista-dividas-quitar');
        
        const mesesPlanoInput = document.getElementById('meses-plano');
        const btnGerarPlano = document.getElementById('btn-gerar-plano');
        const resultadoPlanoIaEl = document.getElementById('resultado-plano-ia');
        
        const totalLancadoEl = document.getElementById('total-lancado');
        const saldoDevedorPendenteEl = document.getElementById('saldo-devedor-pendente');
        const valorFaltanteEl = document.getElementById('valor-faltante');


        // 2. FUN√á√ïES DE UTILIDADE (LOCAL STORAGE & FORMATO)
        // --------------------------------------------------

        const carregarTransacoes = () => {
            const transacoes = localStorage.getItem('transacoes') || '[]';
            return JSON.parse(transacoes);
        };

        const salvarTransacoes = (transacoes) => {
            localStorage.setItem('transacoes', JSON.stringify(transacoes));
        };
        
        const carregarDividas = () => {
            const dividas = localStorage.getItem('dividas');
            if (!dividas) {
                salvarDividas(DEBT_LIST_INITIAL);
                return DEBT_LIST_INITIAL;
            }
            return JSON.parse(dividas); 
        }
        
        const salvarDividas = (dividas) => {
             localStorage.setItem('dividas', JSON.stringify(dividas));
        }

        const formatarMoeda = (valor) => {
            return parseFloat(valor).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        };

        const formatarData = (dataString) => {
            const [year, month, day] = dataString.split('-');
            return `${day}/${month}/${year}`;
        }
        

        // 3. L√ìGICA DO DASHBOARD E ATUALIZA√á√ÉO
        // --------------------------------------------------

        const getTotais = (transacoes, dividas) => {
            let totalReceitas = 0;
            transacoes.forEach(t => totalReceitas += parseFloat(t.valor));

            let totalDividasPendentes = 0;
            dividas.filter(d => d.valorAtual > 0).forEach(d => totalDividasPendentes += parseFloat(d.valorAtual));
            
            return { totalReceitas, totalDividasPendentes };
        }
        
        const atualizarDashboard = (transacoes, dividas) => {
            const { totalReceitas, totalDividasPendentes } = getTotais(transacoes, dividas);

            // Card 1: Saldo Acumulado
            totalLancadoEl.textContent = formatarMoeda(totalReceitas);
            
            // Card 3: Saldo Devedor Pendente
            saldoDevedorPendenteEl.textContent = formatarMoeda(totalDividasPendentes);
            
            // Card 2: Meta
            const valorFaltante = META_FIXA - totalReceitas;
            valorFaltanteEl.textContent = formatarMoeda(Math.max(0, valorFaltante));

            // Barra de Progresso
            const progressoBar = document.getElementById('progresso-bar');
            const progressoPercentual = Math.min(100, (totalReceitas / META_FIXA) * 100);
            progressoBar.style.width = `${progressoPercentual}%`;
        };
        
        // NOVO: Renderiza a se√ß√£o de Contas Fixas
        const renderizarContasFixas = () => {
            listaContasFixasEl.innerHTML = '';
            
            let html = `
                <li>Meta Di√°ria Fixas (22 dias √∫teis): <span>${formatarMoeda(META_DIARIA_FIXAS)}</span></li>
            `;
            
            DADOS_CONTAS_FIXAS.forEach(conta => {
                 html += `<li>${conta.nome}: <span>${formatarMoeda(conta.valor)}</span></li>`;
            });
            
            listaContasFixasEl.innerHTML = html;
        }

        // 4. RENDERIZA√á√ÉO DE TABELAS
        // -------------------------------------------------------

        const renderizarTabelas = (transacoes, dividas) => {
            listaEntradasBody.innerHTML = '';
            listaDividasBody.innerHTML = '';

            // 4.1. Tabela de Receitas (Entradas)
            const transacoesOrdenadas = transacoes.sort((a, b) => new Date(b.data) - new Date(a.data));
            transacoesOrdenadas.forEach((t, index) => {
                const row = listaEntradasBody.insertRow();
                row.innerHTML = `
                    <td>${t.descricao}</td>
                    <td class="valor-caixa">${formatarMoeda(t.valor)}</td>
                    <td>${formatarData(t.data)}</td>
                    <td><button class="btn-acao-tabela deletar" data-index="${index}"><i class="fas fa-trash"></i></button></td>
                `;
            });
            
            // 4.2. Tabela de D√≠vidas (Quita√ß√£o)
            const dividasAtivas = dividas.filter(d => d.valorAtual > 0).sort((a, b) => a.valorAtual - b.valorAtual);
            
            if (dividasAtivas.length === 0) {
                 listaDividasBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--cor-verde); font-weight: bold;">üéâ TODAS AS D√çVIDAS FORAM QUITADAS!</td></tr>';
            } else {
                dividasAtivas.forEach((d) => {
                    const row = listaDividasBody.insertRow();
                    
                    row.innerHTML = `
                        <td>${d.credor}</td>
                        <td>${formatarMoeda(d.valorInicial)}</td>
                        <td class="saldo-divida">${formatarMoeda(d.valorAtual)}</td>
                        <td>
                            <button class="btn-acao-tabela quitar" data-id="${d.id}">
                                Quitar
                            </button>
                        </td>
                    `;
                });
            }
        };

        // 5. FUN√á√ïES DE A√á√ÉO (Receita e Quita√ß√£o)
        // -------------------------------------------------------
        
        // 5.5. A√ß√£o: Gerar Plano de Quita√ß√£o Din√¢mico (Simula√ß√£o IA)
        const gerarPlanoQuitacaoIA = (isInit = false) => {
            const meses = parseInt(mesesPlanoInput.value);
            
            if (isNaN(meses) || meses <= 0) {
                 // Apenas impede se n√£o for a chamada inicial
                if (!isInit) {
                    resultadoPlanoIaEl.innerHTML = '<p style="color: var(--cor-vermelho); font-weight: bold;">‚ö†Ô∏è Por favor, insira um n√∫mero de meses v√°lido (igual ou maior que 1).</p>';
                }
                // Retorna 0 se inv√°lido
                return 0;
            }

            const dividas = carregarDividas();
            const dividasAtivas = dividas.filter(d => d.valorAtual > 0);
            const { totalDividasPendentes } = getTotais(carregarTransacoes(), dividas);
            
            if (totalDividasPendentes <= 0) {
                if (!isInit) {
                    resultadoPlanoIaEl.innerHTML = '<p style="color: var(--cor-verde); font-weight: bold;">üéâ Parab√©ns! N√£o h√° d√≠vidas pendentes para gerar um plano.</p>';
                }
                // Retorna 0 se n√£o houver d√≠vidas
                return 0;
            }

            // 1. C√°lculo da Contribui√ß√£o Mensal Necess√°ria
            const valorMensalNecessario = totalDividasPendentes / meses;
            // C√°lculo da Meta Di√°ria para Quita√ß√£o (baseada em 30 dias)
            const valorDiarioNecessario = valorMensalNecessario / 30; 
            const valorSemanalNecessario = valorMensalNecessario / 4;

            // Se n√£o for a chamada inicial, renderiza o HTML do plano
            if (!isInit) {
                let html = `
                    <h4 style="color: var(--cor-verde); margin-bottom: 15px;">Plano de Quita√ß√£o em ${meses} meses (Bola de Neve)</h4>
                    
                    <p style="font-size: 1.1em; font-weight: bold; margin-bottom: 10px;">
                        <i class="fas fa-chart-line"></i> Meta de Pagamento Necess√°ria:
                    </p>
                    
                    <ul style="list-style: none; margin-left: 0; padding-left: 0;">
                        <li style="margin-bottom: 5px;">- Meta Mensal (Aportes): **${formatarMoeda(valorMensalNecessario)}**</li>
                        <li style="margin-bottom: 5px;">- Meta Semanal (Aportes): **${formatarMoeda(valorSemanalNecessario)}**</li>
                        <li style="margin-bottom: 15px;">- Meta Di√°ria (Aportes): **${formatarMoeda(valorDiarioNecessario)}**</li>
                    </ul>
                    
                    <p style="font-weight: bold; margin-bottom: 10px; border-top: 1px solid var(--cor-borda); padding-top: 10px;">
                        <i class="fas fa-list-ol"></i> Estrat√©gia de Prioriza√ß√£o Mensal:
                    </p>
                    
                    <ol id="plano-prioridades" style="margin-left: 20px;">
                `;

                // 2. Simula√ß√£o da Prioridade (Bola de Neve: menor d√≠vida primeiro)
                let saldoSimulado = totalDividasPendentes;
                let mesAtual = 1;
                const prioridadeDividas = [...dividasAtivas].sort((a, b) => a.valorAtual - b.valorAtual);

                while (saldoSimulado > 0 && mesAtual <= meses) {
                    
                    let pagamentosEsteMes = [];
                    let aporteMensalDisponivel = valorMensalNecessario;
                    let aporteAplicado = 0;
                    
                    for (let i = 0; i < prioridadeDividas.length; i++) {
                        let divida = prioridadeDividas[i];
                        
                        if (divida.valorAtual > 0 && aporteMensalDisponivel > 0) {
                            const pagamento = Math.min(divida.valorAtual, aporteMensalDisponivel);
                            
                            divida.valorAtual -= pagamento;
                            aporteMensalDisponivel -= pagamento;
                            aporteAplicado += pagamento;
                            
                            if (pagamento > 0) {
                                pagamentosEsteMes.push(`R$ ${pagamento.toFixed(2)} em **${divida.credor}**`);
                            }
                        }
                    }
                    
                    saldoSimulado -= aporteAplicado;
                    
                    html += `
                        <li>
                            **M√™s ${mesAtual} (Aporte ${formatarMoeda(valorMensalNecessario)}):** Priorizar pagamentos em: ${pagamentosEsteMes.join(', ')}. Saldo estimado ao final do m√™s: **${formatarMoeda(Math.max(0, saldoSimulado))}**.
                        </li>
                    `;
                    
                    prioridadeDividas.sort((a, b) => a.valorAtual - b.valorAtual);
                    
                    mesAtual++;
                }

                html += `</ol>`;

                if (saldoSimulado > 0) {
                    html += `<p style="color: var(--cor-vermelho); margin-top: 15px; font-weight: bold;"><i class="fas fa-exclamation-circle"></i> Aten√ß√£o: O plano de ${meses} meses n√£o foi suficiente. Ser√° necess√°rio um aporte extra de ${formatarMoeda(saldoSimulado)}.</p>`;
                } else {
                    html += `<p style="color: var(--cor-verde); margin-top: 15px; font-weight: bold;"><i class="fas fa-check-circle"></i> Sucesso! A quita√ß√£o ser√° alcan√ßada no M√™s ${mesAtual - 1} (ou antes).</p>`;
                }

                resultadoPlanoIaEl.innerHTML = html;
            }
            
            // Retorna a meta di√°ria calculada (necess√°rio para a soma)
            return valorDiarioNecessario; 
        };
        
        // NOVO: Fun√ß√£o para calcular e exibir a Meta Di√°ria Total
        const atualizarMetaDiariaTotal = () => {
            // 1. Meta Di√°ria Fixas (Baseada em 22 dias √∫teis)
            const metaFixa = META_DIARIA_FIXAS; 
            
            // 2. Meta Di√°ria Quita√ß√£o (Baseada no plano IA de 5 meses/30 dias)
            // Chamamos a fun√ß√£o com isInit = true para obter o valor sem renderizar o HTML do plano
            const metaQuitacao = gerarPlanoQuitacaoIA(true); 
            
            // 3. Soma Total
            const metaTotal = metaFixa + metaQuitacao;
            
            // 4. Exibe na tela
            metaFixaDiariaEl.textContent = `${formatarMoeda(metaFixa)} (Fixas)`;
            metaQuitacaoDiariaEl.textContent = `${formatarMoeda(metaQuitacao)} (Quita√ß√£o)`;
            metaDiariaTotalEl.textContent = formatarMoeda(metaTotal);
        }

        // 6. FUN√á√ïES DO MODAL
        // -----------------------------------------

        // ... (as fun√ß√µes de modal permanecem as mesmas)

        const abrirModalReceita = () => {
            valorInputReceita.value = '';
            descricaoInputReceita.value = '';
            dataInputReceita.value = new Date().toISOString().slice(0, 10); 
            modalReceita.style.display = 'block';
            valorInputReceita.focus();
        };

        const fecharModal = (modalEl) => {
            modalEl.style.display = 'none';
        };

        const registrarPagamento = () => {
             // ... (L√≥gica de registro e remo√ß√£o de d√≠vida permanece a mesma)
            const valorPagamento = parseFloat(valorPagamentoInput.value);
            const dividas = carregarDividas();
            let divida = dividas.find(d => d.id === idDebtQuitting);
            
            if (isNaN(valorPagamento) || valorPagamento <= 0) {
                alert("Insira um valor de pagamento v√°lido e positivo.");
                return;
            }
            
            if (valorPagamento > divida.valorAtual) {
                 if (!confirm(`O valor de ${formatarMoeda(valorPagamento)} √© maior que o saldo atual de ${formatarMoeda(divida.valorAtual)}. Deseja aplicar o pagamento total e quitar o saldo?`)) {
                    return;
                }
            }
            
            divida.valorAtual = Math.max(0, divida.valorAtual - valorPagamento);
            
            if (divida.valorAtual <= 0) {
                const index = dividas.findIndex(d => d.id === idDebtQuitting);
                if (index > -1) {
                    dividas.splice(index, 1);
                }
                alert(`üéâ D√≠vida ${divida.credor} quitada com sucesso e removida da lista!`);
            }
            
            salvarDividas(dividas);
            initDashboard();
            fecharModal(modalQuitacao);
        }

        // 7. INICIALIZA√á√ÉO E LISTENERS
        // -----------------------------------------

        const initDashboard = () => {
            const transacoes = carregarTransacoes();
            const dividas = carregarDividas();
            
            atualizarDashboard(transacoes, dividas);
            renderizarTabelas(transacoes, dividas);
            renderizarContasFixas(); // Novo: Renderiza contas fixas
            
            // Gera o plano IA (renderiza o HTML) e atualiza a Meta Di√°ria Total
            gerarPlanoQuitacaoIA();
            atualizarMetaDiariaTotal();
        };
        
        // NOVO: Fun√ß√£o para alternar a visibilidade da se√ß√£o de d√≠vidas
        const toggleDividasSection = () => {
            const isOculta = listaDividasQuitarContainer.style.display === 'none' || listaDividasQuitarContainer.style.display === '';
            
            if (isOculta) {
                listaDividasQuitarContainer.style.display = 'block';
                toggleDividasBtn.classList.add('aberto');
            } else {
                listaDividasQuitarContainer.style.display = 'none';
                toggleDividasBtn.classList.remove('aberto');
            }
        };


        // LISTENERS
        document.addEventListener('DOMContentLoaded', initDashboard);

        // Toggle da se√ß√£o de d√≠vidas
        toggleDividasBtn.addEventListener('click', toggleDividasSection);
        
        // Abertura de Receita
        abrirCadastroReceitaBtn.addEventListener('click', abrirModalReceita);
        fecharModalReceitaBtn.addEventListener('click', () => fecharModal(modalReceita));
        btnCadastrarReceita.addEventListener('click', adicionarReceita);
        
        // Fechamento de Quita√ß√£o
        fecharModalQuitacaoBtn.addEventListener('click', () => fecharModal(modalQuitacao));
        btnQuitarDivida.addEventListener('click', registrarPagamento);
        
        // Listener do novo bot√£o "Gerar Plano" (que agora atualiza o plano e a meta)
        btnGerarPlano.addEventListener('click', () => {
            gerarPlanoQuitacaoIA(); // Renderiza o plano
            atualizarMetaDiariaTotal(); // Atualiza a Meta Total com o novo c√°lculo
        });
        
        // Delega√ß√£o de evento (Deletar Receita e Quitar D√≠vida)
        document.addEventListener('click', (e) => {
            // Deletar Receita (na tabela de entradas)
            if (e.target.closest('.btn-acao-tabela.deletar')) {
                const index = e.target.closest('.btn-acao-tabela.deletar').getAttribute('data-index');
                // ... (L√≥gica de deletar receita permanece a mesma)
            }
            
            // Iniciar Quita√ß√£o (na tabela de d√≠vidas)
            if (e.target.closest('.btn-acao-tabela.quitar')) {
                const id = parseInt(e.target.closest('.btn-acao-tabela.quitar').getAttribute('data-id'));
                iniciarQuitarDivida(id);
            }
        });

        // Fechar modais ao clicar fora
        window.addEventListener('click', (event) => {
            if (event.target === modalReceita) {
                fecharModal(modalReceita);
            }
            if (event.target === modalQuitacao) {
                fecharModal(modalQuitacao);
            }
        });
    </script>
</body>
</html>
