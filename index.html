<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROJECT TITAN | CORE FINANCIAL [V3.5]</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Space+Mono:wght+400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* =================================== */
        /* 1. VARI√ÅVEIS CSS E BASE (FUTURE NOIR)*/
        /* =================================== */
        :root {
            /* Fundo Escuro Classudo */
            --cor-fundo-principal: #0E1117; 
            --cor-fundo-card: rgba(20, 25, 33, 0.7); 
            --cor-borda: #2C3540; 
            --cor-texto-principal: #F0F6FC; 
            --cor-texto-secundario: #8B949E; 
            
            /* Cores de Destaque Futuristas */
            --cor-sucesso: #10B981; /* Verde Esmeralda (Sucesso/Confirma√ß√£o) */
            --cor-divida: #EF4444; /* Vermelho Alerta */
            --cor-primario: #00BCD4; /* Azul Ciano Vibrante (A√ß√£o/Destaque) */
            --cor-meta-diaria: #9B59B6; /* Roxo Profundo */
            --cor-alerta: #F59E0B; /* Amarelo */
            --cor-fixa: #1DE9B6; /* Verde Neon para Fixas */

            /* Tipografia */
            --fonte-titulo: 'Inter', sans-serif;
            --fonte-corpo: 'Inter', sans-serif;
            --fonte-dados: 'Space Mono', monospace; 
            
            /* Efeitos */
            --sombra-card: 0 4px 20px rgba(0, 0, 0, 0.5), inset 0 0 0 1px var(--cor-borda);
            --sombra-card-hover: 0 6px 30px rgba(0, 0, 0, 0.7), inset 0 0 0 2px var(--cor-primario);
            --transicao-rapida: 0.3s ease-in-out;
            --espacamento-mobile: 15px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: var(--fonte-corpo);
        }

        body {
            background-color: var(--cor-fundo-principal);
            color: var(--cor-texto-principal);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-image: radial-gradient(circle at 50% 50%, rgba(0, 188, 212, 0.05), transparent 80%);
        }

        .container {
            max-width: 1300px; 
            margin: 40px auto;
            padding: 0 25px;
            width: 100%;
        }
        
        /* =================================== */
        /* 2. BANNER E T√çTULO */
        /* =================================== */

        .dynamic-banner {
            width: 100%;
            background-color: #000000;
            color: var(--cor-fixa); 
            padding: 10px 0;
            text-align: right;
            border-bottom: 2px solid var(--cor-fixa);
            box-shadow: 0 5px 20px rgba(29, 233, 182, 0.3);
            /* Garante que o banner n√£o cause scroll horizontal excessivo */
            overflow: hidden; 
        }
        
        .banner-text {
            font-family: var(--fonte-dados);
            font-size: 1.1em;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            padding-right: 30px;
            display: inline-block;
            white-space: nowrap; 
            animation: moveBanner 20s linear infinite;
        }
        
        @keyframes moveBanner {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        h1 {
            font-family: var(--fonte-titulo);
            color: var(--cor-texto-principal);
            text-align: center;
            margin-top: 30px;
            margin-bottom: 30px;
            font-weight: 800;
            font-size: 3em; 
            letter-spacing: 2px;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
            padding-bottom: 15px;
        }
        
        h1 i {
            color: var(--cor-primario);
            margin-right: 15px;
        }
        
        /* Bot√£o Data Atual */
        #btn-data-atual {
            background-color: var(--cor-fundo-card);
            color: var(--cor-texto-principal);
            padding: 10px 20px;
            border: 1px solid var(--cor-borda);
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9em;
            cursor: default;
            display: block;
            width: 100%;
            text-align: center;
            margin-bottom: 20px;
        }
        #btn-data-atual i {
            color: var(--cor-primario);
            margin-right: 8px;
        }

        /* =================================== */
        /* 3. DASHBOARD E CART√ïES */
        /* =================================== */

        .dashboard-header {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 30px;
            margin-bottom: 50px;
        }
        
        .info-card, .progress-area {
            background-color: var(--cor-fundo-card);
            padding: 35px;
            border-radius: 12px;
            box-shadow: var(--sombra-card);
            transition: all var(--transicao-rapida);
            backdrop-filter: blur(5px);
            border: 1px solid var(--cor-borda);
        }
        
        .rotulo {
            color: var(--cor-texto-secundario);
            font-weight: 600;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        /* Destaque de valores (uso de !important para sobrepor) */
        .info-card .valor, .valor-divida, .valor-caixa {
            font-size: 2.5em !important; 
            font-family: var(--fonte-dados);
            font-weight: 700;
        }
        .valor-caixa {
            color: var(--cor-sucesso);
        }
        .valor-divida {
            color: var(--cor-divida);
        }

        .progresso-bar-container {
            height: 10px; 
            background-color: #1A212E; 
            border-radius: 5px; 
            overflow: hidden; 
            margin-top: 10px;
        }
        .progresso {
            height: 100%; 
            background-color: var(--cor-sucesso); 
            transition: width 0.5s;
        }

        /* Meta Di√°ria Card */
        #meta-diaria-card {
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background-color: var(--cor-fundo-card); 
            padding: 25px; 
            border-radius: 12px; 
            box-shadow: var(--sombra-card); 
            margin-bottom: 30px; 
            border: 1px solid var(--cor-borda);
        }
        #meta-diaria-card #meta-diaria-total-el {
            font-size: 2.2em; 
            font-family: var(--fonte-dados); 
            color: var(--cor-meta-diaria); 
            font-weight: 700;
        }
        #meta-diaria-incentivo {
            font-weight: bold; 
            font-family: var(--fonte-titulo); 
            font-size: 1em;
        }

        /* =================================== */
        /* 4. SE√á√ïES E TOGGLES */
        /* =================================== */
        
        h2 {
            font-family: var(--fonte-titulo);
            font-weight: 600;
            color: var(--cor-texto-principal);
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        .toggle-section {
            border: 1px solid var(--cor-borda);
            border-radius: 12px;
            margin-top: 40px;
            box-shadow: var(--sombra-card);
            background-color: var(--cor-fundo-card);
            backdrop-filter: blur(5px);
        }
        
        .section-toggle {
            background-color: rgba(26, 33, 46, 0.9); 
            padding: 20px 30px; /* Padding levemente menor */
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-radius: 12px;
            transition: all var(--transicao-rapida);
            border-bottom: 1px solid var(--cor-borda);
        }
        .section-toggle:hover {
            background-color: #1A212E;
        }
        .section-toggle h2 {
            margin: 0;
            font-size: 1.3em; /* Fonte menor para toggle */
            font-family: var(--fonte-titulo);
        }
        .section-toggle.dividas h2 {
            color: var(--cor-divida);
        }
        .section-toggle.receitas h2 {
            color: var(--cor-sucesso);
        }
        .section-toggle.fixas h2 {
             color: var(--cor-fixa); 
        }
        .section-toggle i {
            transition: transform 0.3s;
            color: var(--cor-texto-secundario);
        }
        .section-toggle.aberto i {
            transform: rotate(180deg);
            color: var(--cor-primario);
        }

        .lista-container-ocultavel {
            padding: 25px;
        }
        
        /* Contas Fixas */
        .contas-fixas-container ul {
            list-style: none;
            padding-left: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }
        .contas-fixas-container li {
            background-color: #1A212E;
            padding: 18px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 5px solid var(--cor-fixa);
            font-size: 1em;
            font-family: var(--fonte-dados);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .diaria-fixa-destaque {
            background-color: var(--cor-fixa);
            color: var(--cor-fundo-principal) !important;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        
        /* Bot√£o Pagar Conta Fixa */
        .btn-pagar-fixa {
            background-color: var(--cor-fixa);
            color: var(--cor-fundo-principal);
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 700;
            transition: all var(--transicao-rapida);
            margin-left: 10px;
            opacity: 1;
        }
        .btn-pagar-fixa:hover {
             background-color: #00FFC6;
             box-shadow: 0 0 10px var(--cor-fixa);
        }
        .btn-pagar-fixa.pago {
             background-color: var(--cor-sucesso);
             cursor: not-allowed;
             opacity: 0.5;
        }
        .btn-pagar-fixa.inativo {
             background-color: var(--cor-borda);
             cursor: not-allowed;
             opacity: 0.4;
        }

        .motivacao-box {
            background-color: var(--cor-fundo-card);
            color: var(--cor-texto-secundario);
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 35px;
            font-size: 1em;
            border: 1px solid var(--cor-borda);
            box-shadow: var(--sombra-card);
            backdrop-filter: blur(5px); 
        }

        /* =================================== */
        /* 5. TABELAS E BOT√ïES DE A√á√ÉO */
        /* =================================== */

        .tabela-transacoes { 
            width: 100%; 
            border-collapse: collapse;
            font-family: var(--fonte-dados);
        }
        .tabela-transacoes th, .tabela-transacoes td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--cor-borda);
        }
        .tabela-transacoes th {
            background-color: #1A212E;
            color: var(--cor-primario);
            text-transform: uppercase;
            font-weight: 700;
            font-size: 0.9em;
        }

        /* Estilo para Bot√µes de A√ß√£o na Tabela (UNIFORMIZADO) */
        .btn-acao-tabela {
            background-color: var(--cor-primario);
            color: var(--cor-fundo-principal);
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 700;
            transition: all var(--transicao-rapida);
            white-space: nowrap; /* Garante que o texto e √≠cone fiquem na mesma linha */
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .btn-acao-tabela:hover {
            opacity: 0.9;
        }
        .btn-acao-tabela.deletar {
            background-color: var(--cor-divida);
        }
        .btn-acao-tabela.quitar {
            background-color: var(--cor-divida); /* Mantido vermelho para √™nfase na quita√ß√£o */
        }
        .btn-acao-tabela.btn-inativo-capital {
            background-color: var(--cor-borda);
            color: var(--cor-texto-secundario);
            cursor: not-allowed;
            opacity: 0.6;
            box-shadow: none;
        }

        /* =================================== */
        /* 6. RESPONSIVIDADE (MOBILE FIRST) */
        /* =================================== */

        /* Mobile Padr√£o (Telas at√© 768px) */
        @media (max-width: 768px) {
            
            /* Global */
            .dynamic-banner {
                /* ALTERA√á√ÉO CRUCIAL 2: Manter o banner vis√≠vel, confiando na meta-tag para evitar zoom */
                display: block; 
            }
            .container {
                padding: 0 var(--espacamento-mobile);
                margin: 20px auto;
            }
            h1 {
                font-size: 1.8em;
                margin-top: 15px; 
                margin-bottom: 20px;
            }
            
            /* Dashboard: Empilhamento */
            .dashboard-header {
                grid-template-columns: 1fr; /* Colunas empilhadas */
                gap: 20px;
                margin-bottom: 30px;
            }
            .info-card, .progress-area {
                padding: 20px;
            }
            .info-card .valor, .valor-divida, .valor-caixa {
                font-size: 1.8em !important;
            }
            
            /* Meta Di√°ria Card */
            #meta-diaria-card {
                flex-direction: column;
                align-items: flex-start !important;
                padding: 20px;
            }
            #meta-diaria-card > div {
                margin-bottom: 10px;
            }
            #meta-diaria-card #meta-diaria-total-el {
                font-size: 1.6em !important;
            }
            #meta-diaria-incentivo {
                text-align: left;
                font-size: 0.9em !important;
            }

            /* Se√ß√µes e Bot√µes de A√ß√£o */
            .section-header {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }
            .btn-principal {
                width: 100%; /* Bot√£o de a√ß√£o full width */
            }
            .section-toggle h2 {
                font-size: 1.1em;
            }

            /* Fixas Grid */
            .contas-fixas-container ul {
                grid-template-columns: 1fr; 
                gap: 15px;
            }
            .contas-fixas-container li {
                font-size: 0.9em;
            }
            .btn-pagar-fixa {
                padding: 5px 10px;
                font-size: 0.75em;
            }

            /* Tabela Ajuste (Menor Fonte) */
            .tabela-transacoes {
                font-size: 0.8em; 
            }
            .tabela-transacoes th, .tabela-transacoes td {
                padding: 8px;
            }
            .btn-acao-tabela {
                font-size: 0.7em;
                padding: 4px 8px;
            }
        }
        
        /* Desktop/Tablet (Telas maiores) */
        @media (min-width: 1024px) {
             .dashboard-header {
                 grid-template-columns: repeat(3, 1fr); 
             }
             .container {
                 padding: 0 25px;
             }
        }
        
    </style>
</head>
<body>
    
    <div id="login-screen">
        <div class="login-box">
            <h2><i class="fas fa-fingerprint"></i> PROJECT TITAN</h2>
            <p style="color: var(--cor-texto-secundario); margin-bottom: 25px;">Acesso restrito ao Painel de Gest√£o Estrat√©gica.</p>
            <label for="password-input">CHAVE DE SEGURAN√áA</label>
            <input type="password" id="password-input" placeholder="Chave de Acesso" required>
            <button id="btn-login" class="btn-principal"><i class="fas fa-sign-in-alt"></i> AUTORIZAR ACESSO</button>
            <p id="login-feedback" style="margin-top: 15px; color: var(--cor-divida); font-weight: bold;"></p>
        </div>
    </div>
    
    <div id="main-content" style="display: none;">
        
        <div class="dynamic-banner">
            <div class="banner-text" id="banner-text">
                üí∞ Foco & Disciplina. ZERO D√çVIDA. Capital √© PODER. üí∏
            </div>
        </div>
        
        <div class="container">
            <h1><i class="fas fa-terminal"></i> PROJECT TITAN</h1>
        </div>

        <div class="container" id="data-atual-info">
            <button id="btn-data-atual">
                <i class="fas fa-calendar-day"></i> RASTREIO DE METAS: <span id="data-atual"></span>
            </button>
        </div>

        <div class="motivacao-box container" id="motivacao-diaria">
            <i class="fas fa-infinity"></i>
            "DISCIPLINA √â O COMANDO. A LIBERDADE FINANCEIRA √â O STATUS. Mantenha o Foco."
        </div>
        
        <div id="meta-diaria-card" class="meta-diaria-total container" style="border: 1px solid var(--cor-meta-diaria);">
            <div>
                <p style="color: var(--cor-texto-secundario); font-weight: 600;"><i class="fas fa-bullseye"></i> TARGET DI√ÅRIO DE APORTE (FIXAS + QUITA√á√ÉO)</p>
                <span id="meta-diaria-total-el">R$ 0,00</span>
            </div>
            <span id="meta-diaria-incentivo" class="destaque-conclusao" style="display: none;"></span>
        </div>
        

        <header class="dashboard-header container">
            
            <div class="info-card">
                <p class="rotulo"><i class="fas fa-satellite-dish"></i> CAPITAL ACUMULADO (ENTRADAS)</p>
                <span id="total-lancado" class="valor valor-caixa">R$ 0,00</span>
            </div>
            
            <div class="progress-area" id="meta-area">
                <p class="rotulo"><i class="fas fa-route"></i> STATUS DE QUITA√á√ÉO √öNICA</p>
                <p style="margin-bottom: 5px; color: var(--cor-texto-secundario);">D√≠vidas Pendentes: <span id="total-dividas-pendentes" style="font-weight: 700; color: var(--cor-divida); font-family: var(--fonte-dados);">R$ 0,00</span></p>
                <p>Progresso de Quita√ß√£o com Capital: <span id="progresso-capital-txt" style="font-weight: 700; color: var(--cor-sucesso); font-family: var(--fonte-dados);">0.00%</span></p>
                
                <div class="progresso-bar-container">
                    <div id="progresso-bar" class="progresso" style="width: 0%;"></div>
                </div>
            </div>
            
            <div class="info-card">
                <p class="rotulo"><i class="fas fa-skull-crossbones"></i> SALDO TOTAL A QUITAR</p>
                <span id="saldo-pendente-total" class="valor valor-divida">R$ 0,00</span>
            </div>
        </header>
        
        <main class="container">
            
            <div class="section-header">
                <h2><i class="fas fa-arrow-circle-up"></i> M√ìDULO: INJE√á√ÉO DE CAPITAL</h2>
                <button id="abrir-cadastro-receita" class="btn-principal"> <i class="fas fa-plus"></i> INJETAR VALOR</button>
            </div>

            
            <div id="historico-receitas-container" class="toggle-section">
                <div class="section-toggle receitas" id="toggle-receitas">
                    <h2><i class="fas fa-clipboard-list"></i> LOG: REGISTROS DE LAN√áAMENTO (CAPITAL)</h2>
                    <i class="fas fa-chevron-down"></i>
                </div>
                
                <div id="lista-receitas-container" class="lista-container-ocultavel" style="display: none;">
                    <table class="tabela-transacoes">
                        <thead>
                            <tr>
                                <th>DESCRI√á√ÉO</th>
                                <th>VALOR (R$)</th>
                                <th>DATA</th>
                                <th>A√á√ÉO</th>
                            </tr>
                        </thead>
                        <tbody id="lista-entradas">
                            </tbody>
                    </table>
                </div>
            </div>
            
            <div id="feedback-fixas-quitadas" class="motivacao-box" style="display: none; margin-top: 40px; border: 2px solid var(--cor-sucesso);">
                 <i class="fas fa-medal" style="color: var(--cor-sucesso);"></i> PROTOCOLO DE CONTAS FIXAS CONCLU√çDO! <i class="fas fa-medal" style="color: var(--cor-sucesso);"></i>
                 <p style="color: var(--cor-texto-principal); font-weight: 600;">Contas Fixas liquidadas para este ciclo. Foco total em reduzir o Saldo Pendente.</p>
            </div>

            
            <div id="contas-fixas-toggle" class="toggle-section">
                <div class="section-toggle fixas" id="toggle-fixas">
                    <h2><i class="fas fa-calculator"></i> CONTAS FIXAS (META: R$ <span id="soma-fixas" class="valor-divida" style="font-family: var(--fonte-dados); font-size: 1em;">0,00</span>)</h2>
                    <i class="fas fa-chevron-down"></i>
                </div>
                
                <div id="lista-fixas-container" class="lista-container-ocultavel" style="display: none;">
                     <p style="color: var(--cor-alerta); font-weight: bold; margin-bottom: 20px;">
                        <i class="fas fa-exclamation-triangle"></i> NOTA: Ao clicar em 'PAGAR', o valor ser√° deduzido imediatamente do Capital Acumulado.
                     </p>
                     <div id="contas-fixas-card" class="contas-fixas-container">
                         <ul id="lista-contas-fixas">
                         </ul>
                    </div>
                </div>
            </div>


            
            <div id="dividas-container" class="toggle-section">
                <div class="section-toggle dividas" id="toggle-dividas">
                    <h2><i class="fas fa-radiation"></i> D√çVIDAS √öNICAS (PROTOCOLO DE REDU√á√ÉO)</h2>
                    <i class="fas fa-chevron-down"></i>
                </div>
                
                <div id="lista-dividas-quitar-container" class="lista-container-ocultavel" style="display: none;">
                    <p style="color: var(--cor-alerta); font-weight: bold; margin-bottom: 20px;">
                        <i class="fas fa-exclamation-triangle"></i> NOTA: O bot√£o "PAGAR" s√≥ √© ativado quando o Capital Acumulado √© $\ge$ Saldo da D√≠vida.
                     </p>
                    <table class="tabela-transacoes">
                        <thead>
                            <tr>
                                <th>CREDOR</th>
                                <th>VALOR INICIAL</th>
                                <th>SALDO ATUAL (R$)</th>
                                <th>A√á√ÉO</th>
                            </tr>
                        </thead>
                        <tbody id="lista-dividas-quitar">
                            </tbody>
                    </table>
                </div>
            </div>
            
            <div class="plano-quitacao" style="margin-top: 50px; padding: 30px; background-color: var(--cor-fundo-card); border-radius: 12px; box-shadow: var(--sombra-card); border: 1px solid var(--cor-borda);">
                <h3><i class="fas fa-brain"></i> PLANO DE QUITA√á√ÉO ESTRAT√âGICO (M√ìDULO IA)</h3>
                
                <div id="plano-ia-controls" style="display: flex; gap: 20px; align-items: flex-end; margin-top: 15px; margin-bottom: 25px;">
                    <div>
                         <label for="meses-plano" style="margin-bottom: 5px; display: block; color: var(--cor-texto-principal); font-weight: 600;">TARGET: Meses para Quitar D√≠vidas √öNICAS:</label>
                         <input type="number" id="meses-plano" value="5" min="1" max="60" style="padding: 8px; border-radius: 4px; border: 1px solid var(--cor-borda); background: #1A212E; color: var(--cor-texto-principal); width: 80px;">
                    </div>
                    <button id="btn-gerar-plano" class="btn-principal" style="margin-top: 0; padding: 10px 15px; width: auto;">
                        <i class="fas fa-redo-alt"></i> RECALCULAR PLANO
                    </button>
                </div>
                
                <div id="resultado-plano-ia" style="border-left: 3px solid var(--cor-primario); padding-left: 15px; margin-top: 20px;">
                    <p style="color: var(--cor-texto-secundario);">Aguardando c√°lculo...</p>
                    </div>
                
                <div id="dicas-quitacao" style="margin-top: 30px; padding-top: 20px; border-top: 1px dashed var(--cor-borda);">
                     </div>
            </div>
            
        </main>
    </div>


    <div id="modal-receita" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7);">
        <div class="modal-content" style="background-color: var(--cor-fundo-card); margin: 15% auto; padding: 30px; border-radius: 10px; border: 1px solid var(--cor-primario); width: 80%; max-width: 400px; box-shadow: var(--sombra-card-hover);">
            <span class="fechar-modal" id="fechar-modal-receita" style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
            <h3 id="titulo-dados-receita" style="color: var(--cor-sucesso);"><i class="fas fa-arrow-up"></i> LAN√áAMENTO DE CAPITAL</h3>
            <label for="valor-input-receita" style="display: block; margin-top: 20px; color: var(--cor-texto-principal); font-weight: 600;">VALOR DO APORTE (R$)</label>
            <input type="number" id="valor-input-receita" placeholder="0.00" min="0.01" step="0.01" style="width: 100%; padding: 10px; margin-top: 8px; border-radius: 5px; border: 1px solid var(--cor-borda); background-color: #1A212E; color: var(--cor-fixa); font-family: var(--fonte-dados);">
            <button class="btn-principal btn-ok" id="btn-cadastrar-receita" style="background-color: var(--cor-sucesso); margin-top: 25px;">CONFIRMAR LAN√áAMENTO <i class="fas fa-check"></i></button>
        </div>
    </div>
    
    <div id="modal-quitacao" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7);">
        <div class="modal-content" style="background-color: var(--cor-fundo-card); margin: 15% auto; padding: 30px; border-radius: 10px; border: 1px solid var(--cor-divida); width: 80%; max-width: 400px; box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);">
            <span class="fechar-modal" id="fechar-modal-quitacao" style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
            <h3 id="titulo-quitacao" style="color: var(--cor-divida);"><i class="fas fa-receipt"></i> REGISTRAR PAGAMENTO</h3>
            <p style="margin-top: 15px; margin-bottom: 10px; font-family: var(--fonte-titulo); font-weight: 600; color: var(--cor-texto-secundario);">
                TARGET CREDOR: <span id="nome-credor" style="font-family: var(--fonte-dados); color: var(--cor-texto-principal);"></span>
            </p>
            <p style="margin-bottom: 20px; font-family: var(--fonte-titulo); font-weight: 600; color: var(--cor-texto-secundario);">
                SALDO PENDENTE: <span id="saldo-quitacao" class="saldo-divida" style="font-family: var(--fonte-dados);"></span>
            </p>
            <label for="valor-pagamento" style="display: block; margin-top: 20px; color: var(--cor-texto-principal); font-weight: 600;">VALOR DO PAGAMENTO (R$)</label>
            <input type="number" id="valor-pagamento" placeholder="0.00" min="0.01" step="0.01" style="width: 100%; padding: 10px; margin-top: 8px; border-radius: 5px; border: 1px solid var(--cor-borda); background-color: #1A212E; color: var(--cor-fixa); font-family: var(--fonte-dados);">
            <button class="btn-principal btn-ok" id="btn-quitar-divida" style="background-color: var(--cor-divida); margin-top: 25px;">FINALIZAR TRANSA√á√ÉO</button>
        </div>
    </div>
    
    <script>
        // ===========================================
        // JAVASCRIPT: L√ìGICA DE NEG√ìCIO E CONEX√ÉO V3.5 (OTIMIZADA)
        // ===========================================

        const DIAS_UTEIS_MES = 22; 
        const LOGIN_PASSWORD = '01';
        const SESSION_TIMEOUT_MS = 600000; // 10 minutos
        let sessionTimer;

        // Dados Iniciais (Mantidos - Importante para resetar Contas Fixas)
        const DEBT_LIST_INITIAL = [
             { id: 1, credor: "Itau visa", valorInicial: 200.00, valorAtual: 200.00 },
             { id: 2, credor: "Banco Inter", valorInicial: 120.00, valorAtual: 120.00 },
             { id: 3, credor: "Conect car", valorInicial: 60.00, valorAtual: 60.00 },
             { id: 4, credor: "Vivo", valorInicial: 95.00, valorAtual: 95.00 },
             { id: 5, credor: "Banco Pan", valorInicial: 265.00, valorAtual: 265.00 },
             { id: 6, credor: "Karen", valorInicial: 300.00, valorAtual: 300.00 },
             { id: 7, credor: "Claro", valorInicial: 300.00, valorAtual: 300.00 },
             { id: 8, credor: "Bruno Carro", valorInicial: 400.00, valorAtual: 400.00 },
             { id: 9, credor: "Mercado pago", valorInicial: 522.00, valorAtual: 522.00 },
             { id: 10, credor: "Koin", valorInicial: 700.00, valorAtual: 700.00 },
             { id: 11, credor: "Will bank", valorInicial: 700.00, valorAtual: 700.00 },
             { id: 12, credor: "Picpay", valorInicial: 859.64, valorAtual: 859.64 },
             { id: 13, credor: "Carol", valorInicial: 1000.00, valorAtual: 1000.00 },
             { id: 14, credor: "Localiza", valorInicial: 1200.00, valorAtual: 1200.00 },
             { id: 15, credor: "Light", valorInicial: 1450.00, valorAtual: 1450.00 },
             { id: 16, credor: "Casa", valorInicial: 1650.00, valorAtual: 1650.00 },
             { id: 17, credor: "Bradesco", valorInicial: 2000.00, valorAtual: 2000.00 },
             { id: 18, credor: "Itau master", valorInicial: 2500.00, valorAtual: 2500.00 },
             { id: 19, credor: "Carro", valorInicial: 3500.00, valorAtual: 3500.00 },
             { id: 20, credor: "Ravi", valorInicial: 4570.00, valorAtual: 4570.00 },
        ].sort((a, b) => a.valorAtual - b.valorAtual);
        
        const CONTAS_FIXAS_INITIAL = [
            { id: 100, nome: "Carro", valor: 1800.00, pago: false },
            { id: 101, nome: "Aluguel", valor: 850.00, pago: false },
            { id: 102, nome: "Academia", valor: 300.00, pago: false },
            { id: 103, nome: "Luz", valor: 250.00, pago: false },
            { id: 104, nome: "Internet Movel", valor: 120.00, pago: false },
            { id: 105, nome: "Wifi", valor: 100.00, pago: false }
        ].sort((a, b) => b.valor - a.valor);
        
        let idDebtQuitting = null; 
        
        // ===========================================
        // FUN√á√ïES UTILIT√ÅRIAS DE DADOS
        // ===========================================
        
        const formatarMoeda = (valor) => {
            return parseFloat(valor).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        };

        const formatarData = (dataString) => {
            if (!dataString) return 'N/A';
            const [year, month, day] = dataString.split('-');
            return `${day}/${month}/${year}`;
        }
        
        const getHojeString = () => new Date().toISOString().slice(0, 10);
        
        const getPrimeiroDiaDoMesString = (data = new Date()) => new Date(data.getFullYear(), data.getMonth(), 1).toISOString().slice(0, 10);
        
        // --- Fun√ß√µes de Carregamento/Salvamento (Garantem que os dados s√£o arrays) ---
        
        const carregarContasFixas = () => {
            const fixas = localStorage.getItem('contasFixas');
            if (!fixas) return CONTAS_FIXAS_INITIAL;
            
            // Garantir que os IDs sejam Number ao carregar
            const loadedFixas = JSON.parse(fixas);
            return loadedFixas.map(f => ({ ...f, id: parseInt(f.id) }));
        };
        
        const salvarContasFixas = (fixas) => localStorage.setItem('contasFixas', JSON.stringify(fixas));
        
        const carregarTransacoes = () => {
            const transacoes = localStorage.getItem('transacoes');
            return transacoes ? JSON.parse(transacoes) : [];
        };

        const salvarTransacoes = (transacoes) => localStorage.setItem('transacoes', JSON.stringify(transacoes));
        
        const carregarDividas = () => {
            const dividas = localStorage.getItem('dividas');
            if (!dividas) {
                salvarDividas(DEBT_LIST_INITIAL);
                return DEBT_LIST_INITIAL;
            }
            // Garantir que os IDs sejam Number ao carregar
            const loadedDebts = JSON.parse(dividas).map(d => ({ ...d, id: parseInt(d.id) }));
            loadedDebts.sort((a, b) => a.valorAtual - b.valorAtual);
            return loadedDebts;
        }
        
        const salvarDividas = (dividas) => {
             dividas.sort((a, b) => a.valorAtual - b.valorAtual);
             localStorage.setItem('dividas', JSON.stringify(dividas));
        }

        const getSomaFixas = (fixas) => fixas.reduce((sum, item) => sum + item.valor, 0);
        const getMetaDiariaFixas = (somaFixas) => somaFixas / DIAS_UTEIS_MES;

        const getReceitasPorDia = (transacoes) => {
             const receitasDiarias = {};
             transacoes.filter(t => parseFloat(t.valor) > 0).forEach(t => { 
                 const data = t.data;
                 // Usamos toFixed(2) para lidar com precis√£o de floating point na soma
                 receitasDiarias[data] = (receitasDiarias[data] || 0) + parseFloat(t.valor);
             });
             return receitasDiarias;
        }
        
        const getTotais = (transacoes, dividas) => {
            // Soma todas as transa√ß√µes (Entradas positivas, Sa√≠das Fixas/D√≠vidas negativas)
            let totalReceitas = transacoes.reduce((sum, t) => sum + parseFloat(t.valor), 0); 
            // O Capital Acumulado nunca deve ser negativo na exibi√ß√£o, apesar do log interno
            totalReceitas = Math.max(0, totalReceitas);

            const totalDividasIniciais = DEBT_LIST_INITIAL.reduce((sum, d) => sum + d.valorInicial, 0);
            const totalDividasPendentes = dividas.filter(d => d.valorAtual > 0.01).reduce((sum, d) => sum + parseFloat(d.valorAtual), 0);
            
            // L√≥gica de c√°lculo da barra de progresso (D√≠vidas quitadas / D√≠vidas totais)
            const totalPagoDividas = totalDividasIniciais - totalDividasPendentes;
            const progressoCapital = totalDividasIniciais > 0.01 
                ? (totalPagoDividas / totalDividasIniciais) * 100 
                : (totalDividasPendentes === 0 ? 100 : 0);
            
            const saldoPendenteTotal = totalDividasPendentes; 

            return { totalReceitas, totalDividasIniciais, totalDividasPendentes, progressoCapital, saldoPendenteTotal };
        }
        
        // ===========================================
        // FUN√á√ïES DE SESS√ÉO E SEGURAN√áA
        // ===========================================
        
        const startSessionTimer = () => {
             if (sessionTimer) clearTimeout(sessionTimer);
             sessionTimer = setTimeout(logOut, SESSION_TIMEOUT_MS);
        }
        
        const resetSessionTimer = () => startSessionTimer();
        
        const logOut = () => {
            clearTimeout(sessionTimer);
            localStorage.removeItem('loggedIn');
            alert("Sess√£o expirada. Por favor, fa√ßa login novamente.");
            window.location.reload(); 
        }
        
        // ===========================================
        // L√ìGICA DE NEG√ìCIO: CONTAS FIXAS
        // ===========================================
        
        /**
         * CORRE√á√ÉO V3.4: Verifica se o reset das fixas j√° foi feito no m√™s atual.
         */
        const checkAndResetContasFixas = () => {
            let fixas = carregarContasFixas();
            const hoje = getHojeString();
            const lastResetFixas = localStorage.getItem('lastResetFixas');
            
            // Verifica se o m√™s atual √© diferente do m√™s do √∫ltimo reset
            const isNovoMes = lastResetFixas ? lastResetFixas.substring(0, 7) !== hoje.substring(0, 7) : true;

            if (isNovoMes) {
                 // For√ßa o reset para o estado inicial, marcando todas como n√£o pagas
                 fixas = CONTAS_FIXAS_INITIAL.map(f => ({ ...f, pago: false }));
                 salvarContasFixas(fixas);
                 localStorage.setItem('lastResetFixas', hoje); // Marca o reset para o m√™s atual
                 console.log("Contas Fixas resetadas para o novo ciclo mensal.");
            }
            return fixas;
        };

        const verificarEstadoContasFixas = (fixas) => {
             const todasPagas = fixas.every(f => f.pago);
             
             const contasFixasToggle = document.getElementById('contas-fixas-toggle');
             const feedbackFixasQuitadasEl = document.getElementById('feedback-fixas-quitadas');

             contasFixasToggle.style.display = todasPagas ? 'none' : 'block';
             feedbackFixasQuitadasEl.style.display = todasPagas ? 'block' : 'none';
        }

        const pagarContaFixa = (id) => {
            let fixas = carregarContasFixas();
            const transacoes = carregarTransacoes();
            const { totalReceitas } = getTotais(transacoes, carregarDividas());
            
            const conta = fixas.find(f => f.id === parseInt(id));
            
            if (!conta || conta.pago) return;

            // Ajuste de precis√£o para checagem (permite pagar se o capital for igual ou maior)
            if (totalReceitas < conta.valor - 0.009) {
                 alert(`ERRO: Capital insuficiente (${formatarMoeda(totalReceitas)}) para pagar a conta ${conta.nome} (${formatarMoeda(conta.valor)}).`);
                 return;
            }
            
            if (!confirm(`Confirma o pagamento de ${formatarMoeda(conta.valor)} para ${conta.nome}? O valor ser√° deduzido imediatamente do Capital Acumulado.`)) {
                return;
            }

            // 1. DEDU√á√ÉO DO SALDO ACUMULADO
            const novaTransacaoSaida = {
                tipo: 'SAIDA_FIXA',
                valor: (-conta.valor).toFixed(2), 
                descricao: `Pgto: ${conta.nome}`, 
                data: getHojeString()
            };
            let transacoesSalvas = carregarTransacoes();
            transacoesSalvas.push(novaTransacaoSaida);
            salvarTransacoes(transacoesSalvas);

            // 2. ATUALIZA√á√ÉO DO STATUS DA CONTA FIXA
            const index = fixas.findIndex(f => f.id === parseInt(id));
            if (index !== -1) {
                fixas[index].pago = true;
            }
            salvarContasFixas(fixas);

            // alert(`Pagamento de ${conta.nome} conclu√≠do. ${formatarMoeda(conta.valor)} deduzido.`);
            initDashboard();
        }

        // ===========================================
        // L√ìGICA DE NEG√ìCIO: QUITA√á√ÉO E DASHBOARD
        // ===========================================

        const gerarPlanoQuitacaoIA = (isInit = false, totalDividasPendentes) => {
             const meses = parseInt(document.getElementById('meses-plano').value) || 5;
            
             if (totalDividasPendentes <= 0.01) {
                 if (!isInit) {
                      document.getElementById('resultado-plano-ia').innerHTML = '<p style="color: var(--cor-sucesso); font-weight: bold; margin-top: 15px;"><i class="fas fa-check-circle"></i> Protocolo de d√≠vida conclu√≠do. Foco em acumula√ß√£o de capital!</p>';
                 }
                 return 0;
             }

             const valorMensalNecessario = totalDividasPendentes / meses;
             // Usamos 30 dias como estimativa para c√°lculo de aporte di√°rio
             const valorDiarioNecessario = valorMensalNecessario / 30; 

             if (!isInit) {
                  const valorSemanalNecessario = valorDiarioNecessario * 7;
                  let html = `
                     <p style="margin-bottom: 15px; color: var(--cor-texto-secundario); font-family: var(--fonte-titulo); font-weight: 600;">Para quitar **${formatarMoeda(totalDividasPendentes)}** em **${meses} meses**:</p>
                     <p><i class="fas fa-calendar-alt" style="color: var(--cor-primario);"></i> Aporte Mensal Necess√°rio: <strong>${formatarMoeda(valorMensalNecessario)}</strong></p>
                     <p><i class="fas fa-calendar-week" style="color: var(--cor-primario);"></i> Aporte Semanal Necess√°rio: <strong>${formatarMoeda(valorSemanalNecessario)}</strong></p>
                     <p><i class="fas fa-sun" style="color: var(--cor-primario);"></i> Aporte Di√°rio Necess√°rio: <strong>${formatarMoeda(valorDiarioNecessario)}</strong></p>
                  `;
                  document.getElementById('resultado-plano-ia').innerHTML = html;
             }
            
             return valorDiarioNecessario; 
         };

        const getMetaDiariaAtingida = (transacoes, totalDividasPendentes, fixas, dataAlvo = getHojeString()) => {
            const somaFixas = getSomaFixas(fixas);
            const metaDiariaFixas = getMetaDiariaFixas(somaFixas);
            
            const receitasDiarias = getReceitasPorDia(transacoes);
            
            const metaQuitacaoDiaria = gerarPlanoQuitacaoIA(true, totalDividasPendentes); 
            const metaTotalDiaria = metaDiariaFixas + metaQuitacaoDiaria;
            
            const recebido = receitasDiarias[dataAlvo] || 0;
            // O valor atingido √© o recebido, limitando ao m√≠nimo de 0
            const faltando = Math.max(0, metaTotalDiaria - recebido);

            return {
                metaTotal: metaTotalDiaria,
                // Atingido se o recebido for maior ou igual √† meta (com margem de erro)
                atingido: recebido >= metaTotalDiaria - 0.009,
                recebido: recebido,
                faltando: faltando
            };
        }
        
        const atualizarDashboard = (transacoes, dividas, fixas) => {
            const { totalReceitas, totalDividasPendentes, progressoCapital, saldoPendenteTotal } = getTotais(transacoes, dividas);
            const somaFixas = getSomaFixas(fixas);
            
            document.getElementById('data-atual').textContent = new Date().toLocaleDateString('pt-BR');
            // Remove R$ e espa√ßos para a exibi√ß√£o dentro do t√≠tulo do toggle
            document.getElementById('soma-fixas').textContent = formatarMoeda(somaFixas).replace('R$', '').trim(); 

            document.getElementById('total-lancado').textContent = formatarMoeda(totalReceitas); 
            document.getElementById('saldo-pendente-total').textContent = formatarMoeda(saldoPendenteTotal);
            document.getElementById('total-dividas-pendentes').textContent = formatarMoeda(totalDividasPendentes);
            
            const progressoExibido = Math.min(100, progressoCapital).toFixed(2);
            document.getElementById('progresso-capital-txt').textContent = `${progressoExibido}%`;
            // A barra de progresso agora se move corretamente de acordo com a porcentagem de d√≠vida paga.
            document.getElementById('progresso-bar').style.width = `${progressoExibido}%`;
            
            verificarEstadoContasFixas(fixas);
        };
        
        // ===========================================
        // FUN√á√ïES DE RENDERIZA√á√ÉO
        // ===========================================
        
        const renderizarContasFixas = (fixas) => {
            const listaContasFixasEl = document.getElementById('lista-contas-fixas');
            listaContasFixasEl.innerHTML = '';
            
            const somaFixas = getSomaFixas(fixas);
            const metaDiariaFixas = getMetaDiariaFixas(somaFixas);
            const transacoes = carregarTransacoes();
            const { totalReceitas } = getTotais(transacoes, carregarDividas());
            
            let html = `
                <li>TARGET DI√ÅRIO (FIXAS / ${DIAS_UTEIS_MES} dias): <span class="diaria-fixa-destaque">${formatarMoeda(metaDiariaFixas)}</span></li>
                <li>TOTAL GERAL FIXAS M√äS (META): <span style="color: var(--cor-fixa);">${formatarMoeda(somaFixas)}</span></li>
            `;
            
            fixas.forEach(conta => {
                 // Deve-se permitir pagar se tiver capital suficiente (margem de erro para floats)
                 const podePagar = totalReceitas >= conta.valor - 0.009; 
                 const classeBotao = conta.pago ? 'pago' : (podePagar ? '' : 'inativo');
                 const textoBotao = conta.pago ? 'PAGO' : 'PAGAR';
                 const disabled = conta.pago || !podePagar ? 'disabled' : '';

                 html += `
                    <li>
                        ${conta.nome}: <span>${formatarMoeda(conta.valor)}</span>
                        <button class="btn-pagar-fixa ${classeBotao}" data-id="${conta.id}" ${disabled}>
                            <i class="fas ${conta.pago ? 'fa-check' : 'fa-hand-holding-usd'}"></i> ${textoBotao}
                        </button>
                    </li>
                 `;
            });
            
            listaContasFixasEl.innerHTML = html;
        }

        const renderizarTabelas = (transacoes, dividas) => {
            const listaEntradasBody = document.getElementById('lista-entradas');
            const listaDividasBody = document.getElementById('lista-dividas-quitar');
            const { totalReceitas } = getTotais(transacoes, dividas);
            
            const transacoesEntrada = transacoes.filter(t => parseFloat(t.valor) > 0);
            // Mapeia para adicionar um √≠ndice de exibi√ß√£o est√°vel antes de ordenar
            const transacoesOrdenadas = transacoesEntrada.map((t, index) => ({...t, displayIndex: index}))
                                                        .sort((a, b) => new Date(b.data) - new Date(a.data));
            
            // --- Renderiza√ß√£o das Receitas (LOG) ---
            listaEntradasBody.innerHTML = '';
            if (transacoesOrdenadas.length === 0) {
                 listaEntradasBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--cor-texto-secundario);">Nenhuma receita lan√ßada no log.</td></tr>';
            } else {
                transacoesOrdenadas.forEach((t) => {
                    const row = listaEntradasBody.insertRow();
                    row.innerHTML = `
                        <td><span class="sucesso-adicionado">SALDO ADICIONADO</span></td>
                        <td class="valor-caixa">${formatarMoeda(t.valor)}</td>
                        <td>${formatarData(t.data)}</td>
                        <td><button class="btn-acao-tabela deletar" data-index="${t.displayIndex}"><i class="fas fa-trash"></i> EXCLUIR</button></td>
                    `;
                });
            }
            
            // --- Renderiza√ß√£o das D√≠vidas ---
            listaDividasBody.innerHTML = '';
            const dividasAtivas = dividas.filter(d => d.valorAtual > 0.01);
            
            if (dividasAtivas.length === 0) {
                 listaDividasBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--cor-sucesso); font-weight: bold;">üéâ PROTOCOL COMPLETE: Todas as d√≠vidas √∫nicas foram quitadas!</td></tr>';
            } else {
                dividasAtivas.forEach((d) => {
                    // L√≥gica de ativa√ß√£o do bot√£o revisada (Capital >= D√≠vida, com margem de erro)
                    const podeQuitar = (totalReceitas >= d.valorAtual - 0.009); 
                    
                    const botaoHTML = podeQuitar 
                        ? `<button class="btn-acao-tabela quitar" data-id="${d.id}"><i class="fas fa-hand-holding-usd"></i> PAGAR</button>`
                        : `<button class="btn-acao-tabela btn-inativo-capital" disabled title="Capital (${formatarMoeda(totalReceitas)}) insuficiente para cobrir o Saldo da D√≠vida (${formatarMoeda(d.valorAtual)}).">PENDENTE</button>`;

                    const row = listaDividasBody.insertRow();
                    row.innerHTML = `
                        <td>${d.credor}</td>
                        <td style="color: var(--cor-texto-secundario);">${formatarMoeda(d.valorInicial)}</td>
                        <td class="saldo-divida">${formatarMoeda(d.valorAtual)}</td>
                        <td>${botaoHTML}</td>
                    `;
                });
            }
        };

        const renderizarMetaDiaria = (transacoes, totalDividasPendentes, fixas) => {
             const { metaTotal, atingido, recebido, faltando } = getMetaDiariaAtingida(transacoes, totalDividasPendentes, fixas, getHojeString());
             
             const metaDiariaTotalEl = document.getElementById('meta-diaria-total-el');
             const metaDiariaCard = document.getElementById('meta-diaria-card');
             const metaDiariaIncentivoEl = document.getElementById('meta-diaria-incentivo');
            
             metaDiariaTotalEl.textContent = formatarMoeda(metaTotal);
             metaDiariaCard.style.border = atingido ? `1px solid var(--cor-sucesso)` : `1px solid var(--cor-meta-diaria)`;

             if (atingido) {
                 metaDiariaIncentivoEl.style.display = 'block';
                 metaDiariaIncentivoEl.textContent = `üéØ META DI√ÅRIA BATIDA! Capital Extra: ${formatarMoeda(recebido - metaTotal)}`;
                 metaDiariaIncentivoEl.style.color = 'var(--cor-sucesso)';
             } else {
                 metaDiariaIncentivoEl.style.display = 'block';
                 metaDiariaIncentivoEl.textContent = `üö® FALTAM ${formatarMoeda(faltando)} PARA BATER A META DI√ÅRIA.`;
                 metaDiariaIncentivoEl.style.color = 'var(--cor-alerta)';
             }
        }
        
        const renderizarDicasQuitacao = (dividas) => {
             const dividasAtivas = dividas.filter(d => d.valorAtual > 0.01);
             const dicasEl = document.getElementById('dicas-quitacao');
             
             if (dividasAtivas.length === 0) {
                 dicasEl.innerHTML = '<h4>ESTRAT√âGIA DE CAPITAL</h4><p style="color: var(--cor-sucesso);"><i class="fas fa-gem"></i> Nenhuma d√≠vida a rastrear. Mantenha o foco em acumula√ß√£o de capital e investimentos.</p>';
                 return;
             }
             
             let html = `
                 <h4>ESTRAT√âGIA: BOLA DE NEVE (MENOR PARA MAIOR)</h4>
                 <p style="font-size: 0.9em; margin-bottom: 10px; color: var(--cor-texto-secundario);">
                    Priorize as menores d√≠vidas para criar impulso r√°pido no protocolo de quita√ß√£o.
                 </p>
                 <ul style="list-style: none; padding-left: 10px;">
             `;
             
             // Cria uma c√≥pia e ordena para garantir que as 3 exibidas sejam as 3 menores
             dividasAtivas.slice().sort((a, b) => a.valorAtual - b.valorAtual).slice(0, 3).forEach((d, index) => {
                 html += `<li>**PRIORIDADE ${index + 1}:** ${d.credor} (Saldo: ${formatarMoeda(d.valorAtual)})</li>`;
             });
             
             html += `
                 </ul>
                 <p style="font-size: 0.85em; margin-top: 15px; color: var(--cor-alerta);">
                    *A√ß√£o: Direcione todo o excedente para a d√≠vida **PRIORIDADE 1**.*
                 </p>
             `;
             dicasEl.innerHTML = html;
        }
        
        // ===========================================
        // INICIALIZA√á√ÉO E EVENTOS
        // ===========================================
        
        const initDashboard = () => {
            const transacoes = carregarTransacoes();
            const dividas = carregarDividas();
            
            // L√≥gica de reset das fixas centralizada e corrigida
            const fixas = checkAndResetContasFixas(); 
            
            const { totalDividasPendentes } = getTotais(transacoes, dividas);
            
            atualizarDashboard(transacoes, dividas, fixas);
            renderizarContasFixas(fixas); 
            renderizarTabelas(transacoes, dividas);
            
            // Recalcula o plano IA com a informa√ß√£o de d√≠vidas pendentes
            gerarPlanoQuitacaoIA(false, totalDividasPendentes); 
            renderizarMetaDiaria(transacoes, totalDividasPendentes, fixas);
            renderizarDicasQuitacao(dividas); 
        };
        
        const handleLogin = () => {
            const passwordInput = document.getElementById('password-input').value;
            const loginFeedback = document.getElementById('login-feedback');
            
            if (passwordInput === LOGIN_PASSWORD) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                localStorage.setItem('loggedIn', 'true');
                startSessionTimer(); 
                initDashboard();
            } else {
                loginFeedback.textContent = 'ERRO: CHAVE DE SEGURAN√áA INV√ÅLIDA.';
                document.getElementById('password-input').value = '';
                document.getElementById('password-input').focus();
            }
        };

        const fecharModal = (modalEl) => modalEl.style.display = 'none';
        
        const toggleSection = (container, button) => {
            const isOculta = container.style.display === 'none';
            container.style.display = isOculta ? 'block' : 'none';
            button.classList.toggle('aberto', isOculta);
        };

        const adicionarReceita = () => {
             const valor = parseFloat(document.getElementById('valor-input-receita').value);

             if (isNaN(valor) || valor <= 0) {
                 alert("ERRO: Valor de aporte inv√°lido. Insira um valor positivo.");
                 return;
             }

             const novaTransacao = {
                 tipo: 'ENTRADA',
                 valor: valor.toFixed(2), 
                 descricao: 'SALDO ADICIONADO',
                 data: getHojeString()
             };

             let transacoes = carregarTransacoes();
             transacoes.push(novaTransacao);
             salvarTransacoes(transacoes);
            
             initDashboard(); 
             fecharModal(document.getElementById('modal-receita')); 
        };
        
        const iniciarQuitarDivida = (id) => {
             const dividas = carregarDividas();
             // ID j√° √© Number, n√£o precisa de parseInt
             const divida = dividas.find(d => d.id === id); 
             const transacoes = carregarTransacoes();
             const { totalReceitas } = getTotais(transacoes, dividas);

             if (!divida || divida.valorAtual <= 0.01) {
                 alert("STATUS: D√≠vida j√° quitada.");
                 return;
             }
            
             // L√≥gica de ativa√ß√£o do bot√£o revisada (Capital >= D√≠vida, com margem de erro)
             const podeQuitar = (totalReceitas >= divida.valorAtual - 0.009);
            
             if (!podeQuitar) {
                 alert("ERRO DE PROTOCOLO: Capital Acumulado insuficiente para cobrir o Saldo da D√≠vida.");
                 return;
             }
            
             idDebtQuitting = id;
             document.getElementById('nome-credor').textContent = divida.credor;
             document.getElementById('saldo-quitacao').textContent = formatarMoeda(divida.valorAtual);
            
             document.getElementById('valor-pagamento').value = divida.valorAtual.toFixed(2);
             document.getElementById('valor-pagamento').focus();
            
             document.getElementById('modal-quitacao').style.display = 'block';
        }
        
        const registrarPagamento = () => {
             const valorPagamento = parseFloat(document.getElementById('valor-pagamento').value);
             const dividas = carregarDividas();
             let divida = dividas.find(d => d.id === idDebtQuitting);
             let transacoes = carregarTransacoes();
             const { totalReceitas } = getTotais(transacoes, dividas);
            
             if (isNaN(valorPagamento) || valorPagamento <= 0) {
                 alert("ERRO: Insira um valor de pagamento v√°lido e positivo.");
                 return;
             }
            
             if (!divida) {
                 alert("ERRO: D√≠vida n√£o encontrada no registro.");
                 return;
             }
            
             // O pagamento n√£o pode ser maior que o saldo atual da d√≠vida.
             let valorEfetivo = Math.min(valorPagamento, divida.valorAtual);
            
             // Re-verifica√ß√£o da regra estrita no momento do pagamento (Capital >= Valor a Pagar, com margem de erro)
             const podePagar = (totalReceitas >= valorEfetivo - 0.009);

             if (!podePagar) {
                  alert("ERRO CR√çTICO: O Capital Acumulado √© insuficiente para esta transa√ß√£o. Transa√ß√£o abortada.");
                  return;
             }
            
             // 1. DEDU√á√ÉO DO SALDO ACUMULADO 
             const novaTransacaoSaida = {
                 tipo: 'SAIDA_DIVIDA',
                 valor: (-valorEfetivo).toFixed(2), 
                 descricao: `Quita√ß√£o: ${divida.credor}`, 
                 data: getHojeString()
             };
             transacoes.push(novaTransacaoSaida);
             salvarTransacoes(transacoes);

             // 2. ATUALIZA√á√ÉO DA D√çVIDA
             divida.valorAtual = divida.valorAtual - valorEfetivo;
             divida.valorAtual = Math.max(0, divida.valorAtual); // Garante que n√£o fique negativo
            
             // Encontra o √≠ndice da d√≠vida no array para salvar a altera√ß√£o
             const index = dividas.findIndex(d => d.id === idDebtQuitting);
             if (index !== -1) {
                 dividas[index] = divida;
             }

             if (divida.valorAtual < 0.01) {
                 alert(`üéâ SUCESSO! D√≠vida com ${divida.credor} quitada!`);
             } else {
                  alert(`SUCESSO! Pagamento de ${formatarMoeda(valorEfetivo)} registrado e deduzido.`);
             }
            
             salvarDividas(dividas);
             initDashboard();
             fecharModal(document.getElementById('modal-quitacao'));
        }
        
        // ===========================================
        // EVENT LISTENERS GLOBAIS
        // ===========================================
        
        // Listener para intera√ß√£o (reseta o timer da sess√£o)
        document.addEventListener('mousemove', resetSessionTimer);
        document.addEventListener('keypress', resetSessionTimer);
        document.addEventListener('click', resetSessionTimer); 

        // Login
        document.getElementById('btn-login').addEventListener('click', handleLogin);
        document.getElementById('password-input').addEventListener('keypress', (e) => {
             if (e.key === 'Enter') handleLogin();
        });
        
        // Cadastro Receita
        document.getElementById('abrir-cadastro-receita').addEventListener('click', () => {
             document.getElementById('valor-input-receita').value = '';
             document.getElementById('modal-receita').style.display = 'block';
             document.getElementById('valor-input-receita').focus();
        });
        document.getElementById('fechar-modal-receita').addEventListener('click', () => fecharModal(document.getElementById('modal-receita')));
        document.getElementById('btn-cadastrar-receita').addEventListener('click', adicionarReceita); 
        
        // Quita√ß√£o D√≠vida
        document.getElementById('fechar-modal-quitacao').addEventListener('click', () => fecharModal(document.getElementById('modal-quitacao')));
        document.getElementById('btn-quitar-divida').addEventListener('click', registrarPagamento);
        
        // Plano IA
        document.getElementById('btn-gerar-plano').addEventListener('click', () => {
             const fixas = carregarContasFixas();
             const { totalDividasPendentes } = getTotais(carregarTransacoes(), carregarDividas());
             gerarPlanoQuitacaoIA(false, totalDividasPendentes); 
             renderizarMetaDiaria(carregarTransacoes(), totalDividasPendentes, fixas); 
        });

        // Toggle Event Listeners
        document.getElementById('toggle-dividas').addEventListener('click', () => toggleSection(document.getElementById('lista-dividas-quitar-container'), document.getElementById('toggle-dividas')));
        document.getElementById('toggle-receitas').addEventListener('click', () => toggleSection(document.getElementById('lista-receitas-container'), document.getElementById('toggle-receitas')));
        document.getElementById('toggle-fixas').addEventListener('click', () => toggleSection(document.getElementById('lista-fixas-container'), document.getElementById('toggle-fixas')));

        // Dele√ß√£o, Quita√ß√£o e Pagamento Fixas
        document.addEventListener('click', (e) => {
             // 1. Deletar Receita (Log)
             if (e.target.closest('.btn-acao-tabela.deletar')) {
                 if (!confirm("ALERTA: Confirme a exclus√£o do registro de receita. Esta a√ß√£o √© irrevers√≠vel e o Capital Acumulado ser√° ajustado.")) { return; }
                 
                 let transacoesSalvas = carregarTransacoes();
                 // Pega apenas as transa√ß√µes de ENTRADA, ordenadas como na tela
                 const transacoesEntrada = transacoesSalvas.filter(t => parseFloat(t.valor) > 0)
                                                          .sort((a, b) => new Date(b.data) - new Date(a.data));
                                                          
                 const dataIndex = parseInt(e.target.closest('.btn-acao-tabela.deletar').getAttribute('data-index'));
                 const transacaoParaDeletar = transacoesEntrada[dataIndex];
                 
                 // Encontra o √≠ndice real no array completo para exclus√£o
                 const originalIndex = transacoesSalvas.findIndex(t => 
                     t.data === transacaoParaDeletar.data && 
                     t.valor === transacaoParaDeletar.valor && 
                     t.descricao === transacaoParaDeletar.descricao &&
                     t.tipo === 'ENTRADA'
                 );

                 if (originalIndex !== -1) {
                      transacoesSalvas.splice(originalIndex, 1);
                      salvarTransacoes(transacoesSalvas);
                 }
                 initDashboard();
             }
            
             // 2. Iniciar Pagar D√≠vida √önica
             if (e.target.closest('.btn-acao-tabela.quitar')) {
                 // ID j√° √© tratado como Number ao carregar, mas vem como string do data-id.
                 const id = parseInt(e.target.closest('.btn-acao-tabela.quitar').getAttribute('data-id'));
                 iniciarQuitarDivida(id);
             }
             
             // 3. Pagar Conta Fixa Individual
             if (e.target.closest('.btn-pagar-fixa:not([disabled])')) {
                 const id = parseInt(e.target.closest('.btn-pagar-fixa').getAttribute('data-id'));
                 pagarContaFixa(id);
             }
        });
        
        // Inicializa√ß√£o ao carregar
        document.addEventListener('DOMContentLoaded', () => {
             // Estilos de login para o modal de login (fora da tela principal)
             const loginBox = document.querySelector('.login-box');
             loginBox.style.border = `2px solid var(--cor-primario)`; 
             loginBox.style.boxShadow = `var(--sombra-card-hover)`;

             if (localStorage.getItem('loggedIn') === 'true') {
                 document.getElementById('login-screen').style.display = 'none';
                 document.getElementById('main-content').style.display = 'block';
                 startSessionTimer(); 
                 initDashboard();
             } else {
                 document.getElementById('login-screen').style.display = 'flex';
             }
        });
        

    </script>
</body>
</html>
