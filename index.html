<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROJECT TITAN | CORE FINANCIAL [V4.9 - Din√¢mico]</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* =================================== */
        /* 1. VARI√ÅVEIS CSS E BASE (FUTURE NOIR)*/
        /* =================================== */
        :root {
            /* Fundo Escuro Classudo */
            --cor-fundo-principal: #0E1117; 
            --cor-fundo-card: rgba(20, 25, 33, 0.9); 
            --cor-borda: #2C3540; 
            --cor-texto-principal: #F0F6FC; 
            --cor-texto-secundario: #8B949E; 
            
            /* Cores de Destaque Futuristas */
            --cor-sucesso: #10B981; 
            --cor-divida: #EF4444; 
            --cor-primario: #00BCD4; 
            --cor-meta-diaria: #9B59B6; 
            --cor-alerta: #F59E0B; 
            --cor-fixa: #1DE9B6; 
            --cor-fundo-ia: #151A23; 
            --cor-destaque-ia: #FFD700; 

            /* Tipografia */
            --fonte-titulo: 'Inter', sans-serif;
            --fonte-corpo: 'Inter', sans-serif;
            --fonte-dados: 'Space Mono', monospace; 
            
            /* Efeitos */
            --sombra-card: 0 4px 20px rgba(0, 0, 0, 0.5), inset 0 0 0 1px var(--cor-borda);
            --sombra-card-hover: 0 6px 30px rgba(0, 0, 0, 0.7), inset 0 0 0 2px var(--cor-primario);
            --transicao-rapida: 0.3s ease-in-out;
            --espacamento-mobile: 15px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: var(--fonte-corpo);
        }

        body {
            background-color: var(--cor-fundo-principal);
            color: var(--cor-texto-principal);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-image: radial-gradient(circle at 50% 50%, rgba(0, 188, 212, 0.05), transparent 80%);
        }

        .container {
            max-width: 1300px; 
            margin: 40px auto;
            padding: 0 25px;
            width: 100%;
        }
        
        /* =================================== */
        /* 2. HEADER E BEM-VINDO */
        /* =================================== */

        .dynamic-banner {
            width: 100%;
            background-color: #000000;
            color: var(--cor-fixa); 
            padding: 10px 0;
            text-align: right;
            border-bottom: 2px solid var(--cor-fixa);
            box-shadow: 0 5px 20px rgba(29, 233, 182, 0.3);
            overflow: hidden; 
            white-space: nowrap; 
        }
        
        .banner-text {
            font-family: var(--fonte-dados);
            font-size: 1.1em;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            padding-right: 30px;
            display: inline-block;
            white-space: nowrap; 
            animation: moveBanner 10s linear infinite; 
        }
        
        @keyframes moveBanner {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .header-content {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 0 25px;
             max-width: 1300px; 
             margin: 30px auto 0;
        }

        h1 {
            font-family: var(--fonte-titulo);
            color: var(--cor-texto-principal);
            font-weight: 800;
            font-size: 3em; 
            letter-spacing: 2px;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
        }
        
        /* Mensagem de Boas-vindas */
        #welcome-message {
            max-width: 1300px;
            margin: 0 auto;
            padding: 0 25px;
            color: var(--cor-primario);
            font-weight: 700;
            font-size: 1.5em;
            margin-top: 10px;
            margin-bottom: 20px;
        }

        /* Bot√µes de A√ß√£o Geral (Cadastro) */
        .btn-principal {
            background-color: var(--cor-primario);
            color: var(--cor-fundo-principal);
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 700;
            transition: all var(--transicao-rapida);
            white-space: nowrap;
        }
        .btn-principal:hover {
            background-color: #00A3B5;
            box-shadow: 0 0 8px rgba(0, 188, 212, 0.7);
        }
        
        /* Bot√£o de Menu Hamburger */
        #menu-toggle {
            font-size: 1.8em;
            cursor: pointer;
            color: var(--cor-primario);
            transition: color var(--transicao-rapida);
        }
        #menu-toggle:hover {
            color: #00A3B5;
        }

        /* Bot√£o de Rastreio de Metas (DATA) */
        #data-atual-info {
             text-align: center;
             margin-top: 15px;
             margin-bottom: 25px;
        }
        #btn-data-atual {
             background-color: var(--cor-meta-diaria);
             color: var(--cor-texto-principal);
             border: none;
             padding: 12px 25px;
             border-radius: 6px;
             cursor: pointer;
             font-weight: 700;
             font-family: var(--fonte-dados);
             font-size: 1.1em; 
             transition: all var(--transicao-rapida);
             box-shadow: 0 2px 10px rgba(155, 89, 182, 0.5);
        }
        #btn-data-atual:hover {
             background-color: #A96EC2;
             box-shadow: 0 0 15px rgba(155, 89, 182, 0.8);
        }

        
        /* =================================== */
        /* 3. SIDEBAR (MENU HAMBURGER) */
        /* =================================== */

        .sidebar {
            height: 100%; 
            width: 0; 
            position: fixed; 
            z-index: 1010; 
            top: 0;
            right: 0;
            background-color: var(--cor-fundo-card);
            overflow-x: hidden; 
            transition: 0.5s; 
            padding-top: 60px;
            border-left: 3px solid var(--cor-primario);
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.8);
        }

        .sidebar-header {
             padding: 15px 25px;
             text-align: center;
             border-bottom: 1px solid var(--cor-borda);
             margin-bottom: 20px;
        }
        .sidebar-header h3 {
             color: var(--cor-fixa);
             margin-top: 20px;
        }
        
        /* Foto de Perfil */
        .profile-pic-area {
             position: relative;
             width: 100px;
             margin: 0 auto;
             height: 100px;
        }
        
        .profile-pic-container {
             width: 100px;
             height: 100px;
             border-radius: 50%;
             overflow: hidden;
             border: 3px solid var(--cor-primario);
             cursor: pointer;
             background-color: #1A212E;
             display: flex;
             justify-content: center;
             align-items: center;
             transition: transform var(--transicao-rapida);
        }
        .profile-pic-container:hover {
             transform: scale(1.05);
        }
        .profile-pic-container img {
             width: 100%;
             height: 100%;
             object-fit: cover;
        }
        .profile-pic-container i {
             font-size: 2.5em;
             color: var(--cor-texto-secundario);
        }
        
        /* √çcone de Adi√ß√£o (Refer√™ncia TikTok) */
        .add-photo-icon {
             position: absolute;
             bottom: 0;
             right: 0;
             width: 30px;
             height: 30px;
             background-color: var(--cor-primario);
             color: var(--cor-fundo-principal);
             border-radius: 50%;
             display: flex;
             justify-content: center;
             align-items: center;
             font-size: 1.2em;
             font-weight: bold;
             border: 2px solid var(--cor-fundo-card);
             pointer-events: none; /* A a√ß√£o √© no container */
        }


        .sidebar a, .sidebar button {
            padding: 15px 25px;
            text-decoration: none;
            font-size: 1.1em;
            color: var(--cor-texto-principal);
            display: block;
            transition: var(--transicao-rapida);
            text-align: left;
            border: none;
            background: none;
            width: 100%;
            cursor: pointer;
        }

        .sidebar a:hover, .sidebar button:hover {
            color: var(--cor-primario);
            background-color: #1A212E;
            border-left: 5px solid var(--cor-primario);
        }

        .sidebar .closebtn {
            position: absolute;
            top: 10px;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
            color: var(--cor-divida);
        }
        .sidebar .closebtn:hover {
            color: var(--cor-alerta);
        }
        
        /* Bot√£o de Logout Simples */
        #btn-logout-only {
             color: var(--cor-alerta);
             border-top: 1px solid var(--cor-borda);
             margin-top: 10px;
        }
        #btn-logout-only:hover {
             color: #FFEB80;
             background-color: rgba(245, 158, 11, 0.1);
             border-left: 5px solid var(--cor-alerta);
        }


        
        /* =================================== */
        /* 4. TELAS DE ACESSO (Login e Cadastro) */
        /* =================================== */
        
        .login-box, .cadastro-box {
             background-color: var(--cor-fundo-card);
             padding: 40px;
             border-radius: 10px;
             box-shadow: var(--sombra-card);
             text-align: center;
             max-width: 350px;
             width: 90%;
        }
        #login-screen, #cadastro-screen {
             display: flex;
             justify-content: center;
             align-items: center;
             height: 100vh;
             width: 100%;
             position: fixed;
             top: 0;
             left: 0;
             background-color: var(--cor-fundo-principal);
             z-index: 2000;
        }
        .login-box h2, .cadastro-box h2 {
             color: var(--cor-primario);
             margin-bottom: 10px;
             font-size: 1.8em;
        }
        .login-box label, .cadastro-box label {
             display: block;
             text-align: left;
             margin-top: 15px;
             margin-bottom: 5px;
             color: var(--cor-texto-principal);
             font-weight: 600;
        }
        .login-box input, .cadastro-box input {
             width: 100%;
             padding: 10px;
             border-radius: 5px;
             border: 1px solid var(--cor-borda);
             background-color: #1A212E;
             color: var(--cor-fixa);
             font-family: var(--fonte-dados);
        }
        .login-box button {
             margin-top: 25px;
        }
        .cadastro-actions {
             margin-top: 25px;
             display: flex;
             justify-content: space-between;
             gap: 10px;
        }
        .cadastro-actions button {
             width: 48%;
             margin-top: 0;
        }
        .link-cadastro {
             color: var(--cor-fixa);
             cursor: pointer;
             margin-top: 20px;
             display: block;
             font-weight: 600;
             transition: color var(--transicao-rapida);
        }
        .link-cadastro:hover {
             color: var(--cor-sucesso);
        }
        .password-hint {
             font-size: 0.75em;
             color: var(--cor-alerta);
             margin-top: 5px;
             text-align: left;
        }


        /* =================================== */
        /* 5. MODAL DE PERFIL */
        /* =================================== */

        .modal {
             display: none; 
             position: fixed; 
             z-index: 1000; 
             left: 0; 
             top: 0; 
             width: 100%; 
             height: 100%; 
             overflow: auto; 
             background-color: rgba(0,0,0,0.7);
        }
        .modal-content-perfil {
             background-color: var(--cor-fundo-card);
             margin: 5% auto;
             padding: 30px;
             border-radius: 10px;
             border: 1px solid var(--cor-fixa);
             width: 90%;
             max-width: 500px;
             box-shadow: 0 0 20px rgba(29, 233, 182, 0.4);
        }
        .modal-content-perfil h3 {
             color: var(--cor-fixa);
             margin-bottom: 20px;
             font-size: 1.8em;
             border-bottom: 2px solid var(--cor-borda);
             padding-bottom: 10px;
        }
        .perfil-pic-preview {
             width: 80px;
             height: 80px;
             border-radius: 50%;
             overflow: hidden;
             border: 3px solid var(--cor-primario);
             margin: 0 auto 15px;
             cursor: pointer;
             display: flex;
             justify-content: center;
             align-items: center;
             background-color: #1A212E;
        }
        .perfil-pic-preview img {
             width: 100%;
             height: 100%;
             object-fit: cover;
        }
        .perfil-pic-preview i {
             font-size: 2em;
             color: var(--cor-texto-secundario);
        }
        .input-group-perfil {
             margin-bottom: 15px;
        }
        .input-group-perfil label {
             display: block;
             color: var(--cor-texto-secundario);
             font-size: 0.9em;
             margin-bottom: 5px;
        }
        .input-group-perfil input {
             width: 100%;
             padding: 10px;
             border-radius: 5px;
             border: 1px solid var(--cor-borda);
             background-color: #1A212E;
             color: var(--cor-fixa);
             font-family: var(--fonte-dados);
        }
        .perfil-actions button {
             margin-top: 20px;
             width: 100%;
             padding: 12px;
        }
        .error-message {
             color: var(--cor-divida);
             font-size: 0.85em;
             margin-top: 10px;
             text-align: left;
             font-weight: 600;
        }
        
        /* ESTILO NOVO: Bot√£o Excluir Conta no Perfil */
        #btn-excluir-conta-modal {
             background-color: var(--cor-divida);
             color: var(--cor-fundo-principal);
             margin-top: 15px;
             width: 100%;
        }
        #btn-excluir-conta-modal:hover {
             background-color: #FF7777;
             box-shadow: 0 0 8px rgba(239, 68, 68, 0.7);
        }

        
        /* [DASHBOARD E CARDS] */
        .meta-diaria-total{text-align:center;padding:25px;border-radius:10px;margin-bottom:25px;background-color:var(--cor-fundo-card);box-shadow:var(--sombra-card);transition:all var(--transicao-rapida)}.meta-diaria-total>div{display:flex;flex-direction:column;align-items:center}#meta-diaria-total-el{font-size:2.5em;font-weight:800;color:var(--cor-meta-diaria);font-family:var(--fonte-dados);margin-top:5px;line-height:1.2}.destaque-conclusao{font-size:1em;font-weight:700;margin-top:15px;font-family:var(--fonte-titulo)}.meta-batida{border:3px solid var(--cor-sucesso) !important;box-shadow:0 0 15px rgba(16, 185, 129, 0.7),0 0 30px rgba(16, 185, 129, 0.5);background-color:rgba(16, 185, 129, 0.1) !important}.progresso-bar-container{height:12px;background-color:#1A212E;border-radius:6px;overflow:hidden;margin-top:10px;border:1px solid var(--cor-borda)}.progresso{height:100%;background:linear-gradient(90deg, #444444 0%, var(--cor-sucesso) 100%);border-radius:6px;transition:width 0.6s ease-out}.dashboard-header{display:grid;grid-template-columns:repeat(3, 1fr);gap:20px;margin-bottom:40px}.info-card{background-color:var(--cor-fundo-card);padding:20px;border-radius:10px;box-shadow:var(--sombra-card);border-left:5px solid var(--cor-primario);transition:all var(--transicao-rapida)}.info-card:hover{box-shadow:var(--sombra-card-hover)}.info-card .rotulo{color:var(--cor-texto-secundario);font-size:0.9em;margin-bottom:5px;font-weight:600}.info-card .valor{font-family:var(--fonte-dados);font-size:1.8em;font-weight:700;display:block}.valor-caixa{color:var(--cor-sucesso)}.valor-divida{color:var(--cor-divida)}.progress-area{grid-column:span 3;background-color:var(--cor-fundo-card);padding:20px;border-radius:10px;box-shadow:var(--sombra-card);border-left:5px solid var(--cor-sucesso)}.section-header{display:flex;justify-content:space-between;align-items:center;margin-top:40px;margin-bottom:20px}.section-header h2{font-size:1.5em;color:var(--cor-fixa)}.toggle-section{margin-top:25px;border-radius:8px;overflow:hidden}.section-toggle{display:flex;justify-content:space-between;align-items:center;padding:15px;cursor:pointer;border-radius:8px;transition:background-color var(--transicao-rapida);background-color:var(--cor-fundo-card);box-shadow:var(--sombra-card)}.section-toggle:hover{background-color:#1A212E}.section-toggle h2{font-size:1.1em;margin:0;color:var(--cor-texto-principal);font-weight:600}.section-toggle i{transition:transform 0.3s ease}.section-toggle.aberto i{transform:rotate(180deg)}.toggle-section.receitas .section-toggle{border-left:5px solid var(--cor-sucesso)}.toggle-section.fixas .section-toggle{border-left:5px solid var(--cor-fixa)}.toggle-section.dividas .section-toggle{border-left:5px solid var(--cor-divida)}.lista-container-ocultavel{padding-top:15px;padding-bottom:15px;background-color:var(--cor-fundo-card)}.alerta-nota{background-color:#1A212E;padding:12px;border-radius:6px;border-left:5px solid var(--cor-alerta);color:var(--cor-alerta);font-size:0.9em;margin:15px 15px 15px 15px}.motivacao-box{background-color:var(--cor-fundo-ia);padding:15px;border-radius:8px;text-align:center;font-style:italic;color:var(--cor-texto-secundario);margin-bottom:25px;border:1px solid var(--cor-borda)}.tabela-wrapper{overflow-x:auto;width:100%;padding:0 15px}.tabela-transacoes-log, .tabela-fixas-log, .tabela-dividas-log{min-width:400px;width:100%;border-collapse:collapse;font-family:var(--fonte-dados);border:1px solid var(--cor-borda);border-radius:8px;overflow:hidden}.tabela-transacoes-log th, .tabela-transacoes-log td, .tabela-fixas-log th, .tabela-fixas-log td, .tabela-dividas-log th, .tabela-dividas-log td{padding:12px 8px;text-align:left;border-bottom:1px solid var(--cor-borda);background-color:#1A212E}.tabela-transacoes-log th, .tabela-fixas-log th, .tabela-dividas-log th{background-color:#1A212E;color:var(--cor-primario);text-transform:uppercase;font-weight:700;font-size:0.9em;white-space:nowrap;background-color:#13171F}.log-receita-descricao{color:var(--cor-sucesso);font-weight:600}.log-receita-valor{color:var(--cor-sucesso) !important;font-weight:700}.btn-acao-tabela{background:none;border:none;cursor:pointer;padding:5px;font-size:1.1em;transition:color var(--transicao-rapida)}.btn-acao-tabela.deletar-log{color:var(--cor-divida)}.btn-acao-tabela.deletar-log:hover{color:var(--cor-alerta)}.btn-acao-tabela.pagar-fixa{background-color:var(--cor-fixa);color:var(--cor-fundo-principal);padding:6px 10px;border:none;border-radius:4px;cursor:pointer;font-size:0.8em;font-weight:700;transition:all var(--transicao-rapida);white-space:nowrap}.btn-acao-tabela.pagar-fixa:hover{background-color:#00FFC6;box-shadow:0 0 5px var(--cor-fixa)}.conta-paga{display:none}.btn-acao-tabela.quitar-divida{background-color:var(--cor-divida);color:var(--cor-fundo-principal);padding:6px 10px;border:none;border-radius:4px;cursor:pointer;font-size:0.8em;font-weight:700;transition:all var(--transicao-rapida);white-space:nowrap}.btn-acao-tabela.quitar-divida.inativo{background-color:var(--cor-borda);cursor:not-allowed;opacity:0.4}.btn-acao-tabela.quitar-divida:hover:not(.inativo){background-color:#FF7777}.plano-quitacao{background-color:var(--cor-fundo-ia);padding:30px;border-radius:10px;border:2px solid var(--cor-destaque-ia);box-shadow:0 0 20px rgba(255, 215, 0, 0.4);margin-top:50px;transition:all var(--transicao-rapida)}.plano-quitacao:hover{box-shadow:0 0 30px rgba(255, 215, 0, 0.6)}.plano-quitacao h3{color:var(--cor-destaque-ia);margin-bottom:25px;font-size:1.6em;display:flex;align-items:center;gap:10px}.ia-input-group{display:flex;gap:20px;align-items:flex-end;margin-bottom:25px}.ia-input-group label{color:var(--cor-texto-principal);font-weight:600;display:block;margin-bottom:8px}.ia-input-group input{padding:10px;border-radius:4px;border:1px solid var(--cor-destaque-ia);background:#1A212E;color:var(--cor-fixa);font-family:var(--fonte-dados);width:100px;text-align:center}.ia-input-group button{padding:10px 20px;background-color:var(--cor-destaque-ia);color:var(--cor-fundo-principal);font-weight:700;border-radius:4px;border:none;cursor:pointer;transition:all var(--transicao-rapida)}.ia-input-group button:hover{background-color:#FFEB80;box-shadow:0 0 10px var(--cor-destaque-ia)}#resultado-plano-ia{background-color:#0E1117;padding:20px;border-radius:8px;border-left:4px solid var(--cor-destaque-ia);margin-bottom:25px;font-family:var(--fonte-dados)}#resultado-plano-ia p{margin:8px 0;color:var(--cor-texto-principal)}#resultado-plano-ia strong{color:var(--cor-fixa)}.estrategia-quitacao{padding:20px;border-top:1px dashed var(--cor-borda);margin-top:20px;}#dicas-quitacao{background-color:rgba(239, 68, 68, 0.1); border: 2px solid var(--cor-divida); border-radius: 8px; padding: 20px; margin-top: 20px;}.estrategia-quitacao h4{color:var(--cor-divida); margin-bottom: 15px; font-size: 1.2em; border-bottom: 1px solid var(--cor-borda); padding-bottom: 5px;}.estrategia-quitacao p{margin: 10px 0; color: var(--cor-texto-principal); font-size: 0.9em;}.prioridade-item{font-family: var(--fonte-dados); margin-bottom: 8px; padding: 8px; background-color: rgba(239, 68, 68, 0.2); border-radius: 4px; border-left: 5px solid var(--cor-divida);}.prioridade-item strong{color: var(--cor-divida);}.prioridade-acao{margin-top: 15px; font-weight: 700; color: var(--cor-alerta); border-top: 1px dashed var(--cor-borda); padding-top: 10px;}.modal-relatorio-content{background-color:var(--cor-fundo-card);margin:5% auto;padding:30px;border-radius:10px;border:1px solid var(--cor-meta-diaria);width:90%;max-width:800px;box-shadow:0 0 20px rgba(155, 89, 182, 0.4)}.modal-relatorio-content h3{color:var(--cor-meta-diaria);margin-bottom:20px;font-size:1.6em}.tabela-relatorio{width:100%;border-collapse:collapse;margin-top:15px;font-family:var(--fonte-dados)}.tabela-relatorio th, .tabela-relatorio td{padding:10px;text-align:left;border-bottom:1px solid var(--cor-borda);font-size:0.9em}.tabela-relatorio th{background-color:#1A212E;color:var(--cor-meta-diaria);text-transform:uppercase}.meta-batida-status{color:var(--cor-sucesso);font-weight:700}.meta-nao-batida-status{color:var(--cor-divida);font-weight:700}

        /* V4.9 NOVO: Estilo para Bot√µes de A√ß√£o Din√¢micos */
        .btn-acao-tabela.deletar-divida {
             color: var(--cor-divida);
             font-size: 1.1em;
             margin-right: 10px;
        }
        .btn-acao-tabela.deletar-divida:hover {
             color: var(--cor-alerta);
        }
        .btn-acao-tabela.pagamento-divida {
            background-color: var(--cor-divida);
            color: var(--cor-fundo-principal);
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 700;
            transition: all var(--transicao-rapida);
            white-space: nowrap;
        }
        .btn-acao-tabela.pagamento-divida:hover {
            background-color: #FF7777;
        }
        .divida-actions {
             display: flex;
             align-items: center;
             justify-content: center;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 0 var(--espacamento-mobile);
            }
            .dashboard-header {
                 grid-template-columns: 1fr;
            }
            .progress-area {
                 grid-column: span 1;
            }
            .header-content {
                 flex-direction: row; 
                 align-items: center;
                 margin-top: 20px;
            }
            h1 {
                 font-size: 2em;
                 text-align: left;
            }
            .modal-content, .modal-relatorio-content, .modal-content-perfil {
                 width: 95% !important; 
                 max-width: 95% !important;
                 padding: 15px !important;
            }
            .tabela-relatorio th, .tabela-relatorio td {
                 font-size: 0.75em;
            }
            .tabela-wrapper {
                 padding: 0 5px;
            }
            .tabela-transacoes-log, .tabela-fixas-log, .tabela-dividas-log {
                 font-size: 0.8em;
                 min-width: 100%;
            }
            .tabela-transacoes-log th:nth-child(1), .tabela-transacoes-log td:nth-child(1) { width: 50%; }
            .tabela-transacoes-log th:nth-child(2), .tabela-transacoes-log td:nth-child(2) { width: 30%; }
            .tabela-transacoes-log th:nth-child(3), .tabela-transacoes-log td:nth-child(3) { width: 20%; text-align: center; } 
            .tabela-fixas-log th:nth-child(1), .tabela-fixas-log td:nth-child(1), .tabela-dividas-log th:nth-child(1), .tabela-dividas-log td:nth-child(1) { width: 45%; }
            .tabela-fixas-log th:nth-child(2), .tabela-fixas-log td:nth-child(2), .tabela-dividas-log th:nth-child(2), .tabela-dividas-log td:nth-child(2) { width: 35%; }
            .tabela-fixas-log th:nth-child(3), .tabela-fixas-log td:nth-child(3), .tabela-dividas-log th:nth-child(3), .tabela-dividas-log td:nth-child(3) { width: 20%; text-align: center; } 
            .plano-quitacao {
                 padding: 20px;
            }
            .ia-input-group {
                 flex-direction: column;
                 align-items: flex-start;
                 gap: 15px;
            }
            .ia-input-group > div {
                 width: 100%;
            }
            .ia-input-group input {
                 width: 100%;
            }
            .ia-input-group button {
                 width: 100% !important;
            }
            .sidebar {
                 width: 250px;
            }
            .cadastro-actions {
                 flex-direction: column;
            }
            .cadastro-actions button {
                 width: 100%;
                 margin-bottom: 10px;
            }
        }

    </style>
</head>
<body>
    
    <div id="mySidebar" class="sidebar">
        <a href="javascript:void(0)" class="closebtn" id="close-sidebar">&times;</a>
        
        <div class="sidebar-header">
            <div class="profile-pic-area">
                <div class="profile-pic-container" id="profile-pic-container">
                     <img id="profile-image" alt="Foto de Perfil" style="display: none;">
                     <i id="profile-icon" class="fas fa-user-circle"></i>
                </div>
                <div class="add-photo-icon">+</div>
            </div>
            <h3 id="sidebar-username">Nome do Usu√°rio</h3>
        </div>
        
        <a href="javascript:void(0)" id="menu-perfil"><i class="fas fa-id-badge"></i> Perfil</a>
        <a href="https://wa.me/5521967074896" target="_blank" id="menu-suporte"><i class="fab fa-whatsapp"></i> Suporte</a>
        <button id="btn-logout-only"><i class="fas fa-sign-out-alt"></i> SAIR (MANTER DADOS)</button>
        </div>
    
    <input type="file" id="photo-input" accept="image/*" style="display: none;">

    <div id="cadastro-screen" style="display: none;">
        <div class="cadastro-box" style="border: 2px solid var(--cor-fixa); box-shadow: 0 0 15px rgba(29, 233, 182, 0.7);">
            <h2><i class="fas fa-user-plus"></i> NOVO REGISTRO TITAN</h2>
            <p style="color: var(--cor-texto-secundario); margin-bottom: 15px;">Crie sua conta de acesso.</p>
            
            <label for="reg-first-name-input">PRIMEIRO NOME</label>
            <input type="text" id="reg-first-name-input" placeholder="Seu Nome" required>
            
            <label for="reg-last-name-input">SOBRENOME</label>
            <input type="text" id="reg-last-name-input" placeholder="Seu Sobrenome" required>
            
            <label for="reg-email-input">E-MAIL</label>
            <input type="email" id="reg-email-input" placeholder="seu@email.com" required>
            
            <label for="reg-phone-input">TELEFONE</label>
            <input type="tel" id="reg-phone-input" placeholder="(99) 99999-9999" required>
            
            <label for="reg-password-input">CHAVE DE SEGURAN√áA (SENHA)</label>
            <input type="password" id="reg-password-input" placeholder="8+ chars, aA, #" required>
            <p class="password-hint">M√≠nimo 8 caracteres, 1 mai√∫scula, 1 min√∫scula e 1 especial (#, @, $, etc.).</p>
            <p id="reg-feedback" class="error-message" style="display: none;"></p>

            <div class="cadastro-actions">
                <button id="btn-cadastrar" class="btn-principal" style="background-color: var(--cor-sucesso);"><i class="fas fa-user-check"></i> CONFIRMAR CADASTRO</button>
                <button id="btn-voltar-login" class="btn-principal" style="background-color: var(--cor-borda);"><i class="fas fa-undo"></i> VOLTAR</button>
            </div>
        </div>
    </div>


    <div id="login-screen" style="display: none;">
        <div class="login-box" style="border: 2px solid var(--cor-primario); box-shadow: var(--sombra-card-hover);">
            <h2><i class="fas fa-fingerprint"></i> PROJECT TITAN</h2>
            <p style="color: var(--cor-texto-secundario); margin-bottom: 25px;">Acesso restrito ao Painel de Gest√£o Estrat√©gica.</p>
            
            <label for="login-email-input">E-MAIL OU PRIMEIRO NOME</label>
            <input type="text" id="login-email-input" placeholder="Seu Email ou Nome" required autocomplete="off">
            
            <label for="login-password-input">CHAVE DE SEGURAN√áA</label>
            <input type="password" id="login-password-input" placeholder="Senha" required autocomplete="off">
            
            <button id="btn-login" class="btn-principal"><i class="fas fa-sign-in-alt"></i> AUTORIZAR ACESSO</button>
            <p id="login-feedback" class="error-message" style="margin-top: 15px;"></p>
            
            <a href="#" id="link-abrir-cadastro" class="link-cadastro"><i class="fas fa-file-invoice"></i> CADASTRE-SE AQUI</a>
        </div>
    </div>
    
    <div id="main-content" style="display: none;">
        
        <div class="dynamic-banner">
            <div class="banner-text" id="banner-text">
                üí∞ Foco & Disciplina. ZERO D√çVIDA. Capital √© PODER. üí∏
            </div>
        </div>
        
        <div class="header-content">
            <h1><i class="fas fa-terminal"></i> PROJECT TITAN</h1>
            <i class="fas fa-bars" id="menu-toggle" title="Menu de Op√ß√µes"></i>
        </div>
        
        <div class="container" id="welcome-message">
            </div>

        
        <div class="container" id="data-atual-info">
            <button id="btn-data-atual" title="Clique para ver o Relat√≥rio de Metas">
                <i class="fas fa-calendar-day"></i> <span id="data-atual"></span>
            </button>
        </div>

        <div class="motivacao-box container" id="motivacao-diaria">
            <i class="fas fa-infinity"></i>
            "DISCIPLINA √â O COMANDO. A LIBERDADE FINANCEIRA √â O STATUS. Mantenha o Foco."
        </div>
        
        <div id="meta-diaria-card" class="meta-diaria-total container" style="border: 1px solid var(--cor-meta-diaria);">
            <div>
                <p style="color: var(--cor-texto-secundario); font-weight: 600;"><i class="fas fa-bullseye"></i> TARGET DI√ÅRIO DE APORTE (FIXAS + QUITA√á√ÉO)</p>
                <span id="meta-diaria-total-el">R$ 0,00</span>
            </div>
            <span id="meta-diaria-incentivo" class="destaque-conclusao" style="display: none;"></span>
        </div>
        

        <header class="dashboard-header container">
            
            <div class="info-card">
                <p class="rotulo"><i class="fas fa-satellite-dish"></i> CAPITAL ACUMULADO (ENTRADAS)</p>
                <span id="total-lancado" class="valor valor-caixa">R$ 0,00</span>
            </div>
            
            <div class="progress-area" id="meta-area">
                <p class="rotulo"><i class="fas fa-route"></i> STATUS DE QUITA√á√ÉO √öNICA</p>
                <p style="margin-bottom: 5px; color: var(--cor-texto-secundario);">D√≠vidas Pendentes: <span id="total-dividas-pendentes" style="font-weight: 700; color: var(--cor-divida); font-family: var(--fonte-dados);">R$ 0,00</span></p>
                <p>Progresso de Quita√ß√£o com Capital: <span id="progresso-capital-txt" style="font-weight: 700; color: var(--cor-sucesso); font-family: var(--fonte-dados);">0.00%</span></p>
                
                <div class="progresso-bar-container">
                    <div id="progresso-bar" class="progresso" style="width: 0%;"></div>
                </div>
            </div>
            
            <div class="info-card">
                <p class="rotulo"><i class="fas fa-skull-crossbones"></i> SALDO TOTAL A QUITAR</p>
                <span id="saldo-pendente-total" class="valor valor-divida">R$ 0,00</span>
            </div>
        </header>
        
        <main class="container">
            
            <div class="section-header">
                <h2><i class="fas fa-bolt"></i> M√ìDULO DE A√á√ïES</h2>
                <div style="display: flex; gap: 10px;">
                    <button id="abrir-cadastro-receita" class="btn-principal" style="background-color: var(--cor-sucesso);"> <i class="fas fa-plus"></i> INJETAR CAPITAL</button>
                    <button id="abrir-cadastro-divida" class="btn-principal" style="background-color: var(--cor-divida);"><i class="fas fa-plus"></i> NOVA D√çVIDA</button>
                </div>
            </div>
            <div id="historico-receitas-container" class="toggle-section">
                <div class="section-toggle receitas" id="toggle-receitas">
                    <h2><i class="fas fa-clipboard-list"></i> LOG: REGISTROS DE LAN√áAMENTO (CAPITAL) <span style="font-size: 0.8em; color: var(--cor-texto-secundario);">(HOJE)</span></h2>
                    <i class="fas fa-chevron-down"></i>
                </div>
                
                <div id="lista-receitas-container" class="lista-container-ocultavel" style="display: none;">
                    <div class="tabela-wrapper">
                        <table class="tabela-transacoes-log">
                            <thead>
                                <tr>
                                    <th>DESCRI√á√ÉO</th>
                                    <th>VALOR (R$)</th>
                                    <th>A√á√ÉO</th>
                                </tr>
                            </thead>
                            <tbody id="lista-entradas">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div id="feedback-fixas-quitadas" class="motivacao-box" style="display: none; margin-top: 40px; border: 2px solid var(--cor-sucesso);">
                 <i class="fas fa-medal" style="color: var(--cor-sucesso);"></i> PROTOCOLO DE CONTAS FIXAS CONCLU√çDO! <i class="fas fa-medal" style="color: var(--cor-sucesso);"></i>
                 <p style="color: var(--cor-texto-principal); font-weight: 600; font-style: normal; margin-top: 5px;">Contas Fixas liquidadas para este ciclo. Foco total em reduzir o Saldo Pendente.</p>
            </div>

            
            <div id="contas-fixas-toggle" class="toggle-section">
                <div class="section-toggle fixas" id="toggle-fixas">
                    <h2><i class="fas fa-calculator"></i> CONTAS FIXAS (META: R$ <span id="soma-fixas" class="valor-divida" style="font-family: var(--fonte-dados); font-size: 1em;">0,00</span>)</h2>
                    <i class="fas fa-chevron-down"></i>
                </div>
                
                <div id="lista-fixas-container" class="lista-container-ocultavel" style="display: none;">
                     <p class="alerta-nota">
                        <i class="fas fa-exclamation-triangle"></i> NOTA: Ao clicar em 'PAGAR', o valor ser√° deduzido imediatamente do Capital Acumulado.
                     </p>
                     <div class="tabela-wrapper">
                         <table class="tabela-fixas-log">
                             <thead>
                                 <tr>
                                     <th>CONTA</th>
                                     <th>VALOR (R$)</th>
                                     <th>A√á√ÉO</th>
                                 </tr>
                             </thead>
                             <tbody id="lista-contas-fixas-tabela">
                                 </tbody>
                         </table>
                    </div>
                </div>
            </div>


            
            <div id="dividas-container" class="toggle-section" style="display: none;"> 
                
                <div class="section-header" style="margin-top: 0; margin-bottom: 20px;">
                    <h2 style="font-size: 1.5em; color: var(--cor-divida);"><i class="fas fa-radiation"></i> D√çVIDAS √öNICAS (PROTOCOLO DE REDU√á√ÉO)</h2>
                </div>
                
                <div class="section-toggle dividas" id="toggle-dividas">
                    <h2><i class="fas fa-clipboard-list"></i> LOG: D√çVIDAS A QUITAR</h2>
                    <i class="fas fa-chevron-down"></i>
                </div>
                
                <div id="lista-dividas-quitar-container" class="lista-container-ocultavel" style="display: none;">
                    <p class="alerta-nota">
                        <i class="fas fa-exclamation-triangle"></i> NOTA: O bot√£o "QUITA√á√ÉO TOTAL" s√≥ √© ativado quando o Capital Acumulado √© $\ge$ Saldo da D√≠vida. Use **PAGAR** para fazer aportes parciais.
                     </p>
                     <div class="tabela-wrapper">
                         <table class="tabela-dividas-log">
                             <thead>
                                 <tr>
                                     <th>CREDOR</th>
                                     <th>SALDO ATUAL (R$)</th>
                                     <th>A√á√ïES</th>
                                 </tr>
                             </thead>
                             <tbody id="lista-dividas-quitar-tabela">
                                 </tbody>
                         </table>
                    </div>
                </div>
            </div>
            
            <div id="plano-quitacao-master" class="plano-quitacao" style="margin-top: 50px; display: none;"> 
                <h3><i class="fas fa-brain"></i> M√ìDULO IA: PLANO DE QUITA√á√ÉO ESTRAT√âGICO</h3>
                
                <div id="plano-ia-controls" class="ia-input-group">
                    <div>
                         <label for="meses-plano">TARGET: Meses para Quitar D√≠vidas √öNICAS</label>
                         <input type="number" id="meses-plano" value="5" min="1" max="60">
                    </div>
                    <button id="btn-gerar-plano" class="btn-principal" style="margin-top: 0;">
                        <i class="fas fa-redo-alt"></i> RECALCULAR PLANO
                    </button>
                </div>
                
                <div id="resultado-plano-ia">
                    <p style="color: var(--cor-texto-secundario);">Aguardando c√°lculo...</p>
                    </div>
                
                <div id="dicas-quitacao" class="estrategia-quitacao">
                     </div>
            </div>
            
        </main>
    </div>

    <div id="modal-relatorio" class="modal">
        <div class="modal-relatorio-content">
            <span class="fechar-modal" id="fechar-modal-relatorio" style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
            <h3><i class="fas fa-chart-line"></i> RELAT√ìRIO DE PROGRESSO DI√ÅRIO</h3>
            <p style="color: var(--cor-texto-secundario); font-size: 0.9em;">Hist√≥rico de metas di√°rias de aporte (Fixas + Quita√ß√£o) versus o capital efetivamente lan√ßado por dia.</p>
            
            <div class="tabela-wrapper" style="padding: 0;">
                <table class="tabela-relatorio">
                    <thead>
                        <tr>
                            <th>DATA</th>
                            <th>META TOTAL (R$)</th>
                            <th>APORTADO (R$)</th>
                            <th>STATUS</th>
                        </tr>
                    </thead>
                    <tbody id="corpo-tabela-relatorio">
                        </tbody>
                </table>
            </div>
            
        </div>
    </div>


    <div id="modal-receita" class="modal">
        <div class="modal-content" style="background-color: var(--cor-fundo-card); margin: 15% auto; padding: 30px; border-radius: 10px; border: 1px solid var(--cor-primario); width: 80%; max-width: 400px; box-shadow: var(--sombra-card-hover);">
            <span class="fechar-modal" id="fechar-modal-receita" style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
            <h3 id="titulo-dados-receita" style="color: var(--cor-sucesso);"><i class="fas fa-arrow-up"></i> LAN√áAMENTO DE CAPITAL</h3>
            <label for="valor-input-receita" style="display: block; margin-top: 20px; color: var(--cor-texto-principal); font-weight: 600;">VALOR DO APORTE (R$)</label>
            <input type="number" id="valor-input-receita" placeholder="0.00" min="0.01" step="0.01" style="width: 100%; padding: 10px; margin-top: 8px; border-radius: 5px; border: 1px solid var(--cor-borda); background-color: #1A212E; color: var(--cor-fixa); font-family: var(--fonte-dados);">
            <button class="btn-principal btn-ok" id="btn-cadastrar-receita" style="background-color: var(--cor-sucesso); margin-top: 25px;">CONFIRMAR LAN√áAMENTO <i class="fas fa-check"></i></button>
        </div>
    </div>
    
    <div id="modal-divida" class="modal">
        <div class="modal-content" style="background-color: var(--cor-fundo-card); margin: 15% auto; padding: 30px; border-radius: 10px; border: 1px solid var(--cor-divida); width: 80%; max-width: 400px; box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);">
            <span class="fechar-modal" id="fechar-modal-divida" style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
            <h3 id="titulo-cadastro-divida" style="color: var(--cor-divida);"><i class="fas fa-hand-holding-usd"></i> CADASTRO DE D√çVIDA √öNICA</h3>
            
            <label for="credor-input-divida" style="display: block; margin-top: 20px; color: var(--cor-texto-principal); font-weight: 600;">CREDOR/ORIGEM</label>
            <input type="text" id="credor-input-divida" placeholder="Ex: Banco X" style="width: 100%; padding: 10px; margin-top: 8px; border-radius: 5px; border: 1px solid var(--cor-borda); background-color: #1A212E; color: var(--cor-fixa); font-family: var(--fonte-dados);">

            <label for="valor-input-divida" style="display: block; margin-top: 20px; color: var(--cor-texto-principal); font-weight: 600;">VALOR TOTAL (R$)</label>
            <input type="number" id="valor-input-divida" placeholder="0.00" min="0.01" step="0.01" style="width: 100%; padding: 10px; margin-top: 8px; border-radius: 5px; border: 1px solid var(--cor-borda); background-color: #1A212E; color: var(--cor-fixa); font-family: var(--fonte-dados);">
            
            <button class="btn-principal btn-ok" id="btn-cadastrar-divida" style="background-color: var(--cor-divida); margin-top: 25px;">REGISTRAR D√çVIDA <i class="fas fa-save"></i></button>
        </div>
    </div>
    
    <div id="modal-quitacao" class="modal">
        <div class="modal-content" style="background-color: var(--cor-fundo-card); margin: 15% auto; padding: 30px; border-radius: 10px; border: 1px solid var(--cor-divida); width: 80%; max-width: 400px; box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);">
            <span class="fechar-modal" id="fechar-modal-quitacao" style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
            <h3 id="titulo-quitacao" style="color: var(--cor-divida);"><i class="fas fa-receipt"></i> REGISTRAR PAGAMENTO</h3>
            <p style="margin-top: 15px; margin-bottom: 10px; font-family: var(--fonte-titulo); font-weight: 600; color: var(--cor-texto-secundario);">
                TARGET CREDOR: <span id="nome-credor" style="font-family: var(--fonte-dados); color: var(--cor-texto-principal);"></span>
            </p>
            <p style="margin-bottom: 20px; font-family: var(--fonte-titulo); font-weight: 600; color: var(--cor-texto-secundario);">
                SALDO PENDENTE: <span id="saldo-quitacao" class="saldo-divida" style="font-family: var(--fonte-dados);"></span>
            </p>
            <label for="valor-pagamento" style="display: block; margin-top: 20px; color: var(--cor-texto-principal); font-weight: 600;">VALOR DO PAGAMENTO (R$)</label>
            <input type="number" id="valor-pagamento" placeholder="0.00" min="0.01" step="0.01" style="width: 100%; padding: 10px; margin-top: 8px; border-radius: 5px; border: 1px solid var(--cor-borda); background-color: #1A212E; color: var(--cor-fixa); font-family: var(--fonte-dados);">
            
            <div style="display: flex; gap: 10px; margin-top: 25px;">
                 <button class="btn-principal btn-ok" id="btn-quitar-total" style="flex: 1; background-color: var(--cor-divida);">QUITA√á√ÉO TOTAL</button>
                 <button class="btn-principal btn-ok" id="btn-quitar-parcial" style="flex: 1; background-color: var(--cor-alerta);">PAGAMENTO PARCIAL</button>
            </div>
            
        </div>
    </div>
    
    <div id="modal-perfil" class="modal">
        <div class="modal-content-perfil">
            <span class="fechar-modal" id="fechar-modal-perfil" style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
            <h3><i class="fas fa-user-circle"></i> MEU PERFIL</h3>
            
            <div class="perfil-pic-preview" id="perfil-pic-preview">
                 <img id="perfil-image-modal" alt="Foto de Perfil" style="display: none;">
                 <i id="perfil-icon-modal" class="fas fa-camera"></i>
            </div>
            <p style="text-align: center; color: var(--cor-texto-secundario); font-size: 0.85em; margin-bottom: 20px;">Clique na foto acima para alterar</p>
            
            <div class="input-group-perfil">
                 <label for="perfil-first-name">Primeiro Nome</label>
                 <input type="text" id="perfil-first-name" required>
            </div>
            <div class="input-group-perfil">
                 <label for="perfil-last-name">Sobrenome</label>
                 <input type="text" id="perfil-last-name" required>
            </div>
            <div class="input-group-perfil">
                 <label for="perfil-email">E-mail</label>
                 <input type="email" id="perfil-email" required>
            </div>
            <div class="input-group-perfil">
                 <label for="perfil-phone">Telefone</label>
                 <input type="tel" id="perfil-phone" required>
            </div>
            
            <p id="perfil-feedback" class="error-message" style="display: none;"></p>
            
            <div class="perfil-actions">
                 <button id="btn-salvar-perfil" class="btn-principal" style="background-color: var(--cor-fixa);">
                     <i class="fas fa-save"></i> SALVAR ALTERA√á√ïES
                 </button>
                 <button id="btn-excluir-conta-modal" class="btn-principal">
                      <i class="fas fa-user-slash"></i> EXCLUIR CONTA
                 </button>
            </div>
        </div>
    </div>

    
    <script>
        // ===========================================
        // JAVASCRIPT: L√ìGICA DE NEG√ìCIO E CONEX√ÉO V4.9 (ATUALIZADO)
        // ===========================================

        const DIAS_UTEIS_MES = 22; 
        const SESSION_TIMEOUT_MS = 600000; // 10 minutos
        let sessionTimer;
        const DEFAULT_PASSWORD = '123'; 
        
        // Dados Iniciais
        const CONTAS_FIXAS_INITIAL = [
            { id: 100, nome: "Carro", valor: 1800.00, pago: false },
            { id: 101, nome: "Aluguel", valor: 850.00, pago: false },
            { id: 102, nome: "Academia", valor: 300.00, pago: false },
            { id: 103, nome: "Luz", valor: 250.00, pago: false },
            { id: 104, nome: "Internet Movel", valor: 120.00, pago: false },
            { id: 105, nome: "Wifi", valor: 100.00, pago: false }
        ].sort((a, b) => b.valor - a.valor);
        
        let idDebtQuitting = null; 

        // Usu√°rio Padr√£o/Logado (Objeto simplificado)
        const DEFAULT_USER = {
             firstName: "Cleber",
             lastName: "Teste",
             email: "cleber@titan.com",
             phone: "(21) 98765-4321",
             password: DEFAULT_PASSWORD 
        }
        let loggedUser = null;
        
        // ===========================================
        // FUN√á√ïES UTILIT√ÅRIAS DE DADOS E SESS√ÉO
        // ===========================================
        
        const formatarMoeda = (valor) => {
            return parseFloat(valor).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        };

        const getHojeString = () => new Date().toISOString().slice(0, 10);
        
        // --- Fun√ß√µes de Carregamento/Salvamento ---
        const carregarContasFixas = () => {
            const fixas = localStorage.getItem('contasFixas');
            if (!fixas) return CONTAS_FIXAS_INITIAL;
            const loadedFixas = JSON.parse(fixas);
            // Garante que a lista inicial √© a base, aplicando o status 'pago' do localStorage
            const currentFixas = CONTAS_FIXAS_INITIAL.map(initialFixa => {
                const loadedFixa = loadedFixas.find(f => f.id === initialFixa.id);
                return { ...initialFixa, pago: loadedFixa ? loadedFixa.pago : false };
            }).sort((a, b) => b.valor - a.valor);
            return currentFixas;
        };
        const salvarContasFixas = (fixas) => localStorage.setItem('contasFixas', JSON.stringify(fixas));
        const carregarTransacoes = () => {
            const transacoes = localStorage.getItem('transacoes');
            return transacoes ? JSON.parse(transacoes) : [];
        };
        const salvarTransacoes = (transacoes) => localStorage.setItem('transacoes', JSON.stringify(transacoes));
        const carregarDividas = () => {
            const dividas = localStorage.getItem('dividas');
            if (!dividas) {
                salvarDividas([]); // Inicializa vazia se n√£o existir
                return [];
            }
            const loadedDebts = JSON.parse(dividas).map(d => ({ 
                ...d, 
                id: parseInt(d.id), 
                valorInicial: parseFloat(d.valorInicial),
                valorAtual: parseFloat(d.valorAtual) 
            })).filter(d => d.valorAtual > 0.01); // Filtra d√≠vidas quitadas
            loadedDebts.sort((a, b) => a.valorAtual - b.valorAtual); // Prioriza menor saldo (Bola de Neve)
            return loadedDebts;
        }
        const salvarDividas = (dividas) => {
             // Salva todas as d√≠vidas, incluindo as quitadas (valorAtual <= 0.01)
             localStorage.setItem('dividas', JSON.stringify(dividas));
        }

        const carregarUsuario = () => {
             const storedUser = localStorage.getItem('userProfile');
             if (storedUser) {
                 loggedUser = JSON.parse(storedUser);
             } else {
                 loggedUser = DEFAULT_USER;
                 localStorage.setItem('userProfile', JSON.stringify(DEFAULT_USER));
             }
             return loggedUser;
        }
        const salvarUsuario = (user) => {
             localStorage.setItem('userProfile', JSON.stringify(user));
             loggedUser = user;
        }


        // --- Fun√ß√µes de Sess√£o e Personaliza√ß√£o ---
        
        const getGreeting = (name) => {
            const hour = new Date().getHours();
            let saudacao;
            if (hour >= 5 && hour < 12) {
                saudacao = "Bom dia";
            } else if (hour >= 12 && hour < 18) {
                saudacao = "Boa tarde";
            } else {
                saudacao = "Boa noite";
            }
            return `${saudacao}, ${name}!`;
        };
        
        // NOVO: Fun√ß√£o para SAIR mantendo os dados
        const logoutOnly = () => {
             if (confirm('Deseja realmente sair? Seus dados de transa√ß√µes e d√≠vidas ser√£o mantidos para o pr√≥ximo acesso.')) {
                 localStorage.removeItem('loggedIn');
                 if (sessionTimer) clearTimeout(sessionTimer);
                 window.location.reload(); 
             }
        };
        
        const resetSession = () => {
             localStorage.removeItem('loggedIn');
             document.getElementById('login-screen').style.display = 'flex';
             document.getElementById('main-content').style.display = 'none';
             document.getElementById('mySidebar').style.width = '0'; 
             if (sessionTimer) clearTimeout(sessionTimer);
             alert('Sess√£o expirada. Fa√ßa login novamente.');
        };
        
        const startSessionTimer = () => {
             if (sessionTimer) clearTimeout(sessionTimer);
             sessionTimer = setTimeout(resetSession, SESSION_TIMEOUT_MS);
        };
        

        // ===========================================
        // FUN√á√ïES DE PERFIL E SIDEBAR
        // ===========================================

        const openSidebar = () => {
             document.getElementById("mySidebar").style.width = "300px";
        }

        const closeSidebar = () => {
             document.getElementById("mySidebar").style.width = "0";
        }
        
        const renderSidebarProfile = () => {
            const user = carregarUsuario(); // Sempre recarrega para ter os dados mais recentes
            const firstName = user.firstName || "Usu√°rio";
            const profilePicData = localStorage.getItem('profilePic');
            
            document.getElementById('sidebar-username').textContent = firstName;
            
            const imgEl = document.getElementById('profile-image');
            const iconEl = document.getElementById('profile-icon');
            
            if (profilePicData) {
                imgEl.src = profilePicData;
                imgEl.style.display = 'block';
                iconEl.style.display = 'none';
            } else {
                imgEl.src = '';
                imgEl.style.display = 'none';
                iconEl.style.display = 'block';
            }
        }
        
        const handleProfilePicChange = (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    localStorage.setItem('profilePic', e.target.result);
                    renderSidebarProfile();
                    // Atualiza o modal de perfil se estiver aberto
                    const imgModalEl = document.getElementById('perfil-image-modal');
                    const iconModalEl = document.getElementById('perfil-icon-modal');
                    imgModalEl.src = e.target.result;
                    imgModalEl.style.display = 'block';
                    iconModalEl.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        const abrirModalPerfil = () => {
             closeSidebar();
             const user = carregarUsuario();
             const profilePicData = localStorage.getItem('profilePic');

             // Preenche os campos
             document.getElementById('perfil-first-name').value = user.firstName || '';
             document.getElementById('perfil-last-name').value = user.lastName || '';
             document.getElementById('perfil-email').value = user.email || '';
             document.getElementById('perfil-phone').value = user.phone || '';
             document.getElementById('perfil-feedback').style.display = 'none';
             
             // Preenche a foto de perfil no modal
             const imgModalEl = document.getElementById('perfil-image-modal');
             const iconModalEl = document.getElementById('perfil-icon-modal');
             if (profilePicData) {
                 imgModalEl.src = profilePicData;
                 imgModalEl.style.display = 'block';
                 iconModalEl.style.display = 'none';
             } else {
                 imgModalEl.src = '';
                 imgModalEl.style.display = 'none';
                 iconModalEl.style.display = 'block';
             }

             document.getElementById('modal-perfil').style.display = 'block';
        }

        const salvarDadosPerfil = () => {
             const firstName = document.getElementById('perfil-first-name').value.trim();
             const lastName = document.getElementById('perfil-last-name').value.trim();
             const email = document.getElementById('perfil-email').value.trim();
             const phone = document.getElementById('perfil-phone').value.trim();
             const feedback = document.getElementById('perfil-feedback');
             
             if (!firstName || !email) {
                 feedback.textContent = 'Nome e Email s√£o obrigat√≥rios.';
                 feedback.style.display = 'block';
                 return;
             }
             
             const currentUser = carregarUsuario();
             const updatedUser = {
                 ...currentUser,
                 firstName: firstName,
                 lastName: lastName,
                 email: email,
                 phone: phone
             };
             
             salvarUsuario(updatedUser);
             feedback.textContent = 'Dados atualizados com sucesso!';
             feedback.style.color = 'var(--cor-sucesso)';
             feedback.style.display = 'block';
             
             // Atualiza o painel principal
             document.getElementById('welcome-message').textContent = getGreeting(firstName);
             renderSidebarProfile();

             // Fecha o modal ap√≥s um breve feedback
             setTimeout(() => {
                 document.getElementById('modal-perfil').style.display = 'none';
             }, 1000);
        }
        
        const excluirConta = () => {
             if (confirm('CONFIRMA√á√ÉO FINAL: Esta a√ß√£o ir√° APAGAR TODOS os seus dados de perfil, transa√ß√µes, d√≠vidas e fixas. Voc√™ ter√° que se cadastrar novamente. TEM CERTEZA?')) {
                 localStorage.clear();
                 window.location.reload(); 
             }
        }


        // ===========================================
        // FUN√á√ïES DE CADASTRO/LOGIN
        // ===========================================
        
        const validarSenha = (senha) => {
             // M√≠nimo 8 caracteres
             if (senha.length < 8) return "A senha deve ter no m√≠nimo 8 caracteres.";
             // Pelo menos 1 letra mai√∫scula
             if (!/[A-Z]/.test(senha)) return "A senha deve conter pelo menos 1 letra mai√∫scula.";
             // Pelo menos 1 letra min√∫scula
             if (!/[a-z]/.test(senha)) return "A senha deve conter pelo menos 1 letra min√∫scula.";
             // Pelo menos 1 caractere especial (N√£o alfanum√©rico)
             if (!/[^a-zA-Z0-9]/.test(senha)) return "A senha deve conter pelo menos 1 caractere especial.";
             return true; 
        }

        const abrirTelaCadastro = () => {
             document.getElementById('login-screen').style.display = 'none';
             document.getElementById('cadastro-screen').style.display = 'flex';
             document.getElementById('reg-feedback').style.display = 'none';
        }
        
        const fecharTelaCadastro = () => {
             document.getElementById('cadastro-screen').style.display = 'none';
             document.getElementById('login-screen').style.display = 'flex';
             document.getElementById('login-feedback').textContent = '';
        }

        const cadastrarNovoUsuario = () => {
            const firstName = document.getElementById('reg-first-name-input').value.trim();
            const lastName = document.getElementById('reg-last-name-input').value.trim();
            const email = document.getElementById('reg-email-input').value.trim();
            const phone = document.getElementById('reg-phone-input').value.trim();
            const password = document.getElementById('reg-password-input').value;
            const feedback = document.getElementById('reg-feedback');

            feedback.style.color = 'var(--cor-divida)';

            if (!firstName || !email || !password) {
                 feedback.textContent = 'Preencha todos os campos obrigat√≥rios (Nome, Email, Senha).';
                 feedback.style.display = 'block';
                 return;
            }

            const validacao = validarSenha(password);
            if (validacao !== true) {
                 feedback.textContent = validacao;
                 feedback.style.display = 'block';
                 return;
            }

            // Simula√ß√£o de armazenamento do novo usu√°rio
            const newUser = {
                 firstName: firstName,
                 lastName: lastName,
                 email: email,
                 phone: phone,
                 password: password 
            };
            salvarUsuario(newUser);
            
            // Feedback de sucesso e transi√ß√£o
            feedback.textContent = 'Cadastro realizado com sucesso! Redirecionando para o login...';
            feedback.style.color = 'var(--cor-sucesso)';
            feedback.style.display = 'block';

            // Limpa os campos ap√≥s 1 segundo e volta para o login
            setTimeout(() => {
                 document.getElementById('reg-first-name-input').value = '';
                 document.getElementById('reg-last-name-input').value = '';
                 document.getElementById('reg-email-input').value = '';
                 document.getElementById('reg-phone-input').value = '';
                 document.getElementById('reg-password-input').value = '';
                 fecharTelaCadastro();
                 
                 // Limpar campos de login ap√≥s o cadastro
                 document.getElementById('login-email-input').value = '';
                 document.getElementById('login-password-input').value = '';
            }, 1500);
        }

        const realizarLogin = () => {
             const loginInput = document.getElementById('login-email-input').value.trim();
             const password = document.getElementById('login-password-input').value;
             const feedback = document.getElementById('login-feedback');
             
             const user = carregarUsuario(); // Tenta carregar o usu√°rio cadastrado
             
             let isAuthenticated = false;
             
             // L√≥gica de autentica√ß√£o
             // 1. Tenta autenticar por Email e Senha
             if (user.email === loginInput && user.password === password) {
                 isAuthenticated = true;
             }
             // 2. Tenta autenticar por Primeiro Nome e Senha
             else if (user.firstName.toLowerCase() === loginInput.toLowerCase() && user.password === password) {
                 isAuthenticated = true;
             }
             // 3. Tenta autenticar com a senha padr√£o (caso n√£o tenha cadastro ou seja a primeira vez)
             else if (loginInput === user.firstName && password === DEFAULT_PASSWORD && user.password === DEFAULT_PASSWORD) {
                 isAuthenticated = true;
             }

             if (isAuthenticated) {
                 localStorage.setItem('loggedIn', 'true');
                 document.getElementById('login-screen').style.display = 'none';
                 document.getElementById('main-content').style.display = 'block';
                 
                 document.getElementById('mySidebar').style.width = '0'; 

                 startSessionTimer();
                 initDashboard();
             } else {
                 feedback.textContent = 'ACESSO NEGADO: Email/Nome ou Senha incorretos.';
                 feedback.style.color = 'var(--cor-divida)';
             }
        }


        // ===========================================
        // INICIALIZA√á√ÉO DO DASHBOARD 
        // ===========================================
        
        const initDashboard = () => {
            const transacoes = carregarTransacoes();
            const dividas = carregarDividas();
            const fixas = checkAndResetContasFixas(); 
            
            // Novos: Personaliza√ß√£o
            const firstName = carregarUsuario().firstName || "Usu√°rio";
            document.getElementById('welcome-message').textContent = getGreeting(firstName);
            renderSidebarProfile(); 
            
            // ************ CORRE√á√ÉO APLICADA AQUI: ************
            // N√£o deleta o log. Apenas garante que a data de acesso esteja atualizada.
            checkAndCleanLog(); // Chamada para atualizar a data, mas sem limpar transa√ß√µes.
            // *************************************************

            atualizarDashboard(transacoes, dividas, fixas);
            renderizarTabelas(transacoes, dividas, fixas); 
            verificarEstadoContasFixas(fixas, dividas); // Passando d√≠vidas
        };
        
        // --- FUN√á√ÉO AJUSTADA: Mant√©m o capital, apenas simula a limpeza no dashboard ---
        const checkAndCleanLog = () => {
             const hoje = getHojeString();
             const ultimaLimpeza = localStorage.getItem('lastLogCleanDate');
             
             if (ultimaLimpeza !== hoje) {
                 // A √∫nica fun√ß√£o desta chamada agora √© ATUALIZAR A DATA
                 localStorage.setItem('lastLogCleanDate', hoje);
                 console.log(`Nova data de acesso: ${hoje}. O Capital Acumulado foi mantido.`);
             }
             // N√£o retorna transa√ß√µes, apenas atualiza a data.
        }

        // --- Fun√ß√µes de Contas Fixas ---
        const isHojePassouDiaQuinze = () => new Date().getDate() > 15;
        const checkAndResetContasFixas = () => {
            let fixas = carregarContasFixas();
            
            // Se as fixas iniciais n√£o foram carregadas, salva
            if (fixas.length === 0) {
                 salvarContasFixas(CONTAS_FIXAS_INITIAL);
                 fixas = CONTAS_FIXAS_INITIAL;
            }
            
            // L√≥gica de Reset mensal (ap√≥s o dia 15)
            // Mantida a l√≥gica original, pois √© um reset MENSAL das contas a pagar.
            if (isHojePassouDiaQuinze() && localStorage.getItem('fixasResetadas') !== getHojeString()) {
                fixas = CONTAS_FIXAS_INITIAL.map(fixa => ({...fixa, pago: false}));
                salvarContasFixas(fixas);
                localStorage.setItem('fixasResetadas', getHojeString());
                // Mensagem de alerta de reset (opcional)
                console.log('Contas Fixas resetadas para o novo ciclo.');
            }
            return fixas;
        }
        const pagarContaFixa = (id) => {
            let fixas = carregarContasFixas();
            const transacoes = carregarTransacoes();
            const dividas = carregarDividas(); 
            const fixaIndex = fixas.findIndex(f => f.id === id);
            const fixa = fixas[fixaIndex];
            
            if (fixa && !fixa.pago) {
                const { totalReceitas } = getTotais(transacoes, dividas, fixas); 
                if (totalReceitas >= fixa.valor) {
                    fixa.pago = true;
                    salvarContasFixas(fixas);
                    const novaTransacao = {
                        data: getHojeString(),
                        valor: (-fixa.valor).toFixed(2), 
                        descricao: `Pagamento de Conta Fixa: ${fixa.nome}`
                    };
                    transacoes.push(novaTransacao);
                    salvarTransacoes(transacoes);
                    initDashboard(); 
                } else {
                    alert(`Capital insuficiente (${formatarMoeda(totalReceitas)}) para pagar ${fixa.nome} (${formatarMoeda(fixa.valor)})`);
                }
            }
        }
        
        // NOVO: Fun√ß√£o que verifica o estado das fixas e controla a visibilidade das D√≠vidas
        const verificarEstadoContasFixas = (fixas, dividas) => {
            const todasPagas = fixas.every(f => f.pago);
            const feedbackEl = document.getElementById('feedback-fixas-quitadas');
            const fixasToggle = document.getElementById('contas-fixas-toggle');
            const dividasContainer = document.getElementById('dividas-container');
            const planoQuitacao = document.getElementById('plano-quitacao-master');
            
            // L√≥gica para D√çVIDAS e PLANO DE QUITA√á√ÉO (Corre√ß√£o 4: Aparecer se houver d√≠vidas)
            const totalDividasPendentes = dividas.reduce((sum, d) => sum + d.valorAtual, 0);

            if (dividas.length > 0 && totalDividasPendentes > 0.01) {
                 dividasContainer.style.display = 'block'; 
                 planoQuitacao.style.display = 'block'; 
                 // Chamada sempre que o estado √© verificado para manter o plano atualizado
                 gerarPlanoQuitacaoIA(false, totalDividasPendentes); 
                 renderizarDicasQuitacao(dividas);
            } else {
                 dividasContainer.style.display = 'none'; 
                 planoQuitacao.style.display = 'none'; 
                 document.getElementById('dicas-quitacao').innerHTML = '<p style="color: var(--cor-texto-secundario); font-weight: bold; margin-top: 15px;"><i class="fas fa-info-circle"></i> Cadastre sua primeira D√≠vida √önica para ativar o Plano de Quita√ß√£o Estrat√©gico.</p>';
            }


            // L√≥gica para CONTAS FIXAS
            if (todasPagas) {
                feedbackEl.style.display = 'block';
                fixasToggle.style.display = 'none'; 
            } else {
                feedbackEl.style.display = 'none';
                fixasToggle.style.display = 'block';
            }
        }
        
        // --- Fun√ß√µes de Transa√ß√£o ---
        const cadastrarReceita = () => {
            const valorInput = document.getElementById('valor-input-receita');
            const valor = parseFloat(valorInput.value);
            if (isNaN(valor) || valor <= 0) {
                 alert('Por favor, insira um valor positivo v√°lido.');
                 return;
            }
            const transacoes = carregarTransacoes();
            const novaTransacao = {
                data: getHojeString(),
                valor: valor.toFixed(2), 
                descricao: 'Saldo Adicionado (Receita)'
            };
            transacoes.push(novaTransacao);
            salvarTransacoes(transacoes);
            valorInput.value = '';
            document.getElementById('modal-receita').style.display = 'none';
            initDashboard();
        }
        
        // ************ CORRE√á√ÉO APLICADA AQUI: ************
        // Deletar transa√ß√£o agora s√≥ remove entradas de HOJE no log de exibi√ß√£o.
        const deletarTransacao = (displayIndex) => {
            let transacoes = carregarTransacoes();
            // Filtra e ordena as transa√ß√µes de ENTRADA (valor > 0) para a data de HOJE
            const transacoesEntradaHoje = transacoes
                                            .filter(t => parseFloat(t.valor) > 0 && t.data === getHojeString())
                                            .map((t, i) => ({...t, displayIndex: i})) // Adiciona displayIndex
                                            .sort((a, b) => new Date(b.data) - new Date(a.data));
            
            const transacaoToDelete = transacoesEntradaHoje.find(t => t.displayIndex === displayIndex);
            
            if (transacaoToDelete) {
                // Encontra o √≠ndice da transa√ß√£o original (no array completo) para remo√ß√£o
                // Usa a descri√ß√£o, valor e data (com valor > 0) para encontrar a primeira correspond√™ncia
                const indexToRemove = transacoes.findIndex(t => 
                    t.data === transacaoToDelete.data && 
                    parseFloat(t.valor).toFixed(2) === parseFloat(transacaoToDelete.valor).toFixed(2) &&
                    parseFloat(t.valor) > 0
                );
                
                if (indexToRemove !== -1) {
                    transacoes.splice(indexToRemove, 1);
                    salvarTransacoes(transacoes);
                    initDashboard();
                }
            } else {
                 alert('Transa√ß√£o n√£o encontrada ou n√£o √© uma receita de hoje.');
            }
        }
        // *************************************************

        
        // NOVO: Fun√ß√£o para adicionar d√≠vida
        const adicionarDivida = () => {
            const credorInput = document.getElementById('credor-input-divida');
            const valorInput = document.getElementById('valor-input-divida');
            const credor = credorInput.value.trim();
            const valor = parseFloat(valorInput.value);
            
            if (!credor || isNaN(valor) || valor <= 0) {
                 alert('Por favor, preencha o Credor e um Valor positivo v√°lido.');
                 return;
            }
            
            let dividas = localStorage.getItem('dividas') ? JSON.parse(localStorage.getItem('dividas')) : [];
            // Gera um ID sequencial para a nova d√≠vida, considerando as j√° quitadas
            const novoId = dividas.length > 0 ? Math.max(...dividas.map(d => d.id)) + 1 : 1; 
            
            const novaDivida = {
                id: novoId,
                credor: credor,
                valorInicial: valor,
                valorAtual: valor
            };
            
            dividas.push(novaDivida);
            salvarDividas(dividas); // Salva todas, incluindo a nova (que ser√° filtrada na pr√≥xima leitura se o valorAtual for 0)
            
            credorInput.value = '';
            valorInput.value = '';
            document.getElementById('modal-divida').style.display = 'none';
            
            initDashboard(); 
        }

        // NOVO: Fun√ß√£o para deletar d√≠vida
        const deletarDivida = (id) => {
             if (confirm('ATEN√á√ÉO: Isso ir√° apagar esta d√≠vida e todo o seu hist√≥rico de pagamentos/aportes a ela. Deseja continuar?')) {
                 let dividas = localStorage.getItem('dividas') ? JSON.parse(localStorage.getItem('dividas')) : [];
                 const dividaIndex = dividas.findIndex(d => d.id === id);
                 
                 if (dividaIndex !== -1) {
                     const nomeCredor = dividas[dividaIndex].credor;
                     dividas.splice(dividaIndex, 1);
                     salvarDividas(dividas);
                     
                     // Opcional: Remover transa√ß√µes de quita√ß√£o desta d√≠vida
                     let transacoes = carregarTransacoes();
                     transacoes = transacoes.filter(t => t.descricao !== `Quita√ß√£o de D√≠vida: ${nomeCredor}`);
                     salvarTransacoes(transacoes);

                     initDashboard();
                 } else {
                     alert('D√≠vida n√£o encontrada.');
                 }
             }
        }


        // --- Fun√ß√µes de Quita√ß√£o de D√≠vida (Ajustadas) ---
        
        const realizarPagamentoDivida = (tipo) => {
             const valorInput = document.getElementById('valor-pagamento');
             let valorPagamento = parseFloat(valorInput.value);
             
             let dividas = localStorage.getItem('dividas') ? JSON.parse(localStorage.getItem('dividas')) : [];
             let transacoes = carregarTransacoes();
             let fixas = carregarContasFixas(); 
             
             const dividaIndex = dividas.findIndex(d => d.id === idDebtQuitting);
             const divida = dividas[dividaIndex];
             if (!divida) { alert('Erro: D√≠vida n√£o encontrada.'); return; }
             
             const { totalReceitas } = getTotais(transacoes, dividas, fixas); 
             
             if (tipo === 'total') {
                 // Quita√ß√£o total: Valor √© o saldo da d√≠vida, limitado ao capital
                 valorPagamento = Math.min(divida.valorAtual, totalReceitas);
             } else { // Parcial
                 if (isNaN(valorPagamento) || valorPagamento <= 0) {
                     alert('Por favor, insira um valor de pagamento positivo v√°lido.');
                     return;
                 }
                 // Pagamento parcial: Valor √© o do input, limitado ao saldo da d√≠vida e ao capital
                 valorPagamento = Math.min(valorPagamento, divida.valorAtual, totalReceitas);
             }


             if (valorPagamento <= 0.01) {
                 alert('Capital acumulado ou saldo da d√≠vida insuficiente para o pagamento.');
                 return;
             }
             
             // Atualiza a d√≠vida
             divida.valorAtual = Math.max(0, divida.valorAtual - valorPagamento);
             salvarDividas(dividas);
             
             // Registra a transa√ß√£o de sa√≠da
             const novaTransacao = {
                 data: getHojeString(),
                 valor: (-valorPagamento).toFixed(2), 
                 descricao: `Quita√ß√£o de D√≠vida: ${divida.credor}`
             };
             transacoes.push(novaTransacao);
             salvarTransacoes(transacoes);
             
             valorInput.value = '';
             document.getElementById('modal-quitacao').style.display = 'none';
             idDebtQuitting = null;
             initDashboard();
        }
        
        // --- L√≥gica de Neg√≥cio e Dashboard (Ajuste no getTotais) ---
        const getSomaFixas = (fixas) => fixas.filter(f => !f.pago).reduce((sum, item) => sum + item.valor, 0);
        const getMetaDiariaFixas = (somaFixas) => somaFixas / DIAS_UTEIS_MES;
        
        // ************ CORRE√á√ÉO APLICADA AQUI: ************
        // O aporte do dia deve considerar apenas transa√ß√µes com a data de hoje
        const getReceitasPorDia = (transacoes, dataAlvo = getHojeString()) => {
             let recebidoHoje = 0;
             // Filtra as transa√ß√µes de ENTRADA (valor > 0) para a data alvo
             transacoes.filter(t => parseFloat(t.valor) > 0 && t.data === dataAlvo).forEach(t => { 
                 recebidoHoje += parseFloat(t.valor);
             });
             return recebidoHoje;
        }

        // ************ CORRE√á√ÉO APLICADA AQUI: ************
        // O Total de Receitas AGORA considera TODAS as transa√ß√µes (passadas e presentes),
        // pois a limpeza de log foi desativada.
        const getTotais = (transacoes, dividas, fixas) => {
            // totalReceitas √© a SOMA L√çQUIDA de todas as transa√ß√µes (Entradas (+) e Sa√≠das (-))
            let totalReceitas = transacoes.reduce((sum, t) => sum + parseFloat(t.valor), 0); 
            totalReceitas = Math.max(0, totalReceitas); // Garante que o capital n√£o seja negativo
            
            // Total de d√≠vidas ativas
            const dividasAtivas = dividas.filter(d => d.valorAtual > 0.01);
            
            // Soma do valor inicial de todas as d√≠vidas ativas e quitadas (base para 100% do progresso)
            const todasDividas = localStorage.getItem('dividas') ? JSON.parse(localStorage.getItem('dividas')) : [];
            const totalDividasIniciais = todasDividas.reduce((sum, d) => sum + parseFloat(d.valorInicial), 0); 
            
            // Soma do saldo atual pendente (o que falta pagar)
            const totalDividasPendentes = dividasAtivas.reduce((sum, d) => sum + parseFloat(d.valorAtual), 0);
            
            // Valor j√° pago (para o progresso) = Total Inicial - Total Pendente
            const totalPagoDividas = totalDividasIniciais - totalDividasPendentes; 
            
            const progressoCapital = totalDividasIniciais > 0.01 
                ? (totalPagoDividas / totalDividasIniciais) * 100 
                : (totalDividasPendentes === 0 ? 100 : 0);
                
            // Saldo Pendente Total = D√≠vidas Pendentes + Contas Fixas Pendentes
            const somaFixasPendentes = fixas.filter(f => !f.pago).reduce((sum, item) => sum + item.valor, 0);
            const saldoPendenteTotal = totalDividasPendentes + somaFixasPendentes; 

            return { totalReceitas, totalDividasIniciais, totalDividasPendentes, progressoCapital, saldoPendenteTotal, somaFixasPendentes };
        }
        // *************************************************

        
        const gerarPlanoQuitacaoIA = (isInit = false, totalDividasPendentes) => {
             const meses = parseInt(document.getElementById('meses-plano').value) || 5;
             const resultadoEl = document.getElementById('resultado-plano-ia');
             
             if (totalDividasPendentes <= 0.01) {
                 if (!isInit) {
                      resultadoEl.innerHTML = '<p style="color: var(--cor-sucesso); font-weight: bold; margin-top: 15px;"><i class="fas fa-check-circle"></i> Protocolo de d√≠vida conclu√≠do. Foco em acumula√ß√£o de capital!</p>';
                 }
                 return 0;
             }
             
             const valorMensalNecessario = totalDividasPendentes / meses;
             const valorDiarioNecessario = valorMensalNecessario / DIAS_UTEIS_MES; 
             
             if (!isInit) {
                  const valorSemanalNecessario = valorDiarioNecessario * 5; 
                  let html = `
                     <p style="margin-bottom: 15px; color: var(--cor-texto-secundario); font-family: var(--fonte-titulo); font-weight: 600;">Para quitar **${formatarMoeda(totalDividasPendentes)}** em **${meses} meses**:</p>
                     <p><i class="fas fa-calendar-alt" style="color: var(--cor-destaque-ia);"></i> Aporte Mensal Necess√°rio: <strong>${formatarMoeda(valorMensalNecessario)}</strong></p>
                     <p><i class="fas fa-calendar-week" style="color: var(--cor-destaque-ia);"></i> Aporte Semanal (5 dias √∫teis): <strong>${formatarMoeda(valorSemanalNecessario)}</strong></p>
                     <p><i class="fas fa-sun" style="color: var(--cor-destaque-ia);"></i> Aporte Di√°rio (por dia √∫til): <strong>${formatarMoeda(valorDiarioNecessario)}</strong></p>
                  `;
                  resultadoEl.innerHTML = html;
             }
             return valorDiarioNecessario; 
        };
        
        // FUN√á√ÉO AJUSTADA PARA REFLETIR O REIN√çCIO DI√ÅRIO DA META
        const getMetaDiariaAtingida = (transacoes, dividas, fixas, dataAlvo = getHojeString()) => {
            const somaFixasPendentes = getSomaFixas(fixas);
            const metaDiariaFixas = somaFixasPendentes / DIAS_UTEIS_MES;
            
            // RECEBIDO AGORA CHAMA A FUN√á√ÉO AJUSTADA QUE S√ì CONSIDERA O DIA ATUAL
            const recebido = getReceitasPorDia(transacoes, dataAlvo); 
            
            // A meta de quita√ß√£o di√°ria s√≥ √© calculada se houver d√≠vidas pendentes
            const totalDividasPendentes = dividas.reduce((sum, d) => sum + d.valorAtual, 0);
            const metaQuitacaoDiaria = totalDividasPendentes > 0.01 ? gerarPlanoQuitacaoIA(true, totalDividasPendentes) : 0; 

            const metaTotalDiaria = metaDiariaFixas + metaQuitacaoDiaria;
            const faltando = Math.max(0, metaTotalDiaria - recebido);
            
            // O atingido √© baseado no aporte do dia contra a meta do dia
            const atingido = recebido >= metaTotalDiaria - 0.009; 
            
            return {
                metaTotal: metaTotalDiaria,
                atingido: atingido, 
                recebido: recebido,
                faltando: faltando
            };
        }
        
        const atualizarDashboard = (transacoes, dividas, fixas) => {
            // FIX: totalReceitas agora √© o capital l√≠quido (acumulado)
            const { totalReceitas, totalDividasPendentes, progressoCapital, saldoPendenteTotal, somaFixasPendentes } = getTotais(transacoes, dividas, fixas); 
            
            document.getElementById('data-atual').textContent = new Date().toLocaleDateString('pt-BR');
            document.getElementById('soma-fixas').textContent = formatarMoeda(somaFixasPendentes).replace('R$', '').trim(); 
            // FIX: total-lancado agora exibe o capital l√≠quido acumulado
            document.getElementById('total-lancado').textContent = formatarMoeda(totalReceitas); 
            document.getElementById('saldo-pendente-total').textContent = formatarMoeda(saldoPendenteTotal);
            document.getElementById('total-dividas-pendentes').textContent = formatarMoeda(totalDividasPendentes);
            
            const progressoExibido = Math.min(100, progressoCapital).toFixed(2);
            document.getElementById('progresso-capital-txt').textContent = `${progressoExibido}%`;
            document.getElementById('progresso-bar').style.width = `${progressoExibido}%`; 
            
            renderizarMetaDiaria(transacoes, dividas, fixas);
        };
        
        // --- Fun√ß√µes de Renderiza√ß√£o ---
        const renderizarContasFixas = (fixas) => {
            const container = document.getElementById('lista-contas-fixas-tabela');
            if (!container) return; 
            container.innerHTML = ''; 
            const fixasPendentes = fixas.filter(f => !f.pago);
            fixasPendentes.forEach((fixa) => {
                const btnClass = 'pagar-fixa';
                const btnText = 'PAGAR';
                const row = container.insertRow();
                row.id = `fixa-row-${fixa.id}`;
                row.innerHTML = `
                    <td><span style="color: var(--cor-texto-principal);">${fixa.nome}</span></td>
                    <td><span style="color: var(--cor-fixa); font-weight: 700;">${formatarMoeda(fixa.valor)}</span></td>
                    <td style="text-align: center;">
                        <button class="btn-acao-tabela ${btnClass}" data-id="${fixa.id}">
                            ${btnText}
                        </button>
                    </td>
                `;
            });
            if(fixasPendentes.length === 0) {
                 container.innerHTML = '<tr><td colspan="3" style="text-align: center; color: var(--cor-texto-secundario); opacity: 0.6;">Todas as contas fixas foram liquidadas neste ciclo.</td></tr>';
            }
        };
        const renderizarD√≠vidas = (dividas) => {
            const container = document.getElementById('lista-dividas-quitar-tabela');
            const { totalReceitas } = getTotais(carregarTransacoes(), dividas, carregarContasFixas()); 
            if (!container) return;
            container.innerHTML = '';
            // Dividas j√° est√£o carregadas e filtradas para valorAtual > 0.01
            const dividasPendentes = dividas; 
            
            if (dividasPendentes.length === 0) {
                container.innerHTML = '<tr><td colspan="3" style="text-align: center; color: var(--cor-sucesso); font-weight: bold;">Nenhuma d√≠vida √∫nica pendente. Parab√©ns!</td></tr>';
                return;
            }
            dividasPendentes.forEach((divida) => {
                const podeQuitarTotal = totalReceitas >= divida.valorAtual - 0.009; 
                
                const row = container.insertRow();
                row.innerHTML = `
                    <td><span style="color: var(--cor-texto-principal); font-weight: 600;">${divida.credor}</span></td>
                    <td><span style="color: var(--cor-divida); font-weight: 700;">${formatarMoeda(divida.valorAtual)}</span></td>
                    <td style="text-align: center;">
                        <div class="divida-actions">
                             <button class="btn-acao-tabela deletar-divida" data-id="${divida.id}" title="Deletar D√≠vida"><i class="fas fa-trash"></i></button>
                             <button class="btn-acao-tabela pagamento-divida" data-id="${divida.id}" data-credor="${divida.credor}" data-valor="${divida.valorAtual}">
                                 ${podeQuitarTotal ? 'QUITA√á√ÉO TOTAL' : 'PAGAR'}
                             </button>
                        </div>
                    </td>
                `;
            });
        };
        
        // ************ CORRE√á√ÉO APLICADA AQUI: ************
        // O Log de Receitas (Entradas) agora mostra APENAS as transa√ß√µes de HOJE.
        const renderizarLogReceitas = (transacoes) => {
            const listaEntradasBody = document.getElementById('lista-entradas');
            // Filtra as transa√ß√µes de ENTRADA (valor > 0) que foram feitas HOJE
            const transacoesEntradaHoje = transacoes.filter(t => parseFloat(t.valor) > 0 && t.data === getHojeString());
            
            // Mapeia para adicionar um √≠ndice de exibi√ß√£o (displayIndex) para fins de dele√ß√£o na tabela
            const transacoesOrdenadas = transacoesEntradaHoje
                                            .map((t, index) => ({...t, displayIndex: index}))
                                            .sort((a, b) => new Date(b.data) - new Date(a.data));
                                            
            listaEntradasBody.innerHTML = '';
            if (transacoesOrdenadas.length === 0) {
                 listaEntradasBody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: var(--cor-texto-secundario);">Nenhuma receita lan√ßada no log de hoje.</td></tr>';
            } else {
                transacoesOrdenadas.forEach((t) => {
                    const row = listaEntradasBody.insertRow();
                    row.innerHTML = `
                        <td><span class="log-receita-descricao">SALDO ADICIONADO</span></td>
                        <td class="log-receita-valor">${formatarMoeda(t.valor)}</td>
                        <td style="text-align: center;">
                            <button class="btn-acao-tabela deletar-log" data-index="${t.displayIndex}"><i class="fas fa-trash"></i></button>
                        </td>
                    `;
                });
            }
        };
        // *************************************************

        const renderizarTabelas = (transacoes, dividas, fixas) => {
             renderizarLogReceitas(transacoes);
             renderizarContasFixas(fixas);
             renderizarD√≠vidas(dividas);
        }
        
        // FUN√á√ÉO AJUSTADA PARA REIN√çCIO DI√ÅRIO
        const renderizarMetaDiaria = (transacoes, dividas, fixas) => {
             // O c√°lculo da meta total e do recebido considera APENAS as transa√ß√µes de HOJE
             const { metaTotal, atingido, recebido, faltando } = getMetaDiariaAtingida(transacoes, dividas, fixas, getHojeString());
             const metaDiariaTotalEl = document.getElementById('meta-diaria-total-el');
             const metaDiariaCard = document.getElementById('meta-diaria-card');
             const metaDiariaIncentivoEl = document.getElementById('meta-diaria-incentivo');
             
             // O valor total da meta SEMPRE ser√° recalculado
             metaDiariaTotalEl.textContent = formatarMoeda(metaTotal);
             
             if (atingido) {
                 metaDiariaCard.classList.add('meta-batida');
                 metaDiariaTotalEl.style.color = 'var(--cor-sucesso)'; 
                 metaDiariaIncentivoEl.style.display = 'block';
                 metaDiariaIncentivoEl.innerHTML = `
                     <i class="fas fa-medal"></i> **META DI√ÅRIA BATIDA!** <i class="fas fa-medal"></i>
                     <p style="color: var(--cor-fixa); font-size: 0.9em; margin-top: 5px; font-style: normal;">Capital Extra Acumulado: ${formatarMoeda(recebido - metaTotal)}</p>
                 `;
                 metaDiariaIncentivoEl.style.color = 'var(--cor-sucesso)';
             } else {
                 metaDiariaCard.classList.remove('meta-batida');
                 metaDiariaTotalEl.style.color = 'var(--cor-meta-diaria)';
                 metaDiariaCard.style.border = `1px solid var(--cor-meta-diaria)`; 
                 metaDiariaIncentivoEl.style.display = 'block';
                 metaDiariaIncentivoEl.innerHTML = `
                     <i class="fas fa-exclamation-circle"></i> **FALTAM ${formatarMoeda(faltando)}** PARA BATER A META DI√ÅRIA.
                 `;
                 metaDiariaIncentivoEl.style.color = 'var(--cor-alerta)';
             }
        }
        // NOVO: Renderiza√ß√£o da Bola de Neve com mais destaque
        const renderizarDicasQuitacao = (dividas) => {
             const div = document.getElementById('dicas-quitacao');
             const dividasPendentes = dividas.filter(d => d.valorAtual > 0.01);
             div.className = 'estrategia-quitacao'; // Remove a classe antiga para aplicar o novo estilo

             if (dividasPendentes.length === 0) { 
                 div.innerHTML = '<p style="color: var(--cor-sucesso); font-weight: bold;"><i class="fas fa-check-double"></i> Sem d√≠vidas para aplicar a estrat√©gia!</p>'; 
                 return; 
             }
             
             let html = `
                 <h4><i class="fas fa-snowflake"></i> ESTRAT√âGIA: BOLA DE NEVE (MENOR PARA MAIOR)</h4>
                 <p style="margin-bottom: 20px; color: var(--cor-texto-secundario); font-size: 0.9em;">
                    Priorize as **menores d√≠vidas** para criar impulso mental e financeiro r√°pido. Concentre todo o excedente do seu aporte di√°rio na D√≠vida Priorit√°ria.
                 </p>
             `;
             dividasPendentes.slice(0, 3).forEach((d, index) => {
                 html += `
                     <div class="prioridade-item">
                         <i class="fas fa-angle-right"></i> **PRIORIDADE ${index + 1}:** ${d.credor} 
                         <span style="float: right; color: var(--cor-divida); font-weight: 700;">${formatarMoeda(d.valorAtual)}</span>
                     </div>
                 `;
             });
             html += `
                 <p class="prioridade-acao">
                     <i class="fas fa-bolt"></i> **A√á√ÉO:** Direcione **TODO** capital excedente para a d√≠vida **PRIORIDADE 1** (${dividasPendentes[0].credor}).
                 </p>
             `;
             div.innerHTML = html;
        }
        
        // ************ CORRE√á√ÉO APLICADA AQUI: ************
        // O relat√≥rio agora calcula a meta di√°ria de forma fixa (o que deveria ter sido aportado)
        // e o aporte di√°rio baseado nas entradas de cada dia.
        const calcularRelatorioDiario = (transacoes, dividas, fixas) => {
            // 1. Mapear receitas por dia (de todos os dias)
            const receitasDiarias = {};
            transacoes.filter(t => parseFloat(t.valor) > 0).forEach(t => { 
                 const data = t.data;
                 receitasDiarias[data] = (receitasDiarias[data] || 0) + parseFloat(t.valor);
            });
            
            // 2. Obter todas as datas √∫nicas e adicionar a data de hoje, se n√£o estiver inclusa
            const todasAsDatas = Array.from(new Set(Object.keys(receitasDiarias)));
            const hoje = getHojeString();
            if (!todasAsDatas.includes(hoje)) { todasAsDatas.push(hoje); }
            todasAsDatas.sort((a, b) => new Date(b) - new Date(a));
            
            // 3. Calcular Meta Di√°ria Fija (Contas Fixas)
            const somaFixas = CONTAS_FIXAS_INITIAL.reduce((sum, item) => sum + item.valor, 0);
            const metaDiariaFixas = somaFixas / DIAS_UTEIS_MES;
            
            // 4. Calcular Meta Di√°ria de Quita√ß√£o (Baseado no valor inicial TOTAL das d√≠vidas)
            const todasDividas = localStorage.getItem('dividas') ? JSON.parse(localStorage.getItem('dividas')) : [];
            const totalDividasIniciais = todasDividas.reduce((sum, d) => sum + parseFloat(d.valorInicial), 0);
            
            const meses = parseInt(document.getElementById('meses-plano').value) || 5;
            // Se n√£o h√° d√≠vidas iniciais, a meta de quita√ß√£o √© 0
            const metaQuitacaoDiaria = totalDividasIniciais > 0.01 ? (totalDividasIniciais / meses) / DIAS_UTEIS_MES : 0; 
            const metaTotalDiaria = metaDiariaFixas + metaQuitacaoDiaria;
            
            // 5. Gerar Relat√≥rio
            const relatorio = todasAsDatas.map(data => {
                const recebido = receitasDiarias[data] || 0;
                // A meta do relat√≥rio √© baseada no c√°lculo FIXO, para fins de hist√≥rico
                const atingido = recebido >= metaTotalDiaria - 0.009;
                return {
                    data: data,
                    meta: metaTotalDiaria,
                    aportado: recebido,
                    atingido: atingido
                };
            });
            return relatorio;
        }
        // *************************************************

        const renderizarRelatorioDiario = (relatorio) => {
            const corpoTabela = document.getElementById('corpo-tabela-relatorio');
            corpoTabela.innerHTML = '';
            if (relatorio.length === 0) {
                corpoTabela.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--cor-texto-secundario);">Nenhum registro de meta di√°ria.</td></tr>';
                return;
            }
            relatorio.forEach(item => {
                const row = corpoTabela.insertRow();
                const statusClass = item.atingido ? 'meta-batida-status' : 'meta-nao-batida-status';
                const statusText = item.atingido ? '<i class="fas fa-check-circle"></i> BATIDA' : '<i class="fas fa-times-circle"></i> FALHOU';
                if (item.data === getHojeString()) { row.style.backgroundColor = 'rgba(155, 89, 182, 0.1)'; }
                row.innerHTML = `
                    <td>${new Date(item.data).toLocaleDateString('pt-BR')}</td>
                    <td style="color: var(--cor-meta-diaria);">${formatarMoeda(item.meta)}</td>
                    <td style="color: ${item.aportado > item.meta ? 'var(--cor-fixa)' : 'var(--cor-texto-principal)'}; font-weight: 700;">${formatarMoeda(item.aportado)}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                `;
            });
        }
        const abrirModalQuitacao = (credor, valor) => {
             document.getElementById('nome-credor').textContent = credor;
             document.getElementById('saldo-quitacao').textContent = formatarMoeda(valor);
             document.getElementById('valor-pagamento').value = valor.toFixed(2);
             
             // Define a a√ß√£o do bot√£o Quita√ß√£o Total
             const { totalReceitas } = getTotais(carregarTransacoes(), carregarDividas(), carregarContasFixas()); 
             const btnQuitarTotal = document.getElementById('btn-quitar-total');
             
             if (totalReceitas >= valor - 0.009) {
                 btnQuitarTotal.disabled = false;
                 btnQuitarTotal.style.backgroundColor = 'var(--cor-divida)';
             } else {
                 btnQuitarTotal.disabled = true;
                 btnQuitarTotal.style.backgroundColor = 'var(--cor-borda)';
             }

             document.getElementById('modal-quitacao').style.display = 'block';
        }


        // ===========================================
        // EVENT LISTENERS
        // ===========================================
        
        document.addEventListener('DOMContentLoaded', () => {
             carregarUsuario(); 
             
             // Limpar campos de login na inicializa√ß√£o
             document.getElementById('login-email-input').value = '';
             document.getElementById('login-password-input').value = '';

             // --- Login e Cadastro ---
             document.getElementById('btn-login').addEventListener('click', realizarLogin);
             document.getElementById('link-abrir-cadastro').addEventListener('click', (e) => {
                 e.preventDefault();
                 abrirTelaCadastro();
             });
             document.getElementById('btn-voltar-login').addEventListener('click', fecharTelaCadastro);
             document.getElementById('btn-cadastrar').addEventListener('click', cadastrarNovoUsuario);
             
             // --- Menu Sidebar ---
             document.getElementById('menu-toggle').addEventListener('click', openSidebar);
             document.getElementById('close-sidebar').addEventListener('click', closeSidebar);
             
             // NOVO: Bot√µes de Logout/Reset
             document.getElementById('btn-logout-only').addEventListener('click', logoutOnly);
             
             // MOVIDO: Bot√£o de excluir conta agora est√° no modal de perfil
             document.getElementById('btn-excluir-conta-modal').addEventListener('click', excluirConta);
             
             // --- Op√ß√£o de Perfil / Mudar Foto ---
             document.getElementById('menu-perfil').addEventListener('click', abrirModalPerfil);
             document.getElementById('profile-pic-container').addEventListener('click', () => {
                 document.getElementById('photo-input').click();
             });
             document.getElementById('perfil-pic-preview').addEventListener('click', () => {
                 document.getElementById('photo-input').click();
             });
             document.getElementById('photo-input').addEventListener('change', handleProfilePicChange);
             document.getElementById('btn-salvar-perfil').addEventListener('click', salvarDadosPerfil);
             document.getElementById('fechar-modal-perfil').addEventListener('click', () => {
                 document.getElementById('modal-perfil').style.display = 'none';
             });

             // --- Modals e Bot√µes de A√ß√£o (Corre√ß√£o 1: Fechar Modal) ---
             const modalsToClose = ['modal-receita', 'modal-quitacao', 'modal-divida', 'modal-relatorio', 'modal-perfil'];
             modalsToClose.forEach(id => {
                 const modal = document.getElementById(id);
                 if (modal) {
                     modal.style.display = 'none'; 
                     // CORRE√á√ÉO AQUI: Usa o ID completo do span fechar
                     const closeBtn = document.getElementById(`fechar-${id}`); 
                     if (closeBtn) closeBtn.addEventListener('click', () => modal.style.display = 'none');
                 }
             });
             
             // Os listeners dos bot√µes de fechar dos modais j√° devem funcionar com a corre√ß√£o acima

             document.getElementById('abrir-cadastro-receita').addEventListener('click', () => document.getElementById('modal-receita').style.display = 'block');
             document.getElementById('btn-cadastrar-receita').addEventListener('click', cadastrarReceita);
             
             // A√ß√µes de Quita√ß√£o
             document.getElementById('btn-quitar-total').addEventListener('click', () => realizarPagamentoDivida('total'));
             document.getElementById('btn-quitar-parcial').addEventListener('click', () => realizarPagamentoDivida('parcial'));

             // Cadastro de D√≠vida
             document.getElementById('abrir-cadastro-divida').addEventListener('click', () => {
                 document.getElementById('credor-input-divida').value = '';
                 document.getElementById('valor-input-divida').value = '';
                 document.getElementById('modal-divida').style.display = 'block';
             });
             document.getElementById('btn-cadastrar-divida').addEventListener('click', adicionarDivida);

             
             // --- Eventos do Relat√≥rio Di√°rio ---
             document.getElementById('btn-data-atual').addEventListener('click', () => {
                  const transacoes = carregarTransacoes();
                  const dividas = carregarDividas();
                  const fixas = carregarContasFixas();
                  const relatorio = calcularRelatorioDiario(transacoes, dividas, fixas);
                  renderizarRelatorioDiario(relatorio);
                  document.getElementById('modal-relatorio').style.display = 'block';
             });
             
             // --- Toggles (Mantidos) ---
             document.getElementById('toggle-receitas').addEventListener('click', (e) => {
                 const container = document.getElementById('lista-receitas-container');
                 const isOpen = container.style.display === 'block';
                 container.style.display = isOpen ? 'none' : 'block';
                 e.currentTarget.classList.toggle('aberto', !isOpen);
             });
             document.getElementById('toggle-fixas').addEventListener('click', (e) => {
                 const container = document.getElementById('lista-fixas-container');
                 const isOpen = container.style.display === 'block';
                 container.style.display = isOpen ? 'none' : 'block';
                 e.currentTarget.classList.toggle('aberto', !isOpen);
             });
             document.getElementById('toggle-dividas').addEventListener('click', (e) => {
                 const container = document.getElementById('lista-dividas-quitar-container');
                 const isOpen = container.style.display === 'block';
                 container.style.display = isOpen ? 'none' : 'block';
                 e.currentTarget.classList.toggle('aberto', !isOpen);
             });
             
             // --- A√ß√µes de Tabela ---
             document.getElementById('lista-entradas').addEventListener('click', (e) => {
                 if (e.target.closest('.deletar-log')) {
                     const btn = e.target.closest('.deletar-log');
                     const index = btn.getAttribute('data-index');
                     deletarTransacao(parseInt(index));
                 }
             });
             document.getElementById('lista-contas-fixas-tabela').addEventListener('click', (e) => {
                  const button = e.target.closest('.pagar-fixa');
                  if (button && !button.disabled) {
                      const id = parseInt(button.getAttribute('data-id'));
                      pagarContaFixa(id);
                  }
             });
             document.getElementById('lista-dividas-quitar-tabela').addEventListener('click', (e) => {
                  const btnPagar = e.target.closest('.pagamento-divida');
                  const btnDeletar = e.target.closest('.deletar-divida');

                  if (btnPagar) {
                      idDebtQuitting = parseInt(btnPagar.getAttribute('data-id'));
                      const credor = btnPagar.getAttribute('data-credor');
                      const valor = parseFloat(btnPagar.getAttribute('data-valor'));
                      abrirModalQuitacao(credor, valor);
                  } else if (btnDeletar) {
                       const id = parseInt(btnDeletar.getAttribute('data-id'));
                       deletarDivida(id);
                  }
             });
             
             // --- M√≥dulo IA (Mantido) ---
             document.getElementById('btn-gerar-plano').addEventListener('click', () => {
                  const dividas = carregarDividas();
                  const totalDividasPendentes = dividas.reduce((sum, d) => sum + d.valorAtual, 0);
                  gerarPlanoQuitacaoIA(false, totalDividasPendentes);
                  renderizarDicasQuitacao(dividas);
                  const fixas = carregarContasFixas();
                  // Re-renderiza a meta di√°ria ap√≥s recalcular o plano da IA
                  renderizarMetaDiaria(carregarTransacoes(), dividas, fixas); 
             });

             // --- Inicializa√ß√£o da Tela ---
             if (localStorage.getItem('loggedIn') === 'true') {
                 document.getElementById('login-screen').style.display = 'none';
                 document.getElementById('main-content').style.display = 'block';
                 document.getElementById('mySidebar').style.width = '0'; // Garante que esteja fechado
                 startSessionTimer(); 
                 initDashboard();
             } else {
                 document.getElementById('login-screen').style.display = 'flex';
                 document.getElementById('main-content').style.display = 'none';
             }
        });
        

    </script>
</body>
</html>
