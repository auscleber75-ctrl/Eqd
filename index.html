<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Painel Financeiro Otimizado</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* =================================== */
        /* 1. RESET, BASE & VARIÁVEIS CSS      */
        /* =================================== */
        :root {
            /* Cores */
            --cor-fundo-principal: #161b22; /* Darker GitHub background */
            --cor-fundo-card: #0d1117; /* Even darker for contrast */
            --cor-borda: #30363d;
            --cor-texto-principal: #c9d1d9;
            --cor-verde: #238636; /* Success */
            --cor-vermelho: #da3633; /* Danger */
            --cor-azul: #58a6ff; /* Primary/Info */
            --cor-amarelo: #ffc107; /* Warning */

            /* Tipografia */
            --fonte-titulo: 'Inter', sans-serif;
            --fonte-corpo: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: var(--fonte-corpo);
        }

        body {
            background-color: var(--cor-fundo-principal);
            color: var(--cor-texto-principal);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* =================================== */
        /* 2. DASHBOARD HEADER (CARDS)         */
        /* =================================== */

        .dashboard-header {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* Três colunas iguais */
            gap: 20px;
            margin-bottom: 30px;
        }
        
        /* Otimização: Unificando estilos de card */
        .info-card, .progress-area {
            background-color: var(--cor-fundo-card);
            padding: 20px;
            border: 1px solid var(--cor-borda);
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s;
        }
        
        .info-card:hover, .progress-area:hover {
             transform: translateY(-3px);
        }

        .rotulo {
            font-size: 0.9em;
            color: var(--cor-borda);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
        }
        
        .rotulo i {
            margin-right: 8px;
            color: var(--cor-azul);
        }

        .valor {
            font-size: 2.2em;
            font-weight: 700;
            font-family: var(--fonte-titulo);
        }

        .valor-caixa {
            color: var(--cor-verde);
        }

        .valor-divida {
            color: var(--cor-vermelho);
        }
        
        /* Progress Area */
        .progress-area {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: flex-start;
        }

        .meta-status {
            font-size: 1.1em;
            font-weight: bold;
        }

        .meta-concluida {
            color: var(--cor-verde);
        }
        .meta-pendente {
            color: var(--cor-amarelo);
        }
        
        .progresso-bar-container {
            width: 100%;
            height: 10px;
            background-color: #30363d;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progresso {
            height: 100%;
            background-color: var(--cor-azul);
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }
        
        .btn-editar-meta {
            background-color: transparent;
            color: var(--cor-azul);
            border: 1px solid var(--cor-azul);
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
            font-size: 0.8em;
            transition: background-color 0.2s;
        }

        .btn-editar-meta:hover {
            background-color: rgba(88, 166, 255, 0.1);
        }
        
        /* Input de Meta */
        .meta-input-group {
            display: flex;
            align-items: center;
            width: 100%;
            margin-top: 5px;
        }
        .input-nova-meta {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid var(--cor-borda);
            background-color: #24292e;
            color: var(--cor-texto-principal);
            border-radius: 5px 0 0 5px;
            margin-right: -1px; /* Para juntar o botão */
        }
        .btn-salvar-meta {
            padding: 8px 15px;
            background-color: var(--cor-azul);
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
        }

        /* =================================== */
        /* 3. TABELAS DE TRANSAÇÕES            */
        /* =================================== */

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-header h2 {
            border: none; /* Removendo a borda do H2 original */
            color: var(--cor-texto-principal);
            font-family: var(--fonte-titulo);
        }

        .btn-principal {
            background-color: var(--cor-verde);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .btn-principal:hover {
            background-color: #2ea043; /* Verde um pouco mais escuro */
        }
        
        .transacoes-container {
            background-color: var(--cor-fundo-card);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            overflow-x: auto; 
            border: 1px solid var(--cor-borda);
        }

        .tabela-transacoes {
            width: 100%;
            border-collapse: separate; /* Permite border-spacing */
            border-spacing: 0 5px; /* Espaçamento entre as linhas */
        }

        .tabela-transacoes th, .tabela-transacoes td {
            padding: 12px 15px;
            text-align: left;
        }
        
        .tabela-transacoes thead tr {
            background-color: var(--cor-fundo-card);
            color: var(--cor-texto-principal);
        }

        .tabela-transacoes th {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8em;
            color: var(--cor-borda);
            border-bottom: 2px solid var(--cor-borda);
        }

        .tabela-transacoes tbody tr {
            background-color: #161b22; /* Linha de fundo sutilmente diferente */
            border-radius: 8px;
            transition: background-color 0.2s;
        }
        
        .tabela-transacoes tbody tr:hover {
            background-color: #24292e;
        }

        .caixa {
            color: var(--cor-verde);
            font-weight: bold;
        }

        .divida {
            color: var(--cor-vermelho);
            font-weight: bold;
        }
        
        .btn-deletar {
            background-color: var(--cor-vermelho);
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            transition: background-color 0.3s;
        }

        .btn-deletar:hover {
            background-color: #a42c2a;
        }
        
        /* =================================== */
        /* 4. MODAL/POPUP                      */
        /* =================================== */
        
        .modal {
            display: none; 
            position: fixed;
            z-index: 100; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8); 
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #1f2428;
            margin: 8% auto; 
            padding: 30px;
            width: 90%;
            max-width: 450px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            position: relative;
            border: 1px solid var(--cor-borda);
        }

        .fechar-modal {
            color: var(--cor-borda);
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }

        .fechar-modal:hover {
            color: var(--cor-texto-principal);
        }

        label {
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--cor-borda);
            font-size: 0.9em;
        }

        input[type="number"], input[type="text"], input[type="date"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--cor-borda);
            background-color: #24292e;
            color: var(--cor-texto-principal);
            border-radius: 6px;
            font-size: 1em;
        }

        .selecao-tipo {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .selecao-tipo button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: transform 0.2s, opacity 0.2s;
        }

        .selecao-tipo button:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        .btn-caixa {
            background-color: var(--cor-verde);
            color: white;
        }

        .btn-divida {
            background-color: var(--cor-vermelho);
            color: white;
        }

        .btn-ok {
            background-color: var(--cor-azul);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            float: right;
            margin-top: 20px;
            font-weight: bold;
        }
        
        .btn-ok:hover {
             background-color: #4490e6;
        }


        /* =================================== */
        /* 5. RESPONSIVIDADE (MOBILE)          */
        /* =================================== */
        @media (max-width: 768px) {
            
            .dashboard-header {
                grid-template-columns: 1fr; /* Empilha verticalmente */
                gap: 15px;
                margin-bottom: 20px;
            }

            .info-card, .progress-area {
                padding: 15px;
            }

            .valor {
                font-size: 1.8em; /* Reduz o tamanho da fonte */
            }

            .container {
                margin: 20px auto;
                padding: 0 10px; 
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .btn-principal {
                width: 100%; 
            }

            /* Tabela: Oculta colunas menos críticas no mobile */
            .tabela-transacoes th:nth-child(3), 
            .tabela-transacoes td:nth-child(3) {
                display: none; /* Oculta a coluna de Data */
            }
            
            .modal-content {
                margin: 10% auto;
            }
            
        }
    </style>
</head>
<body>

    <header class="dashboard-header container">
        
        <div class="info-card">
            <p class="rotulo"><i class="fas fa-sack-dollar"></i> Balanço Total (Entradas)</p>
            <span id="total-lancado" class="valor valor-caixa">R$ 0,00</span>
        </div>
        
        <div class="progress-area" id="meta-area">
            </div>
        
        <div class="info-card">
            <p class="rotulo"><i class="fas fa-hand-holding-dollar"></i> Despesas Totais</p>
            <span id="total-dividas" class="valor valor-divida">R$ 0,00</span>
        </div>
    </header>
    
    <main class="container">
        
        <div class="section-header">
            <h2>Registro de Transações</h2>
            <button id="abrir-cadastro" class="btn-principal"> <i class="fas fa-plus"></i> Nova Transação</button>
        </div>

        
        <div class="transacoes-container">
            <h3>Entradas (Receitas)</h3>
            <table class="tabela-transacoes">
                <thead>
                    <tr>
                        <th>Descrição</th>
                        <th>Valor</th>
                        <th>Data</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody id="lista-entradas">
                    </tbody>
            </table>
        </div>

        <div class="transacoes-container">
            <h3 style="margin-top: 10px;">Saídas (Despesas)</h3>
            <table class="tabela-transacoes">
                <thead>
                    <tr>
                        <th>Descrição</th>
                        <th>Valor</th>
                        <th>Data</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody id="lista-dividas">
                    </tbody>
            </table>
        </div>
        
    </main>


    <div id="modal-principal" class="modal">
        <div class="modal-content">
            <span class="fechar-modal" id="fechar-modal">&times;</span>
            
            <div id="passo-tipo">
                <h3>Selecione o Tipo de Lançamento</h3>
                <div class="selecao-tipo">
                    <button class="btn-caixa" data-tipo="CAIXA"><i class="fas fa-arrow-up"></i> Receita</button>
                    <button class="btn-divida" data-tipo="DIVIDA"><i class="fas fa-arrow-down"></i> Despesa</button>
                </div>
            </div>

            <div id="passo-dados" style="display: none;">
                <h3 id="titulo-dados">Cadastrar...</h3>
                
                <label for="valor-input">VALOR (R$)</label>
                <input type="number" id="valor-input" placeholder="0.00" min="0.01" step="0.01">
                
                <label for="descricao-input">DESCRIÇÃO</label>
                <input type="text" id="descricao-input" placeholder="Ex: Salário, Aluguel, Supermercado">
                
                <label for="data-input">DATA</label>
                <input type="date" id="data-input">
                
                <button class="btn-ok" id="btn-cadastrar">Cadastrar <i class="fas fa-check"></i></button>
            </div>

        </div>
    </div>
    
    <script>
        // ===========================================
        // JAVASCRIPT: LÓGICA DO DASHBOARD FINANCEIRO
        // ===========================================

        // 1. VARIÁVEIS GLOBAIS (ELEMENTOS DOM)
        const modal = document.getElementById('modal-principal');
        const abrirCadastroBtn = document.getElementById('abrir-cadastro');
        const fecharModalBtn = document.getElementById('fechar-modal');
        const passoTipo = document.getElementById('passo-tipo');
        const passoDados = document.getElementById('passo-dados');
        const tituloDados = document.getElementById('titulo-dados');
        const btnCadastrar = document.getElementById('btn-cadastrar');

        const valorInput = document.getElementById('valor-input');
        const descricaoInput = document.getElementById('descricao-input');
        const dataInput = document.getElementById('data-input');

        const listaEntradasBody = document.getElementById('lista-entradas');
        const listaDividasBody = document.getElementById('lista-dividas');
        
        const totalLancadoEl = document.getElementById('total-lancado');
        const totalDividasEl = document.getElementById('total-dividas');
        const metaAreaEl = document.getElementById('meta-area');
        
        let tipoLancamentoAtual = '';

        // Carrega a meta salva ou define 5000 como padrão
        let META_FINANCEIRA = parseFloat(localStorage.getItem('metaFinanceira')) || 5000;


        // 2. FUNÇÕES DE UTILIDADE (LOCAL STORAGE & FORMATO)
        // --------------------------------------------------

        const carregarTransacoes = () => {
            const transacoes = localStorage.getItem('transacoes');
            return transacoes ? JSON.parse(transacoes) : [];
        };

        const salvarTransacoes = (transacoes) => {
            localStorage.setItem('transacoes', JSON.stringify(transacoes));
        };

        const formatarMoeda = (valor) => {
            return parseFloat(valor).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        };

        const formatarData = (dataString) => {
            const [year, month, day] = dataString.split('-');
            return `${day}/${month}/${year}`;
        }
        

        // 3. LÓGICA DA META DINÂMICA
        // --------------------------------------------------

        const getTotais = (transacoes) => {
            let totalReceitas = 0;
            let totalDespesas = 0;

            transacoes.forEach(t => {
                const valor = parseFloat(t.valor);
                if (t.tipo === 'CAIXA') {
                    totalReceitas += valor;
                } else if (t.tipo === 'DIVIDA') {
                    totalDespesas += valor;
                }
            });
            return { totalReceitas, totalDespesas };
        }
        
        const renderizarMeta = (totalReceitas) => {
            
            const metaConcluida = totalReceitas >= META_FINANCEIRA;
            const progressoPercentual = Math.min(100, (totalReceitas / META_FINANCEIRA) * 100);

            let htmlContent;

            if (metaConcluida) {
                htmlContent = `
                    <p class="rotulo"><i class="fas fa-bullseye"></i> Meta de Receita <span class="meta-status meta-concluida">CONCLUÍDA</span></p>
                    <p>Alcançado: ${formatarMoeda(totalReceitas)} de ${formatarMoeda(META_FINANCEIRA)}</p>
                    <div class="progresso-bar-container">
                        <div id="progresso-bar" class="progresso" style="width: 100%; background-color: var(--cor-verde);"></div>
                    </div>
                    <button id="btn-editar-meta" class="btn-editar-meta">Definir Nova Meta</button>
                `;
            } else {
                 htmlContent = `
                    <p class="rotulo"><i class="fas fa-bullseye"></i> Meta de Receita <span class="meta-status meta-pendente">PENDENTE</span></p>
                    <p>Faltam: ${formatarMoeda(META_FINANCEIRA - totalReceitas)}</p>
                    <div class="progresso-bar-container">
                        <div id="progresso-bar" class="progresso" style="width: ${progressoPercentual}%;"></div>
                    </div>
                    <button id="btn-editar-meta" class="btn-editar-meta">Editar Meta</button>
                `;
            }
            
            metaAreaEl.innerHTML = htmlContent;
            document.getElementById('btn-editar-meta').addEventListener('click', iniciarEdicaoMeta);
        };

        const iniciarEdicaoMeta = () => {
            const oldMeta = META_FINANCEIRA;
            
            metaAreaEl.innerHTML = `
                <p class="rotulo"><i class="fas fa-bullseye"></i> Definir Nova Meta</p>
                <div class="meta-input-group">
                    <input type="number" id="input-nova-meta" value="${oldMeta.toFixed(2)}" class="input-nova-meta" min="1" step="0.01">
                    <button id="btn-salvar-meta" class="btn-salvar-meta"><i class="fas fa-save"></i> Salvar</button>
                </div>
            `;
            
            const inputNovaMeta = document.getElementById('input-nova-meta');
            inputNovaMeta.focus();
            inputNovaMeta.select();

            document.getElementById('btn-salvar-meta').addEventListener('click', salvarNovaMeta);
        };

        const salvarNovaMeta = () => {
            const inputNovaMeta = document.getElementById('input-nova-meta');
            const novaMeta = parseFloat(inputNovaMeta.value);
            
            if (isNaN(novaMeta) || novaMeta <= 0) {
                alert("Por favor, insira um valor de meta válido e positivo.");
                return;
            }
            
            META_FINANCEIRA = novaMeta;
            localStorage.setItem('metaFinanceira', novaMeta);
            
            // Re-renderiza tudo para aplicar a nova meta
            initDashboard();
        };


        // 4. FUNÇÕES DE ATUALIZAÇÃO DO DASHBOARD E RENDERIZAÇÃO
        // -------------------------------------------------------

        const initDashboard = () => {
            const transacoes = carregarTransacoes();
            const { totalReceitas, totalDespesas } = getTotais(transacoes);

            // 1. Atualiza Totais
            totalLancadoEl.textContent = formatarMoeda(totalReceitas);
            totalDividasEl.textContent = formatarMoeda(totalDespesas);
            
            // 2. Renderiza a Meta
            renderizarMeta(totalReceitas);
            
            // 3. Renderiza as Tabelas
            renderizarTransacoes(transacoes);
        };
        
        const renderizarTransacoes = (transacoes) => {
            // Limpa ambas as tabelas
            listaEntradasBody.innerHTML = '';
            listaDividasBody.innerHTML = '';

            // Ordena as transações pela data (mais recente primeiro)
            const transacoesOrdenadas = transacoes.sort((a, b) => new Date(b.data) - new Date(a.data));

            transacoesOrdenadas.forEach((t, index) => {
                const targetBody = t.tipo === 'CAIXA' ? listaEntradasBody : listaDividasBody;
                const tipoClass = t.tipo.toLowerCase(); 
                
                const row = targetBody.insertRow();
                // O índice original é crucial para deletar a transação correta no array salvo
                
                row.innerHTML = `
                    <td>${t.descricao}</td>
                    <td class="${tipoClass}">${formatarMoeda(t.valor)}</td>
                    <td>${formatarData(t.data)}</td>
                    <td><button class="btn-deletar" data-index="${index}"><i class="fas fa-trash"></i></button></td>
                `;
            });
        };
        
        const deletarTransacao = (originalIndex) => {
             if (!confirm("Tem certeza que deseja deletar esta transação?")) {
                return;
            }
            
            let transacoes = carregarTransacoes();
            
            // IMPORTANTE: Encontrar o item no array original ANTES de deletar pelo índice do DOM.
            // Aqui vamos deletar pelo índice do array original (mais seguro)
            transacoes.splice(originalIndex, 1); 
            
            salvarTransacoes(transacoes);
            initDashboard(); // Re-inicia o dashboard para recalcular tudo
        };

        const adicionarTransacao = () => {
            const valor = parseFloat(valorInput.value);
            const descricao = descricaoInput.value.trim();
            const data = dataInput.value;

            if (isNaN(valor) || valor <= 0 || descricao === "" || data === "") {
                alert("Por favor, preencha todos os campos corretamente.");
                return;
            }

            const novaTransacao = {
                tipo: tipoLancamentoAtual,
                // Usar toFixed(2) antes de salvar garante o formato padronizado no storage
                valor: valor.toFixed(2), 
                descricao: descricao,
                data: data
            };

            let transacoes = carregarTransacoes();
            transacoes.push(novaTransacao);
            salvarTransacoes(transacoes);
            
            initDashboard(); // Recarrega tudo
            fecharModal();
        };


        // 5. FUNÇÕES E EVENTOS DO MODAL (POP-UP)
        // -----------------------------------------

        const abrirModal = () => {
            // 1. Resetar visualmente
            passoTipo.style.display = 'block';
            passoDados.style.display = 'none';
            
            // 2. Resetar valores dos inputs
            valorInput.value = '';
            descricaoInput.value = '';
            // Data atual
            dataInput.value = new Date().toISOString().slice(0, 10); 
            
            // 3. Abrir
            modal.style.display = 'block';
        };

        const fecharModal = () => {
            modal.style.display = 'none';
        };

        const irParaDados = (tipo) => {
            tipoLancamentoAtual = tipo;
            
            const tipoTexto = tipo === 'CAIXA' ? 'Receita (Entrada)' : 'Despesa (Saída)';
            tituloDados.textContent = `Cadastrar ${tipoTexto}`;
            
            passoTipo.style.display = 'none';
            passoDados.style.display = 'block';
            
            // Foca no primeiro input para agilizar o uso
            valorInput.focus();
        };


        // 6. INICIALIZAÇÃO E LISTENERS
        // -----------------------------------------

        document.addEventListener('DOMContentLoaded', initDashboard);

        // Delegação de evento para o botão deletar (mais eficiente)
        document.addEventListener('click', (e) => {
            if (e.target.closest('.btn-deletar')) {
                // Obtém o índice do elemento mais próximo com a classe 'btn-deletar'
                const btn = e.target.closest('.btn-deletar');
                const index = btn.getAttribute('data-index');
                deletarTransacao(parseInt(index));
            }
        });

        abrirCadastroBtn.addEventListener('click', abrirModal);
        fecharModalBtn.addEventListener('click', fecharModal);

        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                fecharModal();
            }
        });
        
        // Listeners para os botões Receita/Despesa no modal
        document.querySelectorAll('.selecao-tipo button').forEach(button => {
            button.addEventListener('click', (e) => {
                irParaDados(e.target.getAttribute('data-tipo'));
            });
        });

        btnCadastrar.addEventListener('click', adicionarTransacao);
    </script>
</body>
</html>
